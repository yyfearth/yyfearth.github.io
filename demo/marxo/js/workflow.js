!function(){var t=function(t,e,n){return t=jsPlumbUtil.isArray(t)?t:[t.x,t.y],e=jsPlumbUtil.isArray(e)?e:[e.x,e.y],n(t,e)};jsPlumbUtil={isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isNumber:function(t){return"[object Number]"===Object.prototype.toString.call(t)},isString:function(t){return"string"==typeof t},isBoolean:function(t){return"boolean"==typeof t},isNull:function(t){return null==t},isObject:function(t){return null==t?!1:"[object Object]"===Object.prototype.toString.call(t)},isDate:function(t){return"[object Date]"===Object.prototype.toString.call(t)},isFunction:function(t){return"[object Function]"===Object.prototype.toString.call(t)},clone:function(t){if(this.isString(t))return""+t;if(this.isBoolean(t))return!!t;if(this.isDate(t))return new Date(t.getTime());if(this.isFunction(t))return t;if(this.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(this.clone(t[n]));return e}if(this.isObject(t)){e={};for(n in t)e[n]=this.clone(t[n]);return e}return t},merge:function(t,e){var n,o=this.clone(t);for(n in e)if(null==o[n]||this.isString(e[n])||this.isBoolean(e[n]))o[n]=e[n];else if(this.isArray(e[n])){var i=[];this.isArray(o[n])&&i.push.apply(i,o[n]),i.push.apply(i,e[n]),o[n]=i}else if(this.isObject(e[n])){this.isObject(o[n])||(o[n]={});for(var r in e[n])o[n][r]=e[n][r]}return o},copyValues:function(t,e,n){for(var o=0;o<t.length;o++)n[t[o]]=e[t[o]]},functionChain:function(t,e,n){for(var o=0;o<n.length;o++){var i=n[o][0][n[o][1]].apply(n[o][0],n[o][2]);if(i===e)return i}return t},populate:function(t,e){var n=function(t){if(null!=t){if(jsPlumbUtil.isString(t)){var o=t.match(/(\${.*?})/g);if(null!=o)for(var i=0;i<o.length;i++){var r=e[o[i].substring(2,o[i].length-1)];null!=r&&(t=t.replace(o[i],r))}return t}if(jsPlumbUtil.isArray(t)){for(o=[],i=0;i<t.length;i++)o.push(n(t[i]));return o}if(jsPlumbUtil.isObject(t)){o={};for(i in t)o[i]=n(t[i]);return o}return t}};return n(t)},convertStyle:function(t,e){if("transparent"===t)return t;var n=t,o=function(t){return 1==t.length?"0"+t:t},i=/(rgb[a]?\()(.*)(\))/;return t.match(i)&&(i=t.match(i)[2].split(","),n="#"+o(Number(i[0]).toString(16))+o(Number(i[1]).toString(16))+o(Number(i[2]).toString(16)),e||4!=i.length||(n+=o(Number(i[3]).toString(16)))),n},gradient:function(e,n){return t(e,n,function(t,e){return e[0]==t[0]?e[1]>t[1]?1/0:-1/0:e[1]==t[1]?e[0]>t[0]?0:-0:(e[1]-t[1])/(e[0]-t[0])})},normal:function(t,e){return-1/this.gradient(t,e)},lineLength:function(e,n){return t(e,n,function(t,e){return Math.sqrt(Math.pow(e[1]-t[1],2)+Math.pow(e[0]-t[0],2))})},segment:function(e,n){return t(e,n,function(t,e){return e[0]>t[0]?e[1]>t[1]?2:1:e[0]==t[0]?e[1]>t[1]?2:1:e[1]>t[1]?3:4})},theta:function(e,n){return t(e,n,function(t,e){var n=jsPlumbUtil.gradient(t,e),n=Math.atan(n),o=jsPlumbUtil.segment(t,e);return(4==o||3==o)&&(n+=Math.PI),0>n&&(n+=2*Math.PI),n})},intersects:function(t,e){var n=t.x,o=t.x+t.w,i=t.y,r=t.y+t.h,s=e.x,a=e.x+e.w,l=e.y,u=e.y+e.h;return s>=n&&o>=s&&l>=i&&r>=l||a>=n&&o>=a&&l>=i&&r>=l||s>=n&&o>=s&&u>=i&&r>=u||a>=n&&o>=s&&u>=i&&r>=u||n>=s&&a>=n&&i>=l&&u>=i||o>=s&&a>=o&&i>=l&&u>=i||n>=s&&a>=n&&r>=l&&u>=r||o>=s&&a>=n&&r>=l&&u>=r},segmentMultipliers:[null,[1,-1],[1,1],[-1,1],[-1,-1]],inverseSegmentMultipliers:[null,[-1,-1],[-1,1],[1,1],[1,-1]],pointOnLine:function(t,e,n){var o=jsPlumbUtil.gradient(t,e);e=jsPlumbUtil.segment(t,e),e=n>0?jsPlumbUtil.segmentMultipliers[e]:jsPlumbUtil.inverseSegmentMultipliers[e];var i=Math.atan(o),o=Math.abs(n*Math.sin(i))*e[1];return n=Math.abs(n*Math.cos(i))*e[0],{x:t.x+n,y:t.y+o}},perpendicularLineTo:function(t,e,n){t=jsPlumbUtil.gradient(t,e);var o=Math.atan(-1/t);return t=n/2*Math.sin(o),n=n/2*Math.cos(o),[{x:e.x+n,y:e.y+t},{x:e.x-n,y:e.y-t}]},findWithFunction:function(t,e){if(t)for(var n=0;n<t.length;n++)if(e(t[n]))return n;return-1},clampToGrid:function(t,e,n,o,i){return[o||null==n?t:(Math.floor(t/n[0])+(t%n[0]>=n[0]/2?1:0))*n[0],i||null==n?e:(Math.floor(e/n[1])+(e%n[1]>=n[1]/2?1:0))*n[1]]},indexOf:function(t,e){return jsPlumbUtil.findWithFunction(t,function(t){return t==e})},removeWithFunction:function(t,e){var n=jsPlumbUtil.findWithFunction(t,e);return n>-1&&t.splice(n,1),-1!=n},remove:function(t,e){var n=jsPlumbUtil.indexOf(t,e);return n>-1&&t.splice(n,1),-1!=n},addWithFunction:function(t,e,n){-1==jsPlumbUtil.findWithFunction(t,n)&&t.push(e)},addToList:function(t,e,n){var o=t[e];return null==o&&(o=[],t[e]=o),o.push(n),o},EventGenerator:function(){var t={},e=this,n=!1,o=["ready"];this.bind=function(n,o){return jsPlumbUtil.addToList(t,n,o),e},this.fire=function(i,r,s){if(!n&&t[i])for(var a=0;a<t[i].length;a++)if(-1!=jsPlumbUtil.findWithFunction(o,function(t){return t===i}))t[i][a](r,s);else try{t[i][a](r,s)}catch(l){jsPlumbUtil.log("jsPlumb: fire failed for event "+i+" : "+l)}return e},this.unbind=function(n){return n?delete t[n]:t={},e},this.getListener=function(e){return t[e]},this.setSuspendEvents=function(t){n=t},this.isSuspendEvents=function(){return n}},logEnabled:!0,log:function(){if(jsPlumbUtil.logEnabled&&"undefined"!=typeof console)try{console.log(arguments[arguments.length-1])}catch(t){}},group:function(t){jsPlumbUtil.logEnabled&&"undefined"!=typeof console&&console.group(t)},groupEnd:function(t){jsPlumbUtil.logEnabled&&"undefined"!=typeof console&&console.groupEnd(t)},time:function(t){jsPlumbUtil.logEnabled&&"undefined"!=typeof console&&console.time(t)},timeEnd:function(t){jsPlumbUtil.logEnabled&&"undefined"!=typeof console&&console.timeEnd(t)},removeElement:function(t){null!=t&&null!=t.parentNode&&t.parentNode.removeChild(t)},removeElements:function(t){for(var e=0;e<t.length;e++)jsPlumbUtil.removeElement(t[e])}}}(),function(){var t=!!document.createElement("canvas").getContext,e=!!window.SVGAngle||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"),n=function(){if(void 0==n.vml){var t=document.body.appendChild(document.createElement("div"));t.innerHTML='<v:shape id="vml_flag1" adj="1" />';var e=t.firstChild;e.style.behavior="url(#default#VML)",n.vml=e?"object"==typeof e.adj:!0,t.parentNode.removeChild(t)}return n.vml},o=function(t){var e={},n=[],o={},i={},r={};this.register=function(s){var a=jsPlumb.CurrentLibrary;s=a.getElementObject(s);var l=t.getId(s),u=a.getDOMElement(s),c=a.getOffset(s);e[l]||(e[l]=s,n.push(s),o[l]={});var d=function(e){if(e)for(var n=0;n<e.childNodes.length;n++)if(3!=e.childNodes[n].nodeType&&8!=e.childNodes[n].nodeType){var s=a.getElementObject(e.childNodes[n]),u=t.getId(s,null,!0);u&&i[u]&&0<i[u]&&(s=a.getOffset(s),o[l][u]={id:u,offset:{left:s.left-c.left,top:s.top-c.top}},r[u]=l),d(e.childNodes[n])}};d(u)},this.updateOffsets=function(e){var n=jsPlumb.CurrentLibrary,i=n.getElementObject(e);e=t.getId(i);var s=o[e],i=n.getOffset(i);if(s)for(var a in s)s=n.getElementObject(a),s=n.getOffset(s),o[e][a]={id:a,offset:{left:s.left-i.left,top:s.top-i.top}},r[a]=e},this.endpointAdded=function(n){var s=jsPlumb.CurrentLibrary,a=document.body,l=t.getId(n),u=s.getDOMElement(n).parentNode;for(i[l]=i[l]?i[l]+1:1;null!=u&&u!=a;){var c=t.getId(u,null,!0);if(c&&e[c]){a=s.getElementObject(u),s=s.getOffset(a),null==o[c][l]&&(n=jsPlumb.CurrentLibrary.getOffset(n),o[c][l]={id:l,offset:{left:n.left-s.left,top:n.top-s.top}},r[l]=c);break}u=u.parentNode}},this.endpointDeleted=function(t){if(i[t.elementId]&&(i[t.elementId]--,0>=i[t.elementId]))for(var e in o)o[e]&&(delete o[e][t.elementId],delete r[t.elementId])},this.changeId=function(t,e){o[e]=o[t],o[t]={},r[e]=r[t],r[t]=null},this.getElementsForDraggable=function(t){return o[t]},this.elementRemoved=function(t){var e=r[t];e&&(delete o[e][t],delete r[t])},this.reset=function(){e={},n=[],o={},i={}}};window.console||(window.console={time:function(){},timeEnd:function(){},group:function(){},groupEnd:function(){},log:function(){}}),window.jsPlumbAdapter={headless:!1,appendToRoot:function(t){document.body.appendChild(t)},getRenderModes:function(){return["canvas","svg","vml"]},isRenderModeAvailable:function(o){return{canvas:t,svg:e,vml:n()}[o]},getDragManager:function(t){return new o(t)},setRenderMode:function(t){var e;if(t){t=t.toLowerCase();var n=this.isRenderModeAvailable("canvas"),o=this.isRenderModeAvailable("svg"),i=this.isRenderModeAvailable("vml");"svg"===t?o?e="svg":n?e="canvas":i&&(e="vml"):"canvas"===t&&n?e="canvas":i&&(e="vml")}return e}}}(),function(){var t=(jsPlumbUtil.findWithFunction,jsPlumbUtil.indexOf),e=jsPlumbUtil.removeWithFunction,n=(jsPlumbUtil.remove,jsPlumbUtil.addWithFunction,jsPlumbUtil.addToList),o=jsPlumbUtil.isArray,i=jsPlumbUtil.isString,r=jsPlumbUtil.isObject,s=function(t,e){return m.CurrentLibrary.getAttribute(a(t),e)},a=function(t){return m.CurrentLibrary.getElementObject(t)},l=function(t,e){var n=m.CurrentLibrary.getOffset(a(t));if(null!=e){var o=e.getZoom();return{left:n.left/o,top:n.top/o}}return n},u=jsPlumbUtil.log,c=(jsPlumbUtil.group,jsPlumbUtil.groupEnd,jsPlumbUtil.time,jsPlumbUtil.timeEnd,function(){return""+(new Date).getTime()}),d=window.jsPlumbUIComponent=function(t){var e=this,n=arguments,o=!1,i=t.parameters||{},r=e.idPrefix+(new Date).getTime(),s=null,l=null;if(e._jsPlumb=t._jsPlumb,e.getId=function(){return r},e.hoverClass=t.hoverClass||e._jsPlumb.Defaults.HoverClass||m.Defaults.HoverClass,jsPlumbUtil.EventGenerator.apply(this),t.events)for(var d in t.events)e.bind(d,t.events[d]);this.clone=function(){var t={};return e.constructor.apply(t,n),t},this.getParameter=function(t){return i[t]},this.getParameters=function(){return i},this.setParameter=function(t,e){i[t]=e},this.setParameters=function(t){i=t},this.overlayPlacements=[];var h=t.beforeDetach;this.isDetachAllowed=function(t){var e=!0;if(h)try{e=h(t)}catch(n){u("jsPlumb: beforeDetach callback failed",n)}return e};var p=t.beforeDrop;this.isDropAllowed=function(t,n,o,i,r){var s=e._jsPlumb.checkCondition("beforeDrop",{sourceId:t,targetId:n,scope:o,connection:i,dropEndpoint:r});if(p)try{s=p({sourceId:t,targetId:n,scope:o,connection:i,dropEndpoint:r})}catch(a){u("jsPlumb: beforeDrop callback failed",a)}return s};var f=function(){if(s&&l){var t={};m.extend(t,s),m.extend(t,l),delete e.hoverPaintStyle,t.gradient&&s.fillStyle&&delete t.gradient,l=t}};this.setPaintStyle=function(t,n){s=t,e.paintStyleInUse=s,f(),n||e.repaint()},this.getPaintStyle=function(){return s},this.setHoverPaintStyle=function(t,n){l=t,f(),n||e.repaint()},this.getHoverPaintStyle=function(){return l},this.setHover=function(t,n,i){if(!e._jsPlumb.currentlyDragging&&!e._jsPlumb.isHoverSuspended()&&(o=t,null!=e.canvas&&(null!=e.hoverClass&&(t?g.addClass(e.canvas,e.hoverClass):g.removeClass(e.canvas,e.hoverClass)),t?g.addClass(e.canvas,e._jsPlumb.hoverClass):g.removeClass(e.canvas,e._jsPlumb.hoverClass)),null!=l&&(e.paintStyleInUse=t?l:s,e._jsPlumb.isSuspendDrawing()||(i=i||c(),e.repaint({timestamp:i,recalc:!1}))),e.getAttachedElements&&!n)){n=c(),i=e;var r=e.getAttachedElements();if(r)for(var a=0,u=r.length;u>a;a++)i&&i==r[a]||r[a].setHover(t,!0,n)}},this.isHover=function(){return o},this.bindListeners=function(t,e,n){t.bind("click",function(t,n){e.fire("click",e,n)}),t.bind("dblclick",function(t,n){e.fire("dblclick",e,n)}),t.bind("contextmenu",function(t,n){e.fire("contextmenu",e,n)}),t.bind("mouseenter",function(t,o){e.isHover()||(n(!0),e.fire("mouseenter",e,o))}),t.bind("mouseexit",function(t,o){e.isHover()&&(n(!1),e.fire("mouseexit",e,o))}),t.bind("mousedown",function(t,n){e.fire("mousedown",e,n)}),t.bind("mouseup",function(t,n){e.fire("mouseup",e,n)})};var g=m.CurrentLibrary,v="click dblclick mouseenter mouseout mousemove mousedown mouseup contextmenu".split(" "),y={mouseout:"mouseexit"},b=function(t,e,n){var o=y[n]||n;g.bind(t,n,function(t){e.fire(o,e,t)})};this.attachListeners=function(t,e){for(var n=0,o=v.length;o>n;n++)b(t,e,v[n])},this.reattachListenersForElement=function(t){if(1<arguments.length){for(var n=0,o=v.length;o>n;n++){var i=t,r=v[n];y[r]||r,g.unbind(i,r)}for(n=1,o=arguments.length;o>n;n++)e.attachListeners(t,arguments[n])}};var P=[],C=function(t){return null==t?null:t.split(" ")},E=function(t,n){if(e.getDefaultType){for(var o=e.getTypeDescriptor(),i=jsPlumbUtil.merge({},e.getDefaultType()),r=0,s=P.length;s>r;r++)i=jsPlumbUtil.merge(i,e._jsPlumb.getType(P[r],o));t&&(i=jsPlumbUtil.populate(i,t)),e.applyType(i,n),n||e.repaint()}};e.setType=function(t,e,n){P=C(t)||[],E(e,n)},e.getType=function(){return P},e.reapplyTypes=function(t,e){E(t,e)},e.hasType=function(t){return-1!=jsPlumbUtil.indexOf(P,t)},e.addType=function(t,n,o){t=C(t);var i=!1;if(null!=t){for(var r=0,s=t.length;s>r;r++)e.hasType(t[r])||(P.push(t[r]),i=!0);i&&E(n,o)}},e.removeType=function(t,e){var n=C(t),o=!1;if(null!=n){for(var i=0,r=n.length;r>i;i++)var s=jsPlumbUtil.indexOf(P,n[i]),o=(-1!=s?(P.splice(s,1),!0):!1)||o;o&&E(null,e)}},e.toggleType=function(t,e,n){if(t=C(t),null!=t){for(var o=0,i=t.length;i>o;o++){var r=jsPlumbUtil.indexOf(P,t[o]);-1!=r?P.splice(r,1):P.push(t[o])}E(e,n)}},this.applyType=function(t,n){if(e.setPaintStyle(t.paintStyle,n),e.setHoverPaintStyle(t.hoverPaintStyle,n),t.parameters)for(var o in t.parameters)e.setParameter(o,t.parameters[o])},this.addClass=function(t){null!=e.canvas&&m.CurrentLibrary.addClass(a(e.canvas),t)},this.removeClass=function(t){null!=e.canvas&&m.CurrentLibrary.removeClass(a(e.canvas),t)}};window.overlayCapableJsPlumbUIComponent=function(t){d.apply(this,arguments);var e=this;this.overlays=[];var n=function(t){var n=null;if(o(t)){var n=t[0],i=m.extend({component:e,_jsPlumb:e._jsPlumb},t[1]);3==t.length&&m.extend(i,t[2]),n=new(m.Overlays[e._jsPlumb.getRenderMode()][n])(i)}else n=t.constructor==String?new(m.Overlays[e._jsPlumb.getRenderMode()][t])({component:e,_jsPlumb:e._jsPlumb}):t;e.overlays.push(n)},i=function(t){var n=e.defaultOverlayKeys||[];(t=t.overlays)||(t=[]);for(var o=0,i=n.length;i>o;o++)t.unshift.apply(t,e._jsPlumb.Defaults[n[o]]||m.Defaults[n[o]]||[]);return t}(t);if(i)for(var r=0,s=i.length;s>r;r++)n(i[r]);var a=function(t){for(var n=-1,o=0,i=e.overlays.length;i>o;o++)if(t===e.overlays[o].id){n=o;break}return n};this.addOverlay=function(t,o){n(t),o||e.repaint()},this.getOverlay=function(t){return t=a(t),t>=0?e.overlays[t]:null},this.getOverlays=function(){return e.overlays},this.hideOverlay=function(t){(t=e.getOverlay(t))&&t.hide()},this.hideOverlays=function(){for(var t=0,n=e.overlays.length;n>t;t++)e.overlays[t].hide()},this.showOverlay=function(t){(t=e.getOverlay(t))&&t.show()},this.showOverlays=function(){for(var t=0,n=e.overlays.length;n>t;t++)e.overlays[t].show()},this.removeAllOverlays=function(){for(var t=0,n=e.overlays.length;n>t;t++)e.overlays[t].cleanup&&e.overlays[t].cleanup();e.overlays.splice(0,e.overlays.length),e.repaint()},this.removeOverlay=function(t){if(t=a(t),-1!=t){var n=e.overlays[t];n.cleanup&&n.cleanup(),e.overlays.splice(t,1)}},this.removeOverlays=function(){for(var t=0,n=arguments.length;n>t;t++)e.removeOverlay(arguments[t])};var l=function(t){return t=m.extend({cssClass:t.cssClass,labelStyle:this.labelStyle,id:"__label",component:e,_jsPlumb:e._jsPlumb},t),new(m.Overlays[e._jsPlumb.getRenderMode()].Label)(t)};t.label&&this.overlays.push(l({label:t.label,location:t.labelLocation||e.defaultLabelLocation||.5,labelStyle:t.labelStyle||e._jsPlumb.Defaults.LabelStyle||m.Defaults.LabelStyle})),this.setLabel=function(t){var n=e.getOverlay("__label");n?t.constructor==String||t.constructor==Function?n.setLabel(t):(t.label&&n.setLabel(t.label),t.location&&n.setLocation(t.location)):(n=l(t.constructor==String||t.constructor==Function?{label:t}:t),this.overlays.push(n)),e._jsPlumb.isSuspendDrawing()||e.repaint()},this.getLabel=function(){var t=e.getOverlay("__label");return null!=t?t.getLabel():null},this.getLabelOverlay=function(){return e.getOverlay("__label")};var u=this.applyType;this.applyType=function(t,n){if(u(t,n),e.removeAllOverlays(),t.overlays)for(var o=0,i=t.overlays.length;i>o;o++)e.addOverlay(t.overlays[o],!0)};var c=this.setHover;this.setHover=function(t){c.apply(e,arguments);for(var n=0,o=e.overlays.length;o>n;n++)e.overlays[n][t?"addClass":"removeClass"](e._jsPlumb.hoverClass)}};var h=0,p=function(){var t=h+1;return h++,t},f=function(h){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",Container:null,DoNotThrowErrors:!1,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},ReattachConnections:!1,RenderMode:"svg",Scope:"jsPlumb_DefaultScope"},h&&m.extend(this.Defaults,h),this.logEnabled=this.Defaults.LogEnabled;var f={},g={};this.registerConnectionType=function(t,e){f[t]=m.extend({},e)},this.registerConnectionTypes=function(t){for(var e in t)f[e]=m.extend({},t[e])},this.registerEndpointType=function(t,e){g[t]=m.extend({},e)},this.registerEndpointTypes=function(t){for(var e in t)g[e]=m.extend({},t[e])},this.getType=function(t,e){return"connection"===e?f[t]:g[t]},jsPlumbUtil.EventGenerator.apply(this);var v=this,y=p(),b=v.bind,P={},C=1;this.getInstanceIndex=function(){return y},this.setZoom=function(t,e){C=t,e&&v.repaintEverything()},this.getZoom=function(){return C};for(var E in this.Defaults)P[E]=this.Defaults[E];this.bind=function(t,e){"ready"===t&&S?e():b.apply(v,[t,e])},v.importDefaults=function(t){for(var e in t)v.Defaults[e]=t[e]},v.restoreDefaults=function(){v.Defaults=m.extend({},P)};var x=null,S=!1,j=null,_={},w={},D={},A={},k={},L={},I={},O=[],M=this.Defaults.Scope,T=null,U=1,F=function(){return""+U++},N=function(t,e,n,o){if(!jsPlumbAdapter.headless&&!Se){t=s(t,"id");var i=v.dragManager.getElementsForDraggable(t);if(null==n&&(n=c()),v.anchorManager.redraw(t,e,n,null,o),i)for(var r in i)v.anchorManager.redraw(i[r].id,e,n,i[r].offset,o)}},W=function(t,e){var n=null;if(o(t))for(var n=[],i=0,r=t.length;r>i;i++){var l=a(t[i]),u=s(l,"id");n.push(e(l,u))}else l=a(t),u=s(l,"id"),n=e(l,u);return n},H=function(t,e,n){if(!jsPlumbAdapter.headless){var o=m.CurrentLibrary;if((null==e?0:e)&&o.isDragSupported(t)&&!o.isAlreadyDraggable(t)){e=n||v.Defaults.DragOptions||m.Defaults.DragOptions,e=m.extend({},e),n=o.dragEvents.drag;var i=o.dragEvents.stop,r=o.dragEvents.start;e[r]=K(e[r],function(){v.setHoverSuspended(!0),v.select({source:t}).addClass(v.elementDraggingClass+" "+v.sourceElementDraggingClass,!0),v.select({target:t}).addClass(v.elementDraggingClass+" "+v.targetElementDraggingClass,!0)}),e[n]=K(e[n],function(){var e=o.getUIPosition(arguments,v.getZoom());N(t,e,null,!0),m.CurrentLibrary.addClass(a(t),"jsPlumb_dragged")}),e[i]=K(e[i],function(){var e=o.getUIPosition(arguments,v.getZoom());N(t,e),m.CurrentLibrary.removeClass(a(t),"jsPlumb_dragged"),v.setHoverSuspended(!1),v.select({source:t}).removeClass(v.elementDraggingClass+" "+v.sourceElementDraggingClass,!0),v.select({target:t}).removeClass(v.elementDraggingClass+" "+v.targetElementDraggingClass,!0)}),n=Z(t),I[n]=!0,n=I[n],e.disabled=null==n?!1:!n,o.initDraggable(t,e,!1,v),v.dragManager.register(t)}}},X=function(t,e){var n=m.extend({sourceIsNew:!0,targetIsNew:!0},t);if(e&&m.extend(n,e),n.source&&n.source.endpoint&&(n.sourceEndpoint=n.source),n.target&&n.target.endpoint&&(n.targetEndpoint=n.target),t.uuids&&(n.sourceEndpoint=D[t.uuids[0]],n.targetEndpoint=D[t.uuids[1]]),n.sourceEndpoint&&n.sourceEndpoint.isFull())return void u(v,"could not add connection; source endpoint is full");if(n.targetEndpoint&&n.targetEndpoint.isFull())return void u(v,"could not add connection; target endpoint is full");if(n.sourceEndpoint&&!n.sourceEndpoint.addedViaMouse&&(n.sourceIsNew=!1),n.targetEndpoint&&!n.targetEndpoint.addedViaMouse&&(n.targetIsNew=!1),!n.type&&n.sourceEndpoint&&(n.type=n.sourceEndpoint.connectionType),n.sourceEndpoint&&n.sourceEndpoint.connectorOverlays){n.overlays=n.overlays||[];for(var o=0,i=n.sourceEndpoint.connectorOverlays.length;i>o;o++)n.overlays.push(n.sourceEndpoint.connectorOverlays[o])}if(!n["pointer-events"]&&n.sourceEndpoint&&n.sourceEndpoint.connectorPointerEvents&&(n["pointer-events"]=n.sourceEndpoint.connectorPointerEvents),n.target&&!n.target.endpoint&&!n.targetEndpoint&&!n.newConnection){var o=Z(n.target),i=ue[o],r=ce[o];if(i){if(!Pe[o])return;i=null!=r?r:v.addEndpoint(n.target,i),de[o]&&(ce[o]=i),n.targetEndpoint=i,i._makeTargetCreator=!0,n.targetIsNew=!0}}if(n.source&&!n.source.endpoint&&!n.sourceEndpoint&&!n.newConnection&&(o=Z(n.source),i=fe[o],r=me[o],i)){if(!ve[o])return;i=null!=r?r:v.addEndpoint(n.source,i),ge[o]&&(me[o]=i),n.sourceEndpoint=i,n.sourceIsNew=!0}return n},Y=function(t){var e=v.Defaults.ConnectionType||v.getDefaultConnectionType(),n=v.Defaults.EndpointType||m.Endpoint,o=m.CurrentLibrary.getParent;return t.parent=t.container?t.container:t.sourceEndpoint?t.sourceEndpoint.parent:t.source.constructor==n?t.source.parent:o(t.source),t._jsPlumb=v,t.newConnection=Y,t.newEndpoint=z,t.endpointsByUUID=D,t.endpointsByElement=w,t.finaliseConnection=R,t=new e(t),t.id="con_"+F(),B("click","click",t),B("dblclick","dblclick",t),B("contextmenu","contextmenu",t),t},R=function(t,e,o){e=e||{},t.suspendedEndpoint||n(_,t.scope,t),v.anchorManager.newConnection(t),N(t.source),e.doNotFireConnectionEvent||!1===e.fireEvent||(t={connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]},v.fire("jsPlumbConnection",t,o),v.fire("connection",t,o))},B=function(t,e,n){n.bind(t,function(t,o){v.fire(e,n,o)})},V=function(t){if(t.container)return t.container;var e=m.CurrentLibrary.getTagName(t.source);return t=m.CurrentLibrary.getParent(t.source),e&&"td"===e.toLowerCase()?m.CurrentLibrary.getParent(t):t},z=function(t){var e=v.Defaults.EndpointType||m.Endpoint,n=m.extend({},t);return n.parent=V(n),n._jsPlumb=v,n.newConnection=Y,n.newEndpoint=z,n.endpointsByUUID=D,n.endpointsByElement=w,n.finaliseConnection=R,n.fireDetachEvent=J,n.floatingConnections=L,n.getParentFromParams=V,n.connectionsByScope=_,e=new e(n),e.id="ep_"+F(),B("click","endpointClick",e),B("dblclick","endpointDblClick",e),B("contextmenu","contextmenu",e),jsPlumbAdapter.headless||v.dragManager.endpointAdded(t.source),e},$=function(t,e,n){if((t=w[t])&&t.length)for(var o=0,i=t.length;i>o;o++){for(var r=0,s=t[o].connections.length;s>r;r++)if(e(t[o].connections[r]))return;n&&n(t[o])}},q=function(t,e,n){e="block"===e;var o=null;n&&(o=e?function(t){t.setVisible(!0,!0,!0)}:function(t){t.setVisible(!1,!0,!0)});var i=s(t,"id");$(i,function(t){e&&n?t.endpoints[t.sourceId===i?1:0].isVisible()&&t.setVisible(!0):t.setVisible(e)},o)},G=function(t){var e=t.timestamp,n=t.recalc,o=t.offset;return t=t.elId,Se&&!e&&(e=je),!n&&e&&e===k[t]?{o:A[t],s:O[t]}:(n||!o?(n=a(t),null!=n&&(O[t]=m.CurrentLibrary.getSize(a(n)),A[t]=l(n,v),k[t]=e)):(A[t]=o,null==O[t]&&(n=a(t),null!=n&&(O[t]=m.CurrentLibrary.getSize(a(n))))),A[t]&&!A[t].right&&(A[t].right=A[t].left+O[t][0],A[t].bottom=A[t].top+O[t][1],A[t].width=O[t][0],A[t].height=O[t][1],A[t].centerx=A[t].left+A[t].width/2,A[t].centery=A[t].top+A[t].height/2),{o:A[t],s:O[t]})},Z=function(t,e,n){var o=a(t),i=s(o,"id");if(!(i&&"undefined"!=i||(2==arguments.length&&void 0!=arguments[1]?i=e:(1==arguments.length||3==arguments.length&&!arguments[2])&&(i="jsPlumb_"+y+"_"+F()),n))){var r=i;m.CurrentLibrary.setAttribute(a(o),"id",r)}return i},K=function(t,e,n){return t=t||function(){},e=e||function(){},function(){var o=null;try{o=e.apply(this,arguments)}catch(r){u(v,"jsPlumb function failed : "+r)}if(null==n||o!==n)try{t.apply(this,arguments)}catch(i){u(v,"wrapped function failed : "+i)}return o}};this.isConnectionBeingDragged=function(){return null!=j},this.setConnectionBeingDragged=function(t){j=t},this.connectorClass="_jsPlumb_connector",this.hoverClass="_jsPlumb_hover",this.endpointClass="_jsPlumb_endpoint",this.endpointConnectedClass="_jsPlumb_endpoint_connected",this.endpointFullClass="_jsPlumb_endpoint_full",this.endpointDropAllowedClass="_jsPlumb_endpoint_drop_allowed",this.endpointDropForbiddenClass="_jsPlumb_endpoint_drop_forbidden",this.overlayClass="_jsPlumb_overlay",this.draggingClass="_jsPlumb_dragging",this.elementDraggingClass="_jsPlumb_element_dragging",this.sourceElementDraggingClass="_jsPlumb_source_element_dragging",this.targetElementDraggingClass="_jsPlumb_target_element_dragging",this.endpointAnchorClassPrefix="_jsPlumb_endpoint_anchor",this.Anchors={},this.Connectors={canvas:{},svg:{},vml:{}},this.Endpoints={canvas:{},svg:{},vml:{}},this.Overlays={canvas:{},svg:{},vml:{}},this.ConnectorRenderers={},this.addClass=function(t,e){return m.CurrentLibrary.addClass(t,e)},this.removeClass=function(t,e){return m.CurrentLibrary.removeClass(t,e)},this.hasClass=function(t,e){return m.CurrentLibrary.hasClass(t,e)},this.addEndpoint=function(t,e,r){r=r||{},r=m.extend({},r),m.extend(r,e),r.endpoint=r.endpoint||v.Defaults.Endpoint||m.Defaults.Endpoint,r.paintStyle=r.paintStyle||v.Defaults.EndpointStyle||m.Defaults.EndpointStyle,t=t._nodes?t._nodes:t,e=[],t=o(t)||null!=t.length&&!i(t)?t:[t];for(var s=0,l=t.length;l>s;s++){var u=a(t[s]),c=Z(u);r.source=u,G({elId:c,timestamp:je}),u=z(r),r.parentAnchor&&(u.parentAnchor=r.parentAnchor),n(w,c,u);var d=A[c],c={anchorLoc:u.anchor.compute({xy:[d.left,d.top],wh:O[c],element:u,timestamp:je}),timestamp:je};Se&&(c.recalc=!1),Se||u.paint(c),e.push(u)}return 1==e.length?e[0]:e},this.addEndpoints=function(t,e,n){for(var i=[],r=0,s=e.length;s>r;r++){var a=v.addEndpoint(t,e[r],n);o(a)?Array.prototype.push.apply(i,a):i.push(a)}return i},this.animate=function(t,e,n){var o=a(t),i=s(t,"id");n=n||{},t=m.CurrentLibrary.dragEvents.step;var r=m.CurrentLibrary.dragEvents.complete;n[t]=K(n[t],function(){v.repaint(i)}),n[r]=K(n[r],function(){v.repaint(i)}),m.CurrentLibrary.animate(o,e,n)},this.checkCondition=function(t,e){var n=v.getListener(t),o=!0;if(n&&0<n.length)try{for(var i=0,r=n.length;r>i;i++)o=o&&n[i](e)}catch(s){u(v,"cannot check condition ["+t+"]"+s)}return o},this.checkASyncCondition=function(t,e,n,o){var i=v.getListener(t);if(i&&0<i.length)try{i[0](e,n,o)}catch(i){u(v,"cannot asynchronously check condition ["+t+"]"+i)}},this.connect=function(t,e){var n,o=X(t,e);return o&&(null==o.deleteEndpointsOnDetach&&(o.deleteEndpointsOnDetach=!0),n=Y(o),R(n,o)),n},this.deleteEndpoint=function(t,e){v.doWhileSuspended(function(){var e="string"==typeof t?D[t]:t;if(e){var n=e.getUuid();n&&(D[n]=null),e.detachAll().cleanup(),e.endpoint.cleanup&&e.endpoint.cleanup(),jsPlumbUtil.removeElements(e.endpoint.getDisplayElements()),v.anchorManager.deleteEndpoint(e);for(var o in w){if(n=w[o]){for(var i=[],r=0,s=n.length;s>r;r++)n[r]!=e&&i.push(n[r]);w[o]=i}1>w[o].length&&delete w[o]}jsPlumbAdapter.headless||v.dragManager.endpointDeleted(e)}return v},e)},this.deleteEveryEndpoint=function(){return v.doWhileSuspended(function(){for(var t in w){var e=w[t];if(e&&e.length)for(var n=0,o=e.length;o>n;n++)v.deleteEndpoint(e[n],!0)}w={},D={},v.anchorManager.reset(),v.dragManager.reset()}),v};var J=function(t,e,n){var o=v.Defaults.ConnectionType||v.getDefaultConnectionType();t=t.constructor==o?{connection:t,source:t.source,target:t.target,sourceId:t.sourceId,targetId:t.targetId,sourceEndpoint:t.endpoints[0],targetEndpoint:t.endpoints[1]}:t,e&&(v.fire("jsPlumbConnectionDetached",t,n),v.fire("connectionDetached",t,n)),v.anchorManager.connectionDetached(t)};this.detach=function(){if(0!=arguments.length){var t=v.Defaults.ConnectionType||v.getDefaultConnectionType(),e=arguments[0].constructor==t,t=2==arguments.length?e?arguments[1]||{}:arguments[0]:arguments[0],n=!1!==t.fireEvent,o=t.forceDetach;if(e=e?arguments[0]:t.connection)(o||jsPlumbUtil.functionChain(!0,!1,[[e.endpoints[0],"isDetachAllowed",[e]],[e.endpoints[1],"isDetachAllowed",[e]],[e,"isDetachAllowed",[e]],[v,"checkCondition",["beforeDetach",e]]]))&&e.endpoints[0].detach(e,!1,!0,n);else if(t=m.extend({},t),t.uuids)D[t.uuids[0]].detachFrom(D[t.uuids[1]],n);else if(t.sourceEndpoint&&t.targetEndpoint)t.sourceEndpoint.detachFrom(t.targetEndpoint);else{var i=Z(t.source),r=Z(t.target);$(i,function(t){(t.sourceId==i&&t.targetId==r||t.targetId==i&&t.sourceId==r)&&v.checkCondition("beforeDetach",t)&&t.endpoints[0].detach(t,!1,!0,n)})}}},this.detachAllConnections=function(t,e){e=e||{},t=a(t);var n=s(t,"id");if((n=w[n])&&n.length)for(var o=0,i=n.length;i>o;o++)n[o].detachAll(e.fireEvent);return v},this.detachEveryConnection=function(t){t=t||{};for(var e in w){var n=w[e];if(n&&n.length)for(var o=0,i=n.length;i>o;o++)n[o].detachAll(t.fireEvent)}return _={},v},this.draggable=function(t,e){if("object"==typeof t&&t.length)for(var n=0,o=t.length;o>n;n++){var i=a(t[n]);i&&H(i,!0,e)}else if(t._nodes)for(n=0,o=t._nodes.length;o>n;n++)(i=a(t._nodes[n]))&&H(i,!0,e);else(i=a(t))&&H(i,!0,e);return v},this.extend=function(t,e){return m.CurrentLibrary.extend(t,e)},this.getDefaultEndpointType=function(){return m.Endpoint},this.getDefaultConnectionType=function(){return m.Connection};var Q=function(t,e,n){return function(){for(var o=arguments,i=0,r=t.length;r>i;i++)t[i][e].apply(t[i],o);return n(t)}},te=function(t,e){return function(){for(var n=arguments,o=[],i=0,r=t.length;r>i;i++)o.push([t[i][e].apply(t[i],n),t[i]]);return o}},ee=function(t,e){var n=[];if(t)if("string"==typeof t){if("*"===t)return t;n.push(t)}else if(e)n=t;else for(var o=0,i=t.length;i>o;o++)n.push(Z(a(t[o])));return n},ne=function(e,n,o){return"*"===e?!0:0<e.length?-1!=t(e,n):!o};this.getConnections=function(t,e){t?t.constructor==String&&(t={scope:t}):t={};var n,o=t.scope||v.getDefaultScope(),o=ee(o,!0),i=ee(t.source),r=ee(t.target),s=!e&&1<o.length?{}:[];for(n in _)if(ne(o,n))for(var a=0,l=_[n].length;l>a;a++){var u=_[n][a];if(ne(i,u.sourceId)&&ne(r,u.targetId))if(!e&&1<o.length){var c=s[n];null==c&&(c=[],s[n]=c),c.push(u)}else s.push(u)}return s};var oe=function(t,e){return function(n){for(var o=0,i=t.length;i>o;o++)n(t[o]);return e(t)}},ie=function(t){return function(e){return t[e]}},re=function(t,e){for(var n={length:t.length,each:oe(t,e),get:ie(t)},o="setHover removeAllOverlays setLabel addClass addOverlay removeOverlay removeOverlays showOverlay hideOverlay showOverlays hideOverlays setPaintStyle setHoverPaintStyle setSuspendEvents setParameter setParameters setVisible repaint addType toggleType removeType removeClass setType bind unbind".split(" "),i="getLabel getOverlay isHover getParameter getParameters getPaintStyle getHoverPaintStyle isVisible hasType getType isSuspendEvents".split(" "),r=0,s=o.length;s>r;r++)n[o[r]]=Q(t,o[r],e);for(r=0,s=i.length;s>r;r++)n[i[r]]=te(t,i[r]);return n},se=function(t){var e=re(t,se);return m.CurrentLibrary.extend(e,{setDetachable:Q(t,"setDetachable",se),setReattach:Q(t,"setReattach",se),setConnector:Q(t,"setConnector",se),detach:function(){for(var e=0,n=t.length;n>e;e++)v.detach(t[e])},isDetachable:te(t,"isDetachable"),isReattach:te(t,"isReattach")})},ae=function(t){var e=re(t,ae);return m.CurrentLibrary.extend(e,{setEnabled:Q(t,"setEnabled",ae),setAnchor:Q(t,"setAnchor",ae),isEnabled:te(t,"isEnabled"),detachAll:function(){for(var e=0,n=t.length;n>e;e++)t[e].detachAll()},remove:function(){for(var e=0,n=t.length;n>e;e++)v.deleteEndpoint(t[e])}})};this.select=function(t){return t=t||{},t.scope=t.scope||"*",t=t.connections||v.getConnections(t,!0),se(t)},this.selectEndpoints=function(t){t=t||{},t.scope=t.scope||"*";var e=!t.element&&!t.source&&!t.target,n=e?"*":ee(t.element),o=e?"*":ee(t.source),e=e?"*":ee(t.target);t=ee(t.scope,!0);var i,r=[];for(i in w){var s=ne(n,i,!0),a=ne(o,i,!0),l="*"!=o,u=ne(e,i,!0),c="*"!=e;if(s||a||u)t:for(s=0,a=w[i].length;a>s;s++)if(u=w[i][s],ne(t,u.scope,!0)){var d=c&&0<e.length&&!u.isTarget;if(l&&0<o.length&&!u.isSource||d)continue t;r.push(u)}}return ae(r)},this.getAllConnections=function(){return _},this.getDefaultScope=function(){return M},this.getEndpoint=function(t){return D[t]},this.getEndpoints=function(t){return w[Z(t)]},this.getId=Z,this.getOffset=function(t){return A[t],G({elId:t})},this.getSelector=function(){return m.CurrentLibrary.getSelector.apply(null,arguments)
},this.getSize=function(t){return O[t]||G({elId:t}),O[t]},this.appendElement=function(t,e){v.Defaults.Container?m.CurrentLibrary.appendElement(t,v.Defaults.Container):e?m.CurrentLibrary.appendElement(t,e):jsPlumbAdapter.appendToRoot(t)};var le=!1;this.isHoverSuspended=function(){return le},this.setHoverSuspended=function(t){le=t},h=function(t){return function(){return jsPlumbAdapter.isRenderModeAvailable(t)}},this.isCanvasAvailable=h("canvas"),this.isSVGAvailable=h("svg"),this.isVMLAvailable=h("vml"),this.hide=function(t,e){return q(t,"none",e),v},this.idstamp=F,this.init=function(){S||(v.anchorManager=new m.AnchorManager({jsPlumbInstance:v}),v.setRenderMode(v.Defaults.RenderMode),S=!0,v.fire("ready",v))},this.log=x,this.jsPlumbUIComponent=d,this.makeAnchor=function(){var t=function(t,e){if(m.Anchors[t])return new m.Anchors[t](e);if(!v.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown anchor type '"+t+"'"}};if(0==arguments.length)return null;var e=arguments[0],n=arguments[1],s=arguments[2],a=null;if(e.compute&&e.getOrientation)return e;if("string"==typeof e)a=t(arguments[0],{elementId:n,jsPlumbInstance:v});else if(o(e))if(o(e[0])||i(e[0]))2==e.length&&i(e[0])&&r(e[1])?(n=m.extend({elementId:n,jsPlumbInstance:v},e[1]),a=t(e[0],n)):a=new m.DynamicAnchor({anchors:e,selector:null,elementId:n,jsPlumbInstance:s});else{var l={x:e[0],y:e[1],orientation:4<=e.length?[e[2],e[3]]:[0,0],offsets:6<=e.length?[e[4],e[5]]:[0,0],elementId:n,jsPlumbInstance:s,cssClass:7==e.length?e[6]:null},a=new m.Anchor(l);a.clone=function(){return new m.Anchor(l)}}return a.id||(a.id="anchor_"+F()),a},this.makeAnchors=function(t,e,n){for(var i=[],r=0,s=t.length;s>r;r++)"string"==typeof t[r]?i.push(m.Anchors[t[r]]({elementId:e,jsPlumbInstance:n})):o(t[r])&&i.push(v.makeAnchor(t[r],e,n));return i},this.makeDynamicAnchor=function(t,e){return new m.DynamicAnchor({anchors:t,selector:e,elementId:null,jsPlumbInstance:v})};var ue={},ce={},de={},he={},pe=function(t,e){t.paintStyle=t.paintStyle||v.Defaults.EndpointStyles[e]||v.Defaults.EndpointStyle||m.Defaults.EndpointStyles[e]||m.Defaults.EndpointStyle,t.hoverPaintStyle=t.hoverPaintStyle||v.Defaults.EndpointHoverStyles[e]||v.Defaults.EndpointHoverStyle||m.Defaults.EndpointHoverStyles[e]||m.Defaults.EndpointHoverStyle,t.anchor=t.anchor||v.Defaults.Anchors[e]||v.Defaults.Anchor||m.Defaults.Anchors[e]||m.Defaults.Anchor,t.endpoint=t.endpoint||v.Defaults.Endpoints[e]||v.Defaults.Endpoint||m.Defaults.Endpoints[e]||m.Defaults.Endpoint};this.makeTarget=function(t,e,n){var o=m.extend({_jsPlumb:v},n);m.extend(o,e),pe(o,1);var i=m.CurrentLibrary,r=o.scope||v.Defaults.Scope,u=!1!==o.deleteEndpointsOnDetach,c=o.maxConnections||-1,h=o.onMaxConnections;for(_doOne=function(t){var e=Z(t);ue[e]=o,de[e]=o.uniqueEndpoint,he[e]=c,Pe[e]=!0,proxyComponent=new d(o);var n=m.extend({},o.dropOptions||{}),p=i.dragEvents.drop;n.scope=n.scope||r,n[p]=K(n[p],function(){var n=m.CurrentLibrary.getDropEvent(arguments),r=v.select({target:e}).length;v.currentlyDragging=!1;var c=a(i.getDragObject(arguments)),d=s(c,"dragId"),p=s(c,"originalScope"),d=L[d],f=d.endpoints[0];if(o.endpoint?m.extend({},o.endpoint):{},!Pe[e]||0<he[e]&&r>=he[e])return h&&h({element:t,connection:d},n),!1;if(f.anchor.locked=!1,p&&i.setDragScope(c,p),r=proxyComponent.isDropAllowed(d.sourceId,Z(t),d.scope,d,null),d.endpointsToDeleteOnDetach&&(f===d.endpointsToDeleteOnDetach[0]?d.endpointsToDeleteOnDetach[0]=null:f===d.endpointsToDeleteOnDetach[1]&&(d.endpointsToDeleteOnDetach[1]=null)),d.suspendedEndpoint&&(d.targetId=d.suspendedEndpoint.elementId,d.target=i.getElementObject(d.suspendedEndpoint.elementId),d.endpoints[1]=d.suspendedEndpoint),r){if(f.detach(d,!1,!0,!1),n=ce[e]||v.addEndpoint(t,o),o.uniqueEndpoint&&(ce[e]=n),n._makeTargetCreator=!0,null!=n.anchor.positionFinder){var r=i.getUIPosition(arguments,v.getZoom()),c=l(t,v),g=m.CurrentLibrary.getSize(a(t)),r=n.anchor.positionFinder(r,c,g,n.anchor.constructorParams);n.anchor.x=r[0],n.anchor.y=r[1]}p=v.connect({source:f,target:n,scope:p,previousConnection:d,container:d.parent,deleteEndpointsOnDetach:u,endpointsToDeleteOnDetach:u?[f,n]:null,doNotFireConnectionEvent:f.endpointWillMoveAfterConnection}),d.endpoints[1]._makeTargetCreator&&2>d.endpoints[1].connections.length&&v.deleteEndpoint(d.endpoints[1]),p.repaint()}else d.suspendedEndpoint&&(d.isReattach()?(d.setHover(!1),d.floatingAnchorIndex=null,d.suspendedEndpoint.addConnection(d),v.repaint(f.elementId)):f.detach(d,!1,!0,!0,n))}),i.initDroppable(t,n,!0)},t=t._nodes?t._nodes:t,t=t.length&&t.constructor!=String?t:[t],e=0,n=t.length;n>e;e++)_doOne(a(t[e]));return v},this.unmakeTarget=function(t,e){t=m.CurrentLibrary.getElementObject(t);var n=Z(t);return e||(delete ue[n],delete de[n],delete he[n],delete Pe[n]),v},this.makeTargets=function(t,e,n){for(var o=0,i=t.length;i>o;o++)v.makeTarget(t[o],e,n)};var fe={},me={},ge={},ve={},ye={},be={},Pe={},Ce=function(t,e,n){t=t.target||t.srcElement;var o=!1;for(e=v.getSelector(e,n),n=0;n<e.length;n++)if(e[n]==t){o=!0;break}return o};this.makeSource=function(t,n,o){var i=m.extend({},o);m.extend(i,n),pe(i,0);var r=m.CurrentLibrary,s=i.maxConnections||-1,l=i.onMaxConnections;n=function(t){var n=Z(t),o=function(){return null==i.parent?i.parent:r.getElementObject("parent"===i.parent?r.getDOMElement(t).parentNode:i.parent)},a=null!=i.parent?v.getId(o()):n;fe[a]=i,ge[a]=i.uniqueEndpoint,ve[a]=!0;var u=r.dragEvents.stop,c=r.dragEvents.drag,d=m.extend({},i.dragOptions||{}),h=d.drag,p=d.stop,f=null,g=!1;be[a]=s,d.scope=d.scope||i.scope,d[c]=K(d[c],function(){h&&h.apply(this,arguments),g=!1}),d[u]=K(d[u],function(){if(p&&p.apply(this,arguments),v.currentlyDragging=!1,0==f.connections.length)v.deleteEndpoint(f);else{r.unbind(f.canvas,"mousedown");var t=i.anchor||v.Defaults.Anchor,s=(f.anchor,f.connections[0]);if(f.setAnchor(v.makeAnchor(t,n,v)),i.parent&&(t=o())){var a=f.elementId;f.setElement(t,i.container||v.Defaults.Container||m.Defaults.Container),f.endpointWillMoveAfterConnection=!1,v.anchorManager.rehomeEndpoint(a,t),s.previousConnection=null,e(_[s.scope],function(t){return t.id===s.id}),v.anchorManager.connectionDetached({sourceId:s.sourceId,targetId:s.targetId,connection:s}),R(s)}f.repaint(),v.repaint(f.elementId),v.repaint(s.targetId)}}),u=function(e){if(ve[a]){if(i.filter){var u=r.getOriginalEvent(e);if(!1===(jsPlumbUtil.isString(i.filter)?Ce(u,t,i.filter):i.filter(u,t)))return}if(u=v.select({source:a}).length,0<=be[a]&&u>=be[a])return l&&l({element:t,maxConnections:s},e),!1;var c=G({elId:n}).o,h=v.getZoom(),u=((e.pageX||e.page.x)/h-c.left)/c.width,h=((e.pageY||e.page.y)/h-c.top)/c.height,p=u,y=h;i.parent&&(p=o(),p=Z(p),c=G({elId:p}).o,p=((e.pageX||e.page.x)-c.left)/c.width,y=((e.pageY||e.page.y)-c.top)/c.height),c={},m.extend(c,i),c.isSource=!0,c.anchor=[u,h,0,0],c.parentAnchor=[p,y,0,0],c.dragOptions=d,i.parent&&(u=c.container||v.Defaults.Container||m.Defaults.Container,c.container=u?u:m.CurrentLibrary.getParent(o())),f=v.addEndpoint(n,c),g=!0,f.endpointWillMoveAfterConnection=null!=i.parent,f.endpointWillMoveTo=i.parent?o():null,f.addedViaMouse=!0,u=function(){g&&v.deleteEndpoint(f)},v.registerListener(f.canvas,"mouseup",u),v.registerListener(t,"mouseup",u),r.trigger(f.canvas,"mousedown",e)}},v.registerListener(t,"mousedown",u),ye[n]=u,i.filter&&jsPlumbUtil.isString(i.filter)&&r.setDragFilter(t,i.filter)},t=t._nodes?t._nodes:t,t=t.length&&t.constructor!=String?t:[t],o=0;for(var u=t.length;u>o;o++)n(a(t[o]));return v},this.unmakeSource=function(t,e){t=m.CurrentLibrary.getElementObject(t);var n=Z(t),o=ye[n];return o&&v.unregisterListener(t,"mousedown",o),e||(delete fe[n],delete ge[n],delete ve[n],delete ye[n],delete be[n]),v},this.unmakeEverySource=function(){for(var t in ve)v.unmakeSource(t,!0);fe={},ge={},ve={},ye={}},this.unmakeEveryTarget=function(){for(var t in Pe)v.unmakeTarget(t,!0);return ue={},de={},he={},Pe={},v},this.makeSources=function(t,e,n){for(var o=0,i=t.length;i>o;o++)v.makeSource(t[o],e,n);return v};var Ee=function(t,e,n,o){if(t="source"==t?ve:Pe,i(e))t[e]=o?!t[e]:n;else if(e.length){e=e._nodes?e._nodes:e;for(var r=0,s=e.length;s>r;r++){var a=_el=m.CurrentLibrary.getElementObject(e[r]),a=Z(_el);t[a]=o?!t[a]:n}}return v};this.setSourceEnabled=function(t,e){return Ee("source",t,e)},this.toggleSourceEnabled=function(t){return Ee("source",t,null,!0),v.isSourceEnabled(t)},this.isSource=function(t){return t=m.CurrentLibrary.getElementObject(t),null!=ve[Z(t)]},this.isSourceEnabled=function(t){return t=m.CurrentLibrary.getElementObject(t),!0===ve[Z(t)]},this.setTargetEnabled=function(t,e){return Ee("target",t,e)},this.toggleTargetEnabled=function(t){return Ee("target",t,null,!0),v.isTargetEnabled(t)},this.isTarget=function(t){return t=m.CurrentLibrary.getElementObject(t),null!=Pe[Z(t)]},this.isTargetEnabled=function(t){return t=m.CurrentLibrary.getElementObject(t),!0===Pe[Z(t)]},this.ready=function(t){v.bind("ready",t)},this.repaint=function(t,e,n){if("object"==typeof t&&t.length)for(var o=0,i=t.length;i>o;o++)N(a(t[o]),e,n);else N(a(t),e,n);return v},this.repaintEverything=function(){for(var t in w)N(a(t),null,null);return v},this.removeAllEndpoints=function(t,e){var n=function(t){var o=jsPlumbUtil.isString(t)?t:Z(a(t)),i=w[o];if(i)for(var r=0,s=i.length;s>r;r++)v.deleteEndpoint(i[r]);if(delete w[o],e&&(t=m.CurrentLibrary.getDOMElement(a(t)))&&3!=t.nodeType&&8!=t.nodeType)for(r=0,s=t.childNodes.length;s>r;r++)n(t.childNodes[r])};return n(t),v},this.remove=function(t){var e=a(t),n=jsPlumbUtil.isString(t)?t:Z(e);v.doWhileSuspended(function(){v.removeAllEndpoints(n,!0),v.dragManager.elementRemoved(n)}),m.CurrentLibrary.removeElement(e)};var xe={};this.registerListener=function(t,e,o){m.CurrentLibrary.bind(t,e,o),n(xe,e,{el:t,event:e,listener:o})},this.unregisterListener=function(t,n,o){m.CurrentLibrary.unbind(t,n,o),e(xe,function(t){return t.type==n&&t.listener==o})},this.reset=function(){v.deleteEveryEndpoint(),v.unbind(),ue={},ce={},de={},he={},fe={},me={},ge={},be={};for(var t in xe)for(var e=0,n=xe[t].length;n>e;e++){var o=xe[t][e];m.CurrentLibrary.unbind(o.el,o.event,o.listener)}xe={},v.anchorManager.reset(),jsPlumbAdapter.headless||v.dragManager.reset()},this.setDefaultScope=function(t){return M=t,v},this.setDraggable=function(t,e){return W(t,function(t,n){I[n]=e,m.CurrentLibrary.isDragSupported(t)&&m.CurrentLibrary.setDraggable(t,e)})},this.setId=function(t,e,n){var o=t.constructor==String?t:v.getId(t),i=v.getConnections({source:o,scope:"*"},!0),r=v.getConnections({target:o,scope:"*"},!0);e=""+e,n||(t=m.CurrentLibrary.getElementObject(o),m.CurrentLibrary.setAttribute(t,"id",e)),t=m.CurrentLibrary.getElementObject(e),w[e]=w[o]||[],n=0;for(var s=w[e].length;s>n;n++)w[e][n].setElementId(e),w[e][n].setReferenceElement(t);delete w[o],v.anchorManager.changeId(o,e),jsPlumbAdapter.headless||v.dragManager.changeId(o,e),o=function(n,o,i){for(var r=0,s=n.length;s>r;r++)n[r].endpoints[o].setElementId(e),n[r].endpoints[o].setReferenceElement(t),n[r][i+"Id"]=e,n[r][i]=t},o(i,0,"source"),o(r,1,"target"),v.repaint(e)},this.setIdChanged=function(t,e){v.setId(t,e,!0)},this.setDebugLog=function(t){x=t};var Se=!1,je=null;this.setSuspendDrawing=function(t,e){je=(Se=t)?(new Date).getTime():null,e&&v.repaintEverything()},this.isSuspendDrawing=function(){return Se},this.getSuspendedAt=function(){return je},this.doWhileSuspended=function(t,e){v.setSuspendDrawing(!0);try{t()}catch(n){u("Function run while suspended failed",n)}v.setSuspendDrawing(!1,!e)},this.updateOffset=G,this.getOffset=function(t){return A[t]},this.getSize=function(t){return O[t]},this.getCachedData=function(t){var e=A[t];return e?{o:e,s:O[t]}:G({elId:t})},this.timestamp=c,this.SVG="svg",this.CANVAS="canvas",this.VML="vml",this.setRenderMode=function(t){return T=jsPlumbAdapter.setRenderMode(t)},this.getRenderMode=function(){return T},this.show=function(t,e){return q(t,"block",e),v},this.sizeCanvas=function(t,e,n,o,i){return t&&(t.style.height=i+"px",t.height=i,t.style.width=o+"px",t.width=o,t.style.left=e+"px",t.style.top=n+"px"),v},this.getTestHarness=function(){return{endpointsByElement:w,endpointCount:function(t){return(t=w[t])?t.length:0},connectionCount:function(t){return t=t||M,(t=_[t])?t.length:0},getId:Z,makeAnchor:self.makeAnchor,makeDynamicAnchor:self.makeDynamicAnchor}},this.toggleVisible=function(t,e){var n=null;e&&(n=function(t){var e=t.isVisible();t.setVisible(!e)}),$(t,function(t){var e=t.isVisible();t.setVisible(!e)},n)},this.toggleDraggable=function(t){return W(t,function(t,e){var n=null==I[e]?!1:I[e];return n=!n,I[e]=n,m.CurrentLibrary.setDraggable(t,n),n})},this.wrap=K,this.addListener=this.bind,this.adjustForParentOffsetAndScroll=function(t,e){var n=null;if("svg"===e.tagName.toLowerCase()&&e.parentNode?n=e.parentNode:e.offsetParent&&(n=e.offsetParent),null!=n){var o="body"===n.tagName.toLowerCase()?{left:0,top:0}:l(n,v),n="body"===n.tagName.toLowerCase()?{left:0,top:0}:{left:n.scrollLeft,top:n.scrollTop};t[0]=t[0]-o.left+n.left,t[1]=t[1]-o.top+n.top}return t},jsPlumbAdapter.headless||(v.dragManager=jsPlumbAdapter.getDragManager(v),v.recalculateOffsets=v.dragManager.updateOffsets)},m=new f;"undefined"!=typeof window&&(window.jsPlumb=m),m.getInstance=function(t){return t=new f(t),t.init(),t},"function"==typeof define&&define("lib/jquery-jsplumb",["lib/jquery-ui"],function(){return m})}(),function(){jsPlumb.AnchorManager=function(t){var e={},n={},o={},i={},r={},s={},a=this,l={},u=t.jsPlumbInstance,c=jsPlumb.CurrentLibrary,d={},h=function(t,e,n,o,i,r){if(t===e)return{orientation:"identity",a:["top","top"]};var s=Math.atan2(o.centery-n.centery,o.centerx-n.centerx),a=Math.atan2(n.centery-o.centery,n.centerx-o.centerx);return t=n.left<=o.left&&n.right>=o.left||n.left<=o.right&&n.right>=o.right||n.left<=o.left&&n.right>=o.right||o.left<=n.left&&o.right>=n.right,e=n.top<=o.top&&n.bottom>=o.top||n.top<=o.bottom&&n.bottom>=o.bottom||n.top<=o.top&&n.bottom>=o.bottom||o.top<=n.top&&o.bottom>=n.bottom,s={orientation:"diagonal",theta:s,theta2:a},t||e?t?(s.orientation="horizontal",s.a=n.top<o.top?["bottom","top"]:["top","bottom"]):(s.orientation="vertical",s.a=n.left<o.left?["right","left"]:["left","right"]):o.left>n.left&&o.top>n.top?s.a=["right","top"]:o.left>n.left&&n.top>o.top?s.a=["top","left"]:o.left<n.left&&o.top<n.top?s.a=["top","right"]:o.left<n.left&&o.top>n.top&&(s.a=["left","top"]),s.a=[i.isContinuous?i.verifyEdge(s.a[0]):s.a[0],r.isContinuous?r.verifyEdge(s.a[1]):s.a[1]],s},p=function(t,e,n,o,i,r,s){t=[];for(var a=e[i?0:1]/(o.length+1),l=0;l<o.length;l++){var u=(l+1)*a,c=r*e[i?1:0];s&&(u=e[i?0:1]-u);var d=i?u:c,u=i?c:u;t.push([n[0]+d,n[1]+u,d/e[0],u/e[1],o[l][1],o[l][2]])}return t},f=function(t){return function(e,n){var o=!0;return o=t?e[0][0]<n[0][0]:e[0][0]>n[0][0],!1===o?-1:1}},m={top:function(t,e){return t[0]>e[0]?1:-1},right:f(!0),bottom:f(!0),left:function(t,e){return(0>t[0][0]?-Math.PI-t[0][0]:Math.PI-t[0][0])>(0>e[0][0]?-Math.PI-e[0][0]:Math.PI-e[0][0])?1:t[0][1]>e[0][1]?1:-1}},g=function(t,e){var n=u.getCachedData(t),i=n.s,n=n.o,s=function(e,n,i,s,a,l,c){if(0<s.length)for(s=s.sort(m[e]),e=p(e,n,i,s,a,l,"right"===e||"top"===e),n=function(t,e){var n=u.adjustForParentOffsetAndScroll([e[0],e[1]],t.canvas);o[t.id]=[n[0],n[1],e[2],e[3]],r[t.id]=c},i=0;i<e.length;i++)a=e[i][4],l=a.endpoints[1].elementId===t,a.endpoints[0].elementId===t?n(a.endpoints[0],e[i]):l&&n(a.endpoints[1],e[i])};s("bottom",i,[n.left,n.top],e.bottom,!0,1,[0,1]),s("top",i,[n.left,n.top],e.top,!0,0,[0,-1]),s("left",i,[n.left,n.top],e.left,!1,0,[-1,0]),s("right",i,[n.left,n.top],e.right,!1,1,[1,0])};this.reset=function(){e={},s={},l={}},this.addFloatingConnection=function(t,e){d[t]=e},this.removeFloatingConnection=function(t){delete d[t]},this.newConnection=function(t){var e=t.sourceId,n=t.targetId,o=t.endpoints,i=!0,r=function(t,r,a,l,u){e==n&&a.isContinuous&&(c.removeElement(o[1].canvas),i=!1),jsPlumbUtil.addToList(s,l,[u,r,a.constructor==jsPlumb.DynamicAnchor])};r(0,o[0],o[0].anchor,n,t),i&&r(1,o[1],o[1].anchor,e,t)};var v=function(t){!function(t,e){if(t){var n=function(t){return t[4]==e};jsPlumbUtil.removeWithFunction(t.top,n),jsPlumbUtil.removeWithFunction(t.left,n),jsPlumbUtil.removeWithFunction(t.bottom,n),jsPlumbUtil.removeWithFunction(t.right,n)}}(l[t.elementId],t.id)};this.connectionDetached=function(t){var e=t.connection||t,n=t.targetId,o=e.endpoints,i=function(t,e,n,o,i){n.constructor==jsPlumb.FloatingAnchor||jsPlumbUtil.removeWithFunction(s[o],function(t){return t[0].id==i.id})};i(1,o[1],o[1].anchor,t.sourceId,e),i(0,o[0],o[0].anchor,n,e),v(e.endpoints[0]),v(e.endpoints[1]),a.redraw(e.sourceId),a.redraw(e.targetId)},this.add=function(t,n){jsPlumbUtil.addToList(e,n,t)},this.changeId=function(t,n){s[n]=s[t],e[n]=e[t],delete s[t],delete e[t]},this.getConnectionsFor=function(t){return s[t]||[]},this.getEndpointsFor=function(t){return e[t]||[]},this.deleteEndpoint=function(t){jsPlumbUtil.removeWithFunction(e[t.elementId],function(e){return e.id==t.id}),v(t)},this.clearFor=function(t){delete e[t],e[t]=[]};var y=function(e,n,o,i,r,s,a,l,u,c,d,h){c=-1;var p=i.endpoints[a],f=p.id,m=[1,0][a];n=[[n,o],i,r,s,f];var g=e[u],v=p._continuousAnchorEdge?e[p._continuousAnchorEdge]:null;if(v&&(e=jsPlumbUtil.findWithFunction(v,function(t){return t[4]==f}),-1!=e)){v.splice(e,1);for(var y=0;y<v.length;y++)jsPlumbUtil.addWithFunction(d,v[y][1],function(t){return t.id==v[y][1].id}),jsPlumbUtil.addWithFunction(h,v[y][1].endpoints[a],function(t){return t.id==v[y][1].endpoints[a].id}),jsPlumbUtil.addWithFunction(h,v[y][1].endpoints[m],function(t){return t.id==v[y][1].endpoints[m].id})}for(y=0;y<g.length;y++)1==t.idx&&g[y][3]===s&&-1==c&&(c=y),jsPlumbUtil.addWithFunction(d,g[y][1],function(t){return t.id==g[y][1].id}),jsPlumbUtil.addWithFunction(h,g[y][1].endpoints[a],function(t){return t.id==g[y][1].endpoints[a].id}),jsPlumbUtil.addWithFunction(h,g[y][1].endpoints[m],function(t){return t.id==g[y][1].endpoints[m].id});g.splice(l?-1!=c?c:0:g.length,0,n),p._continuousAnchorEdge=u};this.redraw=function(t,n,o,i,r){if(!u.isSuspendDrawing()){var a=e[t]||[],c=s[t]||[],p=[],f=[],m=[];o=o||u.timestamp(),i=i||{left:0,top:0},n&&(n={left:n.left+i.left,top:n.top+i.top}),n=u.updateOffset({elId:t,offset:n,recalc:!1,timestamp:o}),i={};for(var v=0;v<c.length;v++){var b=c[v][0],P=b.sourceId,C=b.targetId,E=b.endpoints[0].anchor.isContinuous,x=b.endpoints[1].anchor.isContinuous;if(E||x){var S=P+"_"+C,j=i[S],_=b.sourceId==t?1:0;E&&!l[P]&&(l[P]={top:[],right:[],bottom:[],left:[]}),x&&!l[C]&&(l[C]={top:[],right:[],bottom:[],left:[]}),t!=C&&u.updateOffset({elId:C,timestamp:o}),t!=P&&u.updateOffset({elId:P,timestamp:o});var w=u.getCachedData(C),D=u.getCachedData(P);C==P&&(E||x)?y(l[P],-Math.PI/2,0,b,!1,C,0,!1,"top",P,p,f):(j||(j=h(P,C,D.o,w.o,b.endpoints[0].anchor,b.endpoints[1].anchor),i[S]=j),E&&y(l[P],j.theta,0,b,!1,C,0,!1,j.a[0],P,p,f),x&&y(l[C],j.theta2,-1,b,!0,P,1,!0,j.a[1],C,p,f)),E&&jsPlumbUtil.addWithFunction(m,P,function(t){return t===P}),x&&jsPlumbUtil.addWithFunction(m,C,function(t){return t===C}),jsPlumbUtil.addWithFunction(p,b,function(t){return t.id==b.id}),(E&&0==_||x&&1==_)&&jsPlumbUtil.addWithFunction(f,b.endpoints[_],function(t){return t.id==b.endpoints[_].id})}}for(v=0;v<a.length;v++)0==a[v].connections.length&&a[v].anchor.isContinuous&&(l[t]||(l[t]={top:[],right:[],bottom:[],left:[]}),y(l[t],-Math.PI/2,0,{endpoints:[a[v],a[v]],paint:function(){}},!1,t,0,!1,"top",t,p,f),jsPlumbUtil.addWithFunction(m,t,function(e){return e===t}));for(v=0;v<m.length;v++)g(m[v],l[m[v]]);for(v=0;v<a.length;v++)a[v].paint({timestamp:o,offset:n,dimensions:n.s});for(v=0;v<f.length;v++)a=u.getCachedData(f[v].elementId),f[v].paint({timestamp:o,offset:a,dimensions:a.s});for(v=0;v<c.length;v++){var A=c[v][1];if(A.anchor.constructor==jsPlumb.DynamicAnchor){A.paint({elementWithPrecedence:t}),jsPlumbUtil.addWithFunction(p,c[v][0],function(t){return t.id==c[v][0].id});for(var k=0;k<A.connections.length;k++)A.connections[k]!==c[v][0]&&jsPlumbUtil.addWithFunction(p,A.connections[k],function(t){return t.id==A.connections[k].id})}else A.anchor.constructor==jsPlumb.Anchor&&jsPlumbUtil.addWithFunction(p,c[v][0],function(t){return t.id==c[v][0].id})}for((f=d[t])&&f.paint({timestamp:o,recalc:!1,elId:t}),v=0;v<p.length;v++)p[v].paint({elId:t,timestamp:o,recalc:!1,clearEdits:r})}},this.rehomeEndpoint=function(t,n){var o=e[t]||[],i=u.getId(n);if(i!==t){for(var r=0;r<o.length;r++)a.add(o[r],i);o.splice(0,o.length)}};var b=function(t){jsPlumbUtil.EventGenerator.apply(this),this.type="Continuous",this.isContinuous=this.isDynamic=!0;for(var e=t.faces||["top","right","bottom","left"],n=!1!==t.clockwise,s={},a={top:"bottom",right:"left",left:"right",bottom:"top"},l={top:"right",right:"bottom",left:"top",bottom:"left"},u={top:"left",right:"top",left:"bottom",bottom:"right"},c=n?l:u,d=n?u:l,h=t.cssClass||"",n=0;n<e.length;n++)s[e[n]]=!0;this.verifyEdge=function(t){return s[t]?t:s[a[t]]?a[t]:s[c[t]]?c[t]:s[d[t]]?d[t]:t},this.compute=function(t){return i[t.element.id]||o[t.element.id]||[0,0]},this.getCurrentLocation=function(t){return i[t.id]||o[t.id]||[0,0]},this.getOrientation=function(t){return r[t.id]||[0,0]},this.clearUserDefinedLocation=function(){delete i[t.elementId]},this.setUserDefinedLocation=function(e){i[t.elementId]=e},this.getCssClass=function(){return h},this.setCssClass=function(t){h=t}};u.continuousAnchorFactory={get:function(t){var e=n[t.elementId];return e||(e=new b(t),n[t.elementId]=e),e}}},jsPlumb.Anchor=function(t){var e=this;this.x=t.x||0,this.y=t.y||0,this.elementId=t.elementId,jsPlumbUtil.EventGenerator.apply(this);var n=t.orientation||[0,0],o=t.jsPlumbInstance,i=null,r=null,s=t.cssClass||"";this.getCssClass=function(){return s},this.offsets=t.offsets||[0,0],e.timestamp=null,this.compute=function(t){var n=t.xy,s=t.wh,a=t.element,l=t.timestamp;return t.clearUserDefinedLocation&&(r=null),l&&l===e.timestamp?i:(null!=r?i=r:(i=[n[0]+e.x*s[0]+e.offsets[0],n[1]+e.y*s[1]+e.offsets[1]],i=o.adjustForParentOffsetAndScroll(i,a.canvas)),e.timestamp=l,i)},this.getOrientation=function(){return n},this.equals=function(t){if(!t)return!1;var e=t.getOrientation(),n=this.getOrientation();return this.x==t.x&&this.y==t.y&&this.offsets[0]==t.offsets[0]&&this.offsets[1]==t.offsets[1]&&n[0]==e[0]&&n[1]==e[1]},this.getCurrentLocation=function(){return i},this.getUserDefinedLocation=function(){return r},this.setUserDefinedLocation=function(t){r=t},this.clearUserDefinedLocation=function(){r=null}},jsPlumb.FloatingAnchor=function(t){jsPlumb.Anchor.apply(this,arguments);var e=t.reference,n=jsPlumb.CurrentLibrary,o=t.jsPlumbInstance,i=n.getSize(n.getElementObject(t.referenceCanvas)),r=null,s=null;this.y=this.x=0,this.isFloating=!0,this.compute=function(t){var e=t.xy,e=[e[0]+i[0]/2,e[1]+i[1]/2];return e=o.adjustForParentOffsetAndScroll(e,t.element.canvas),s=e,e},this.getOrientation=function(t){return r?r:(t=e.getOrientation(t),[-0*Math.abs(t[0]),-0*Math.abs(t[1])])},this.over=function(t){r=t.getOrientation()},this.out=function(){r=null},this.getCurrentLocation=function(){return s}},jsPlumb.DynamicAnchor=function(t){jsPlumb.Anchor.apply(this,arguments),this.isDynamic=this.isSelective=!0;for(var e=[],n=this,o=function(e){return e.constructor==jsPlumb.Anchor?e:t.jsPlumbInstance.makeAnchor(e,t.elementId,t.jsPlumbInstance)},i=0;i<t.anchors.length;i++)e[i]=o(t.anchors[i]);this.addAnchor=function(t){e.push(o(t))},this.getAnchors=function(){return e},this.locked=!1;var r=0<e.length?e[0]:null,s=(0<e.length?0:-1,r),n=this,a=t.selector||function(t,e,n,o,i){var r=n[0]+o[0]/2;n=n[1]+o[1]/2,o=-1;for(var s=1/0,a=0;a<i.length;a++){var l,u=i[a];l=n;var c=t[0]+u.x*e[0],u=t[1]+u.y*e[1],d=t[0]+e[0]/2,h=t[1]+e[1]/2;l=Math.sqrt(Math.pow(r-c,2)+Math.pow(l-u,2))+Math.sqrt(Math.pow(d-c,2)+Math.pow(h-u,2)),s>l&&(o=a+0,s=l)}return i[o]};this.compute=function(t){var o=t.xy,i=t.wh,l=(t.timestamp,t.txy),u=t.twh;t.clearUserDefinedLocation&&(userDefinedLocation=null);var c=n.getUserDefinedLocation();return null!=c?c:n.locked||null==l||null==u?r.compute(t):(t.timestamp=null,r=a(o,i,l,u,e),n.x=r.x,n.y=r.y,r!=s&&n.fire("anchorChanged",r),s=r,r.compute(t))},this.getCurrentLocation=function(){return n.getUserDefinedLocation()||(null!=r?r.getCurrentLocation():null)},this.getOrientation=function(t){return null!=r?r.getOrientation(t):[0,0]},this.over=function(t){null!=r&&r.over(t)},this.out=function(){null!=r&&r.out()},this.getCssClass=function(){return r&&r.getCssClass()||""}};var t=function(t,e,n,o,i,r){jsPlumb.Anchors[i]=function(s){var a=s.jsPlumbInstance.makeAnchor([t,e,n,o,0,0],s.elementId,s.jsPlumbInstance);return a.type=i,r&&r(a,s),a}};t(.5,0,0,-1,"TopCenter"),t(.5,1,0,1,"BottomCenter"),t(0,.5,-1,0,"LeftMiddle"),t(1,.5,1,0,"RightMiddle"),t(.5,0,0,-1,"Top"),t(.5,1,0,1,"Bottom"),t(0,.5,-1,0,"Left"),t(1,.5,1,0,"Right"),t(.5,.5,0,0,"Center"),t(1,0,0,-1,"TopRight"),t(1,1,0,1,"BottomRight"),t(0,0,0,-1,"TopLeft"),t(0,1,0,1,"BottomLeft"),jsPlumb.Defaults.DynamicAnchors=function(t){return t.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],t.elementId,t.jsPlumbInstance)},jsPlumb.Anchors.AutoDefault=function(t){return t=t.jsPlumbInstance.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors(t)),t.type="AutoDefault",t};var e=function(t,e){jsPlumb.Anchors[t]=function(n){return n=n.jsPlumbInstance.makeAnchor(["Continuous",{faces:e}],n.elementId,n.jsPlumbInstance),n.type=t,n}};jsPlumb.Anchors.Continuous=function(t){return t.jsPlumbInstance.continuousAnchorFactory.get(t)},e("ContinuousLeft",["left"]),e("ContinuousTop",["top"]),e("ContinuousBottom",["bottom"]),e("ContinuousRight",["right"]),jsPlumb.Anchors.Assign=t(0,0,0,0,"Assign",function(t,e){var n=e.position||"Fixed";t.positionFinder=n.constructor==String?e.jsPlumbInstance.AnchorPositionFinders[n]:n,t.constructorParams=e}),jsPlumb.AnchorPositionFinders={Fixed:function(t,e,n){return[(t.left-e.left)/n[0],(t.top-e.top)/n[1]]},Grid:function(t,e,n,o){var i=n[0]/o.grid[0];return o=n[1]/o.grid[1],[(Math.floor((t.left-e.left)/i)*i+i/2)/n[0],(Math.floor((t.top-e.top)/o)*o+o/2)/n[1]]}},jsPlumb.Anchors.Perimeter=function(t){t=t||{};var e=t.anchorCount||60,n=t.shape;if(!n)throw Error("no shape supplied to Perimeter Anchor type");var o=function(){for(var t=2*Math.PI/e,n=0,o=[],i=0;e>i;i++){var r=.5+.5*Math.sin(n),s=.5+.5*Math.cos(n);o.push([r,s,0,0]),n+=t}return o},i=function(t){for(var n=e/t.length,o=[],i=function(t,i,r,s,a){for(n=e*a,r=(r-t)/n,s=(s-i)/n,a=0;n>a;a++)o.push([t+r*a,i+s*a,0,0])},r=0;r<t.length;r++)i.apply(null,t[r]);return o},r=function(t){for(var e=[],n=0;n<t.length;n++)e.push([t[n][0],t[n][1],t[n][2],t[n][3],1/t.length]);return i(e)},s=function(){return r([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]])},s={Circle:o,Ellipse:o,Diamond:function(){return r([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:s,Square:s,Triangle:function(){return r([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(t){t=t.points;for(var e=[],n=0,o=0;o<t.length-1;o++){var r=Math.sqrt(Math.pow(t[o][2]-t[o][0])+Math.pow(t[o][3]-t[o][1])),n=n+r;e.push([t[o][0],t[o][1],t[o+1][0],t[o+1][1],r])}for(o=0;o<e.length;o++)e[o][4]/=n;return i(e)}},o=function(t,e){for(var n=[],o=e/180*Math.PI,i=0;i<t.length;i++){var r=t[i][0]-.5,s=t[i][1]-.5;n.push([.5+(r*Math.cos(o)-s*Math.sin(o)),.5+(r*Math.sin(o)+s*Math.cos(o)),t[i][2],t[i][3]])}return n};if(!s[n])throw Error("Shape ["+n+"] is unknown by Perimeter Anchor type");return n=s[n](t),t.rotation&&(n=o(n,t.rotation)),t=t.jsPlumbInstance.makeDynamicAnchor(n),t.type="Perimeter",t}}(),function(){var t=function(t,e){var n=!1;return{drag:function(){if(n)return n=!1,!0;var o=jsPlumb.CurrentLibrary.getUIPosition(arguments,e.getZoom());t.element&&(jsPlumb.CurrentLibrary.setOffset(t.element,o),e.repaint(t.element,o))},stopDrag:function(){n=!0}}},e="connectorStyle connectorHoverStyle connectorOverlays connector connectionType connectorClass connectorHoverClass".split(" ");jsPlumb.Endpoint=function(n){var o=this,i=n._jsPlumb,r=jsPlumb.CurrentLibrary,s=r.getAttribute,a=r.getElementObject,l=jsPlumbUtil,u=r.getOffset,c=n.newConnection,d=n.newEndpoint,h=n.finaliseConnection,p=n.fireDetachEvent,f=n.floatingConnections;o.idPrefix="_jsplumb_e_",o.defaultLabelLocation=[.5,.5],o.defaultOverlayKeys=["Overlays","EndpointOverlays"],this.parent=n.parent,overlayCapableJsPlumbUIComponent.apply(this,arguments),n=n||{},this.getTypeDescriptor=function(){return"endpoint"},this.getDefaultType=function(){return{parameters:{},scope:null,maxConnections:o._jsPlumb.Defaults.MaxConnections,paintStyle:o._jsPlumb.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,endpoint:o._jsPlumb.Defaults.Endpoint||jsPlumb.Defaults.Endpoint,hoverPaintStyle:o._jsPlumb.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,overlays:o._jsPlumb.Defaults.EndpointOverlays||jsPlumb.Defaults.EndpointOverlays,connectorStyle:n.connectorStyle,connectorHoverStyle:n.connectorHoverStyle,connectorClass:n.connectorClass,connectorHoverClass:n.connectorHoverClass,connectorOverlays:n.connectorOverlays,connector:n.connector,connectorTooltip:n.connectorTooltip}};var m=this.applyType;this.applyType=function(t,n){m(t,n),null!=t.maxConnections&&(A=t.maxConnections),t.scope&&(o.scope=t.scope),l.copyValues(e,t,o)};var g=!0,v=!1!==n.enabled;this.isVisible=function(){return g},this.setVisible=function(t,e,n){if(g=t,o.canvas&&(o.canvas.style.display=t?"block":"none"),o[t?"showOverlays":"hideOverlays"](),!e)for(e=0;e<o.connections.length;e++)if(o.connections[e].setVisible(t),!n){var i=o===o.connections[e].endpoints[0]?1:0;1==o.connections[e].endpoints[i].connections.length&&o.connections[e].endpoints[i].setVisible(t,!0,!0)}},this.isEnabled=function(){return v},this.setEnabled=function(t){v=t};var y=n.source,b=n.uuid,P=null,C=null;b&&(n.endpointsByUUID[b]=o);var E=s(y,"id");this.elementId=E,this.element=y,o.setElementId=function(t){E=t,o.elementId=t,o.anchor.elementId=t},o.setReferenceElement=function(t){y=t,o.element=t};var x=n.connectionCost;this.getConnectionCost=function(){return x},this.setConnectionCost=function(t){x=t};var S=n.connectionsDirected;this.areConnectionsDirected=function(){return S},this.setConnectionsDirected=function(t){S=t};var j="",_=function(){r.removeClass(y,i.endpointAnchorClassPrefix+"_"+j),o.removeClass(i.endpointAnchorClassPrefix+"_"+j),j=o.anchor.getCssClass(),o.addClass(i.endpointAnchorClassPrefix+"_"+j),r.addClass(y,i.endpointAnchorClassPrefix+"_"+j)};this.setAnchor=function(t,e){o.anchor=i.makeAnchor(t,E,i),_(),o.anchor.bind("anchorChanged",function(t){o.fire("anchorChanged",{endpoint:o,anchor:t}),_()}),e||i.repaint(E)},this.cleanup=function(){r.removeClass(y,i.endpointAnchorClassPrefix+"_"+j)},o.setAnchor(n.anchor?n.anchor:n.anchors?n.anchors:i.Defaults.Anchor||"Top",!0),n._transient||i.anchorManager.add(o,E);var w=null;this.setEndpoint=function(t){var e=function(t,e){var n=i.getRenderMode();if(jsPlumb.Endpoints[n][t])return new jsPlumb.Endpoints[n][t](e);if(!i.Defaults.DoNotThrowErrors)throw{msg:"jsPlumb: unknown endpoint type '"+t+"'"}},r={_jsPlumb:o._jsPlumb,cssClass:n.cssClass,parent:n.parent,container:n.container,tooltip:n.tooltip,connectorTooltip:n.connectorTooltip,endpoint:o};l.isString(t)?w=e(t,r):l.isArray(t)?(r=l.merge(t[1],r),w=e(t[0],r)):w=t.clone();var s=jsPlumb.extend({},r);w.clone=function(){var t={};return w.constructor.apply(t,[s]),t},o.endpoint=w,o.type=o.endpoint.type},this.setEndpoint(n.endpoint||i.Defaults.Endpoint||jsPlumb.Defaults.Endpoint||"Dot");var D=o.setHover;o.setHover=function(){o.endpoint.setHover.apply(o.endpoint,arguments),D.apply(o,arguments)},o.bindListeners(o.endpoint,o,function(t){0<o.connections.length?o.connections[0].setHover(t,!1):o.setHover(t)}),this.setPaintStyle(n.paintStyle||n.style||i.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,!0),this.setHoverPaintStyle(n.hoverPaintStyle||i.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,!0),this.paintStyleInUse=this.getPaintStyle(),this.getPaintStyle(),l.copyValues(e,n,this),this.isSource=n.isSource||!1,this.isTarget=n.isTarget||!1;var A=n.maxConnections||i.Defaults.MaxConnections;this.getAttachedElements=function(){return o.connections
},this.canvas=this.endpoint.canvas,o.addClass(i.endpointAnchorClassPrefix+"_"+j),r.addClass(y,i.endpointAnchorClassPrefix+"_"+j),this.connections=n.connections||[],this.connectorPointerEvents=n["connector-pointer-events"],this.scope=n.scope||i.getDefaultScope(),this.timestamp=null,o.reattachConnections=n.reattach||i.Defaults.ReattachConnections,o.connectionsDetachable=i.Defaults.ConnectionsDetachable,!1!==n.connectionsDetachable&&!1!==n.detachable||(o.connectionsDetachable=!1);var k=n.dragAllowedWhenFull||!0;if(n.onMaxConnections&&o.bind("maxConnections",n.onMaxConnections),this.computeAnchor=function(t){return o.anchor.compute(t)},this.addConnection=function(t){o.connections.push(t),o[(0<o.connections.length?"add":"remove")+"Class"](i.endpointConnectedClass),o[(o.isFull()?"add":"remove")+"Class"](i.endpointFullClass)},this.detach=function(t,e,r,s,a){var u=l.findWithFunction(o.connections,function(e){return e.id==t.id}),c=!1;if(s=!1!==s,u>=0&&(r||t._forceDetach||t.isDetachable()||t.isDetachAllowed(t))){var d=t.endpoints[0]==o?t.endpoints[1]:t.endpoints[0];if(r||t._forceDetach||o.isDetachAllowed(t)){if(o.connections.splice(u,1),!e&&(d.detach(t,!0,r),t.endpointsToDeleteOnDetach))for(r=0;r<t.endpointsToDeleteOnDetach.length;r++)(u=t.endpointsToDeleteOnDetach[r])&&0==u.connections.length&&i.deleteEndpoint(u);null!=t.getConnector()&&l.removeElements(t.getConnector().getDisplayElements(),t.parent),l.removeWithFunction(n.connectionsByScope[t.scope],function(e){return e.id==t.id}),o[(0<o.connections.length?"add":"remove")+"Class"](i.endpointConnectedClass),o[(o.isFull()?"add":"remove")+"Class"](i.endpointFullClass),c=!0,p(t,!e&&s,a)}}return c},this.detachAll=function(t,e){for(;0<o.connections.length;)o.detach(o.connections[0],!1,!0,t,e);return o},this.detachFrom=function(t,e,n){for(var i=[],r=0;r<o.connections.length;r++)o.connections[r].endpoints[1]!=t&&o.connections[r].endpoints[0]!=t||i.push(o.connections[r]);for(r=0;r<i.length;r++)o.detach(i[r],!1,!0,e,n)&&i[r].setHover(!1,!1);return o},this.detachFromConnection=function(t){var e=l.findWithFunction(o.connections,function(e){return e.id==t.id});e>=0&&(o.connections.splice(e,1),o[(0<o.connections.length?"add":"remove")+"Class"](i.endpointConnectedClass),o[(o.isFull()?"add":"remove")+"Class"](i.endpointFullClass))},this.getElement=function(){return y},this.setElement=function(t,e){var s=i.getId(t);l.removeWithFunction(n.endpointsByElement[o.elementId],function(t){return t.id==o.id}),y=a(t),E=i.getId(y),o.elementId=E;var u=n.getParentFromParams({source:s,container:e}),c=r.getParent(o.canvas);for(r.removeElement(o.canvas,c),r.appendElement(o.canvas,u),c=0;c<o.connections.length;c++)o.connections[c].moveParent(u),o.connections[c].sourceId=E,o.connections[c].source=y;l.addToList(n.endpointsByElement,s,o)},this.getUuid=function(){return b},o.makeInPlaceCopy=function(){var t=o.anchor.getCurrentLocation(o),e=o.anchor.getOrientation(o),i=o.anchor.getCssClass();return d({anchor:{bind:function(){},compute:function(){return[t[0],t[1]]},getCurrentLocation:function(){return[t[0],t[1]]},getOrientation:function(){return e},getCssClass:function(){return i}},source:y,paintStyle:this.getPaintStyle(),endpoint:n.hideOnDrag?"Blank":w,_transient:!0,scope:o.scope})},this.isConnectedTo=function(t){var e=!1;if(t)for(var n=0;n<o.connections.length;n++)if(o.connections[n].endpoints[1]==t){e=!0;break}return e},this.isFloating=function(){return null!=P},this.connectorSelector=function(){var t=o.connections[0];return o.isTarget&&t?t:o.connections.length<A||-1==A?null:t},this.isFull=function(){return!(o.isFloating()||1>A||o.connections.length<A)},this.setDragAllowedWhenFull=function(t){k=t},this.setStyle=o.setPaintStyle,this.equals=function(t){return this.anchor.equals(t.anchor)},this.paint=function(t){t=t||{};var e=t.timestamp,n=!1!==t.recalc;if(!e||o.timestamp!==e){var r=i.updateOffset({elId:E,timestamp:e,recalc:n}),s=t.offset?t.offset.o:r.o;if(s){var a=t.anchorPoint,l=t.connectorPaintStyle;if(null==a){if(a=t.dimensions||r.s,(null==s||null==a)&&(r=i.updateOffset({elId:E,timestamp:e}),s=r.o,a=r.s),r={xy:[s.left,s.top],wh:a,element:o,timestamp:e},n&&o.anchor.isDynamic&&0<o.connections.length){if(t=t.elementWithPrecedence,n=0,null!=t)for(s=0;s<o.connections.length;s++)if(o.connections[s].sourceId==t||o.connections[s].targetId==t){n=s;break}t=o.connections[n],n=t.endpoints[0]==o?1:0,a=i.getCachedData(0==n?t.sourceId:t.targetId),s=a.o,a=a.s,r.txy=[s.left,s.top],r.twh=a,r.tElement=t.endpoints[n]}a=o.anchor.compute(r)}for(w.compute(a,o.anchor.getOrientation(o),o.paintStyleInUse,l||o.paintStyleInUse),w.paint(o.paintStyleInUse,o.anchor),o.timestamp=e,e=0;e<o.overlays.length;e++)l=o.overlays[e],l.isVisible()&&(o.overlayPlacements[e]=l.draw(o.endpoint,o.paintStyleInUse),l.paint(o.overlayPlacements[e]))}}},this.repaint=this.paint,r.isDragSupported(y)){var L={id:null,element:null},I=null,O=!1,M=null,T=t(L,i),U=n.dragOptions||{},F=jsPlumb.extend({},r.defaultDragOptions),N=r.dragEvents.start,W=r.dragEvents.stop,H=r.dragEvents.drag,U=jsPlumb.extend(F,U);U.scope=U.scope||o.scope,U[N]=i.wrap(U[N],function(){I=o.connectorSelector();var t=!0;if(o.isEnabled()||(t=!1),null!=I||n.isSource||(t=!1),n.isSource&&o.isFull()&&!k&&(t=!1),null==I||I.isDetachable()||(t=!1),!1===t)return r.stopDrag&&r.stopDrag(),T.stopDrag(),!1;o.addClass("endpointDrag"),I&&!o.isFull()&&n.isSource&&(I=null),i.updateOffset({elId:E}),C=o.makeInPlaceCopy(),C.referenceEndpoint=o,C.paint();var t=L,e=o.parent,s=i,h=document.createElement("div");h.style.position="absolute";var p=jsPlumb.CurrentLibrary.getElementObject(h);jsPlumb.CurrentLibrary.appendElement(h,e),e=s.getId(p),s.updateOffset({elId:e}),t.id=e,t.element=p,s=a(C.canvas),t=u(s,i),p=i.adjustForParentOffsetAndScroll([t.left,t.top],C.canvas),t=a(o.canvas),r.setOffset(L.element,{left:p[0],top:p[1]}),o.parentAnchor&&(o.anchor=i.makeAnchor(o.parentAnchor,o.elementId,i)),r.setAttribute(t,"dragId",L.id),r.setAttribute(t,"elId",E);var p=o.getPaintStyle(),e=w,h=L.element,m=d,g=new jsPlumb.FloatingAnchor({reference:o.anchor,referenceCanvas:o.canvas,jsPlumbInstance:i});P=m({paintStyle:p,endpoint:e,anchor:g,source:h,scope:"__floating"}),o.canvas.style.visibility="hidden",null==I?(o.anchor.locked=!0,o.setHover(!1,!1),I=c({sourceEndpoint:o,targetEndpoint:P,source:o.endpointWillMoveTo||y,target:L.element,anchors:[o.anchor,P.anchor],paintStyle:n.connectorStyle,hoverPaintStyle:n.connectorHoverStyle,connector:n.connector,overlays:n.connectorOverlays,type:o.connectionType,cssClass:o.connectorClass,hoverClass:o.connectorHoverClass})):(O=!0,I.setHover(!1),Y(s,!1,!0),s=I.endpoints[0].id==o.id?0:1,I.floatingAnchorIndex=s,o.detachFromConnection(I),p=jsPlumb.CurrentLibrary.getDragScope(t),r.setAttribute(t,"originalScope",p),e=r.getDropScope(t),r.setDragScope(t,e),0==s?(M=[I.source,I.sourceId,X,p],I.source=L.element,I.sourceId=L.id):(M=[I.target,I.targetId,X,p],I.target=L.element,I.targetId=L.id),I.endpoints[0==s?1:0].anchor.locked=!0,I.suspendedEndpoint=I.endpoints[s],I.suspendedElement=I.endpoints[s].getElement(),I.suspendedElementId=I.endpoints[s].elementId,I.suspendedElementType=0==s?"source":"target",I.suspendedEndpoint.setHover(!1),P.referenceEndpoint=I.suspendedEndpoint,I.endpoints[s]=P),I.addClass(i.draggingClass),P.addClass(i.draggingClass),i.fire("connectionDrag",I),f[L.id]=I,i.anchorManager.addFloatingConnection(L.id,I),P.addConnection(I),l.addToList(n.endpointsByElement,L.id,P),i.currentlyDragging=!0}),U[H]=i.wrap(U[H],T.drag),U[W]=i.wrap(U[W],function(){var t=r.getDropEvent(arguments);l.removeWithFunction(n.endpointsByElement[L.id],function(t){return t.id==P.id}),l.removeElement(C.canvas,y),i.anchorManager.clearFor(L.id);var e=null==I.floatingAnchorIndex?1:I.floatingAnchorIndex;I.endpoints[0==e?1:0].anchor.locked=!1,I.endpoints[e]==P&&(O&&I.suspendedEndpoint?(0==e?(I.source=M[0],I.sourceId=M[1]):(I.target=M[0],I.targetId=M[1]),r.setDragScope(M[2],M[3]),I.endpoints[e]=I.suspendedEndpoint,(I.isReattach()||I._forceReattach||I._forceDetach||!I.endpoints[0==e?1:0].detach(I,!1,!1,!0,t))&&(I.setHover(!1),I.floatingAnchorIndex=null,I.suspendedEndpoint.addConnection(I),i.repaint(M[1])),I._forceDetach=null,I._forceReattach=null):(l.removeElements(I.getConnector().getDisplayElements(),o.parent),o.detachFromConnection(I))),l.removeElements([L.element[0],P.canvas],y),i.dragManager.elementRemoved(P.elementId),o.canvas.style.visibility="visible",o.anchor.locked=!1,o.paint({recalc:!1}),I.removeClass(i.draggingClass),P.removeClass(i.draggingClass),i.fire("connectionDragStop",I),C=I=null,delete n.endpointsByElement[P.elementId],P=P.anchor=null,i.currentlyDragging=!1});var X=a(o.canvas);r.initDraggable(X,U,!0,i)}var Y=function(t,e,l,u){if((n.isTarget||e)&&r.isDropSupported(y)){e=n.dropOptions||i.Defaults.DropOptions||jsPlumb.Defaults.DropOptions,e=jsPlumb.extend({},e),e.scope=e.scope||o.scope;var c=r.dragEvents.drop,d=r.dragEvents.over,m=r.dragEvents.out;e[c]=i.wrap(e[c],function(){o.removeClass(i.endpointDropAllowedClass),o.removeClass(i.endpointDropForbiddenClass);var t=r.getDropEvent(arguments),e=a(r.getDragObject(arguments)),n=s(e,"dragId"),l=(s(e,"elId"),s(e,"originalScope")),c=f[n];if(c.suspendedEndpoint&&(c.suspendedEndpoint.id==o.id||o.referenceEndpoint&&c.suspendedEndpoint.id==o.referenceEndpoint.id))return void(c._forceReattach=!0);if(null!=c){var d=null==c.floatingAnchorIndex?1:c.floatingAnchorIndex;if(l&&jsPlumb.CurrentLibrary.setDragScope(e,l),e=null!=u?u.isEnabled():!0,o.isFull()&&o.fire("maxConnections",{endpoint:o,connection:c,maxConnections:A},t),!o.isFull()&&(0!=d||o.isSource)&&(1!=d||o.isTarget)&&e){if(e=!0,c.suspendedEndpoint&&c.suspendedEndpoint.id!=o.id&&(0==d?(c.source=c.suspendedEndpoint.element,c.sourceId=c.suspendedEndpoint.elementId):(c.target=c.suspendedEndpoint.element,c.targetId=c.suspendedEndpoint.elementId),c.isDetachAllowed(c)&&c.endpoints[d].isDetachAllowed(c)&&c.suspendedEndpoint.isDetachAllowed(c)&&i.checkCondition("beforeDetach",c)||(e=!1)),0==d?(c.source=o.element,c.sourceId=o.elementId):(c.target=o.element,c.targetId=o.elementId),e=e&&o.isDropAllowed(c.sourceId,c.targetId,c.scope,c,o)){c.endpoints[d].detachFromConnection(c),c.suspendedEndpoint&&c.suspendedEndpoint.detachFromConnection(c),c.endpoints[d]=o,o.addConnection(c);var m,e=o.getParameters();for(m in e)c.setParameter(m,e[m]);c.suspendedEndpoint?(m=c.suspendedEndpoint.getElement(),e=c.suspendedEndpoint.elementId,p({source:0==d?m:c.source,target:1==d?m:c.target,sourceId:0==d?e:c.sourceId,targetId:1==d?e:c.targetId,sourceEndpoint:0==d?c.suspendedEndpoint:c.endpoints[0],targetEndpoint:1==d?c.suspendedEndpoint:c.endpoints[1],connection:c},!0,t)):e.draggable&&jsPlumb.CurrentLibrary.initDraggable(o.element,U,!0,i),c.endpoints[0].addedViaMouse&&(c.endpointsToDeleteOnDetach[0]=c.endpoints[0]),c.endpoints[1].addedViaMouse&&(c.endpointsToDeleteOnDetach[1]=c.endpoints[1]),h(c,null,t)}else c.suspendedEndpoint&&(c.endpoints[d]=c.suspendedEndpoint,c.setHover(!1),c._forceDetach=!0,0==d?(c.source=c.suspendedEndpoint.element,c.sourceId=c.suspendedEndpoint.elementId):(c.target=c.suspendedEndpoint.element,c.targetId=c.suspendedEndpoint.elementId),c.suspendedEndpoint.addConnection(c),c.endpoints[0].repaint(),c.repaint(),i.repaint(c.sourceId),c._forceDetach=!1);c.floatingAnchorIndex=null}i.currentlyDragging=!1,delete f[n],i.anchorManager.removeFloatingConnection(n)}}),e[d]=i.wrap(e[d],function(){var t=r.getDragObject(arguments),t=s(a(t),"dragId"),t=f[t];if(null!=t){var e=null==t.floatingAnchorIndex?1:t.floatingAnchorIndex;if(o.isTarget&&0!=t.floatingAnchorIndex||t.suspendedEndpoint&&o.referenceEndpoint&&o.referenceEndpoint.id==t.suspendedEndpoint.id){var n=i.checkCondition("checkDropAllowed",{sourceEndpoint:t.endpoints[e],targetEndpoint:o,connection:t});o[(n?"add":"remove")+"Class"](i.endpointDropAllowedClass),o[(n?"remove":"add")+"Class"](i.endpointDropForbiddenClass),t.endpoints[e].anchor.over(o.anchor)}}}),e[m]=i.wrap(e[m],function(){var t=r.getDragObject(arguments),t=s(a(t),"dragId"),t=f[t];if(null!=t){var e=null==t.floatingAnchorIndex?1:t.floatingAnchorIndex;(o.isTarget&&0!=t.floatingAnchorIndex||t.suspendedEndpoint&&o.referenceEndpoint&&o.referenceEndpoint.id==t.suspendedEndpoint.id)&&(o.removeClass(i.endpointDropAllowedClass),o.removeClass(i.endpointDropForbiddenClass),t.endpoints[e].anchor.out())}}),r.initDroppable(t,e,!0,l)}};return Y(a(o.canvas),!0,!(n._transient||o.anchor.isFloating),o),n.type&&o.addType(n.type,n.data,i.isSuspendDrawing()),o}}(),function(){jsPlumb.Connection=function(t){var e,n,o=this,i=!0,r=t._jsPlumb,s=jsPlumb.CurrentLibrary,a=s.getAttribute,l=s.getElementObject,u=jsPlumbUtil,c=(s.getOffset,t.newConnection,t.newEndpoint),d=null;o.idPrefix="_jsplumb_c_",o.defaultLabelLocation=.5,o.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.parent=t.parent,overlayCapableJsPlumbUIComponent.apply(this,arguments),this.isVisible=function(){return i},this.setVisible=function(t){i=t,o[t?"showOverlays":"hideOverlays"](),d&&d.canvas&&(d.canvas.style.display=t?"block":"none"),o.repaint()};var h=!0===t.editable;this.setEditable=function(t){return d&&d.isEditable()&&(h=t),h},this.isEditable=function(){return h},this.editStarted=function(){o.fire("editStarted",{path:d.getPath()}),r.setHoverSuspended(!0)},this.editCompleted=function(){o.fire("editCompleted",{path:d.getPath()}),o.setHover(!1),r.setHoverSuspended(!1)},this.editCanceled=function(){o.fire("editCanceled",{path:d.getPath()}),o.setHover(!1),r.setHoverSuspended(!1)};var p=this.addClass,f=this.removeClass;this.addClass=function(t,e){p(t),e&&(o.endpoints[0].addClass(t),o.endpoints[1].addClass(t))},this.removeClass=function(t,e){f(t),e&&(o.endpoints[0].removeClass(t),o.endpoints[1].removeClass(t))},this.getTypeDescriptor=function(){return"connection"},this.getDefaultType=function(){return{parameters:{},scope:null,detachable:o._jsPlumb.Defaults.ConnectionsDetachable,rettach:o._jsPlumb.Defaults.ReattachConnections,paintStyle:o._jsPlumb.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,connector:o._jsPlumb.Defaults.Connector||jsPlumb.Defaults.Connector,hoverPaintStyle:o._jsPlumb.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,overlays:o._jsPlumb.Defaults.ConnectorOverlays||jsPlumb.Defaults.ConnectorOverlays}};var m=this.applyType;this.applyType=function(t,e){m(t,e),null!=t.detachable&&o.setDetachable(t.detachable),null!=t.reattach&&o.setReattach(t.reattach),t.scope&&(o.scope=t.scope),h=t.editable,o.setConnector(t.connector,e)},n=o.setHover,o.setHover=function(){d.setHover.apply(d,arguments),n.apply(o,arguments)},e=function(t){r.isConnectionBeingDragged()||o.setHover(t,!1)};var g=function(t,e,n){var o={};if(!r.Defaults.DoNotThrowErrors&&null==jsPlumb.Connectors[e])throw{msg:"jsPlumb: unknown connector type '"+e+"'"};return jsPlumb.Connectors[e].apply(o,[n]),jsPlumb.ConnectorRenderers[t].apply(o,[n]),o};this.setConnector=function(n,i){null!=d&&u.removeElements(d.getDisplayElements());var s={_jsPlumb:o._jsPlumb,parent:t.parent,cssClass:t.cssClass,container:t.container,tooltip:o.tooltip,"pointer-events":t["pointer-events"]},a=r.getRenderMode();u.isString(n)?d=g(a,n,s):u.isArray(n)&&(d=1==n.length?g(a,n[0],s):g(a,n[0],u.merge(n[1],s))),o.bindListeners(d,o,e),o.canvas=d.canvas,h&&null!=jsPlumb.ConnectorEditors&&jsPlumb.ConnectorEditors[d.type]&&d.isEditable()?new jsPlumb.ConnectorEditors[d.type]({connector:d,connection:o,params:t.editorParams||{}}):h=!1,i||o.repaint()},this.getConnector=function(){return d},this.source=l(t.source),this.target=l(t.target),t.sourceEndpoint&&(this.source=t.sourceEndpoint.endpointWillMoveTo||t.sourceEndpoint.getElement()),t.targetEndpoint&&(this.target=t.targetEndpoint.getElement()),o.previousConnection=t.previousConnection,this.sourceId=a(this.source,"id"),this.targetId=a(this.target,"id"),this.scope=t.scope,this.endpoints=[],this.endpointStyles=[],s=function(t,e,n,i,s,a,l){var u;return t?(o.endpoints[e]=t,t.addConnection(o)):(n.endpoints||(n.endpoints=[null,null]),t=n.endpoints[e]||n.endpoint||r.Defaults.Endpoints[e]||jsPlumb.Defaults.Endpoints[e]||r.Defaults.Endpoint||jsPlumb.Defaults.Endpoint,n.endpointStyles||(n.endpointStyles=[null,null]),n.endpointHoverStyles||(n.endpointHoverStyles=[null,null]),u=n.endpointStyles[e]||n.endpointStyle||r.Defaults.EndpointStyles[e]||jsPlumb.Defaults.EndpointStyles[e]||r.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,null==u.fillStyle&&null!=a&&(u.fillStyle=a.strokeStyle),null==u.outlineColor&&null!=a&&(u.outlineColor=a.outlineColor),null==u.outlineWidth&&null!=a&&(u.outlineWidth=a.outlineWidth),a=n.endpointHoverStyles[e]||n.endpointHoverStyle||r.Defaults.EndpointHoverStyles[e]||jsPlumb.Defaults.EndpointHoverStyles[e]||r.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,null!=l&&(null==a&&(a={}),null==a.fillStyle&&(a.fillStyle=l.strokeStyle)),s=n.anchors?n.anchors[e]:n.anchor?n.anchor:(r.Defaults.Anchors[e]?r.makeAnchor(r.Defaults.Anchors[e],s,r):null)||(jsPlumb.Defaults.Anchors[e]?r.makeAnchor(jsPlumb.Defaults.Anchors[e],s,r):null)||(r.Defaults.Anchor?r.makeAnchor(r.Defaults.Anchor,s,r):null)||(jsPlumb.Defaults.Anchor?r.makeAnchor(jsPlumb.Defaults.Anchor,s,r):null),u=c({paintStyle:u,hoverPaintStyle:a,endpoint:t,connections:[o],uuid:n.uuids?n.uuids[e]:null,anchor:s,source:i,scope:n.scope,container:n.container,reattach:n.reattach||r.Defaults.ReattachConnections,detachable:n.detachable||r.Defaults.ConnectionsDetachable}),o.endpoints[e]=u,!1===n.drawEndpoints&&u.setVisible(!1,!0,!0)),u},(a=s(t.sourceEndpoint,0,t,o.source,o.sourceId,t.paintStyle,t.hoverPaintStyle))&&u.addToList(t.endpointsByElement,this.sourceId,a),(s=s(t.targetEndpoint,1,t,o.target,o.targetId,t.paintStyle,t.hoverPaintStyle))&&u.addToList(t.endpointsByElement,this.targetId,s),this.scope||(this.scope=this.endpoints[0].scope),o.endpointsToDeleteOnDetach=[null,null],t.deleteEndpointsOnDetach&&(t.sourceIsNew&&(o.endpointsToDeleteOnDetach[0]=o.endpoints[0]),t.targetIsNew&&(o.endpointsToDeleteOnDetach[1]=o.endpoints[1])),t.endpointsToDeleteOnDetach&&(o.endpointsToDeleteOnDetach=t.endpointsToDeleteOnDetach),o.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||t.connector||r.Defaults.Connector||jsPlumb.Defaults.Connector,!0),t.path&&d.setPath(t.path),this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||t.paintStyle||r.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,!0),this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||t.hoverPaintStyle||r.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,!0),this.paintStyleInUse=this.getPaintStyle();var v=r.getSuspendedAt();if(r.updateOffset({elId:this.sourceId,timestamp:v}),r.updateOffset({elId:this.targetId,timestamp:v}),!r.isSuspendDrawing()){var a=r.getCachedData(this.sourceId),s=a.o,a=a.s,y=r.getCachedData(this.targetId),l=y.o,y=y.s,v=v||r.timestamp(),b=this.endpoints[0].anchor.compute({xy:[s.left,s.top],wh:a,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[l.left,l.top],twh:y,tElement:this.endpoints[1],timestamp:v});this.endpoints[0].paint({anchorLoc:b,timestamp:v}),b=this.endpoints[1].anchor.compute({xy:[l.left,l.top],wh:y,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[s.left,s.top],twh:a,tElement:this.endpoints[0],timestamp:v}),this.endpoints[1].paint({anchorLoc:b,timestamp:v})}var P=r.Defaults.ConnectionsDetachable;!1===t.detachable&&(P=!1),!1===o.endpoints[0].connectionsDetachable&&(P=!1),!1===o.endpoints[1].connectionsDetachable&&(P=!1),this.isDetachable=function(){return!0===P},this.setDetachable=function(t){P=!0===t};var C=t.reattach||o.endpoints[0].reattachConnections||o.endpoints[1].reattachConnections||r.Defaults.ReattachConnections;this.isReattach=function(){return!0===C},this.setReattach=function(t){C=!0===t};var E=t.cost||o.endpoints[0].getConnectionCost();o.getCost=function(){return E},o.setCost=function(t){E=t};var x=t.directed;null==t.directed&&(x=o.endpoints[0].areConnectionsDirected()),o.isDirected=function(){return!0===x},s=jsPlumb.extend({},this.endpoints[0].getParameters()),jsPlumb.extend(s,this.endpoints[1].getParameters()),jsPlumb.extend(s,o.getParameters()),o.setParameters(s),this.getAttachedElements=function(){return o.endpoints},this.moveParent=function(t){var e=jsPlumb.CurrentLibrary;e.getParent(d.canvas),d.bgCanvas&&(e.removeElement(d.bgCanvas),e.appendElement(d.bgCanvas,t)),e.removeElement(d.canvas),e.appendElement(d.canvas,t);for(var n=0;n<o.overlays.length;n++)o.overlays[n].isAppendedAtTopLevel&&(e.removeElement(o.overlays[n].canvas),e.appendElement(o.overlays[n].canvas,t),o.overlays[n].reattachListeners&&o.overlays[n].reattachListeners(d));d.reattachListeners&&d.reattachListeners()};var S=null;this.paint=function(t){if(i){t=t||{};var e=t.elId,n=t.ui,s=t.recalc,a=t.timestamp,l=this.targetId,u=(this.sourceId,1);if(null==a||a!=S){for(e=r.updateOffset({elId:e,offset:n,recalc:s,timestamp:a}).o,l=r.updateOffset({elId:l,timestamp:a}).o,s=this.endpoints[0],n=this.endpoints[u],t.clearEdits&&(s.anchor.clearUserDefinedLocation(),n.anchor.clearUserDefinedLocation(),d.setEdited(!1)),s=s.anchor.getCurrentLocation(s),n=n.anchor.getCurrentLocation(n),d.resetBounds(),d.compute({sourcePos:s,targetPos:n,sourceEndpoint:this.endpoints[0],targetEndpoint:this.endpoints[u],lineWidth:o.paintStyleInUse.lineWidth,sourceInfo:e,targetInfo:l,clearEdits:!0===t.clearEdits}),t=1/0,u=1/0,e=-1/0,l=-1/0,n=0;n<o.overlays.length;n++)s=o.overlays[n],s.isVisible()&&(o.overlayPlacements[n]=s.draw(d,o.paintStyleInUse),t=Math.min(t,o.overlayPlacements[n].minX),e=Math.max(e,o.overlayPlacements[n].maxX),u=Math.min(u,o.overlayPlacements[n].minY),l=Math.max(l,o.overlayPlacements[n].maxY));for(n=parseFloat(o.paintStyleInUse.lineWidth||1)/2,s=parseFloat(o.paintStyleInUse.lineWidth||0),t={xmin:Math.min(d.bounds.minX-(n+s),t),ymin:Math.min(d.bounds.minY-(n+s),u),xmax:Math.max(d.bounds.maxX+(n+s),e),ymax:Math.max(d.bounds.maxY+(n+s),l)},d.paint(o.paintStyleInUse,null,t),n=0;n<o.overlays.length;n++)s=o.overlays[n],s.isVisible()&&s.paint(o.overlayPlacements[n],t)}S=a}},this.repaint=function(t){t=t||{},this.paint({elId:this.sourceId,recalc:!1!==t.recalc,timestamp:t.timestamp,clearEdits:t.clearEdits})},(s=t.type||o.endpoints[0].connectionType||o.endpoints[1].connectionType)&&o.addType(s,t.data,r.isSuspendDrawing())}}(),function(){jsPlumb.DOMElementComponent=function(){jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.mousemove=this.dblclick=this.click=this.mousedown=this.mouseup=function(){}},jsPlumb.Segments={AbstractSegment:function(t){this.params=t,this.findClosestPointOnPath=function(){return{d:1/0,x:null,y:null,l:null}},this.getBounds=function(){return{minX:Math.min(t.x1,t.x2),minY:Math.min(t.y1,t.y2),maxX:Math.max(t.x1,t.x2),maxY:Math.max(t.y1,t.y2)}}},Straight:function(t){var e,n,o,i,r,s,a,l=this,u=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),function(){e=Math.sqrt(Math.pow(r-i,2)+Math.pow(a-s,2)),n=jsPlumbUtil.gradient({x:i,y:s},{x:r,y:a}),o=-1/n});this.type="Straight",l.getLength=function(){return e},l.getGradient=function(){return n},this.getCoordinates=function(){return{x1:i,y1:s,x2:r,y2:a}},this.setCoordinates=function(t){i=t.x1,s=t.y1,r=t.x2,a=t.y2,u()},this.setCoordinates({x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2}),this.getBounds=function(){return{minX:Math.min(i,r),minY:Math.min(s,a),maxX:Math.max(i,r),maxY:Math.max(s,a)}},this.pointOnPath=function(t,n){return 0!=t||n?1!=t||n?jsPlumbUtil.pointOnLine({x:i,y:s},{x:r,y:a},n?t>0?t:e+t:t*e):{x:r,y:a}:{x:i,y:s}},this.gradientAtPoint=function(){return n},this.pointAlongPathFrom=function(t,e,n){return n=l.pointOnPath(t,n),t=1==t?{x:i+10*(r-i),y:s+10*(s-a)}:0>=e?{x:i,y:s}:{x:r,y:a},0>=e&&1<Math.abs(e)&&(e*=-1),jsPlumbUtil.pointOnLine(n,t,e)},this.findClosestPointOnPath=function(t,r){if(0==n)return{x:t,y:s,d:Math.abs(r-s)};if(1/0==n||n==-1/0)return{x:i,y:r,d:Math.abs(t-1)};var a=s-n*i,l=(r-o*t-a)/(n-o),a=n*l+a,u=jsPlumbUtil.lineLength([t,r],[l,a]),c=jsPlumbUtil.lineLength([l,a],[i,s]);return{d:u,x:l,y:a,l:c/e}}},Arc:function(t){var e=this,n=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),function(e,n){return jsPlumbUtil.theta([t.cx,t.cy],[e,n])}),o=2*Math.PI;this.radius=t.r,this.anticlockwise=t.ac,this.type="Arc",t.startAngle&&t.endAngle?(this.startAngle=t.startAngle,this.endAngle=t.endAngle,this.x1=t.cx+e.radius*Math.cos(t.startAngle),this.y1=t.cy+e.radius*Math.sin(t.startAngle),this.x2=t.cx+e.radius*Math.cos(t.endAngle),this.y2=t.cy+e.radius*Math.sin(t.endAngle)):(this.startAngle=n(t.x1,t.y1),this.endAngle=n(t.x2,t.y2),this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2),0>this.endAngle&&(this.endAngle+=o),0>this.startAngle&&(this.startAngle+=o),this.segment=jsPlumbUtil.segment([this.x1,this.y1],[this.x2,this.y2]),e.sweep=Math.abs((e.endAngle<e.startAngle?e.endAngle+o:e.endAngle)-e.startAngle),e.anticlockwise&&(e.sweep=o-e.sweep);var i=2*Math.PI*e.radius,r=i*(e.sweep/o);this.getLength=function(){return r},this.getBounds=function(){return{minX:t.cx-t.r,maxX:t.cx+t.r,minY:t.cy-t.r,maxY:t.cy+t.r}};var s=function(t){var e=Math.floor(t),n=Math.ceil(t);return 1e-10>t-e?e:1e-10>n-t?n:t};this.pointOnPath=function(n,i){if(0==n)return{x:e.x1,y:e.y1,theta:e.startAngle};if(1==n)return{x:e.x2,y:e.y2,theta:e.endAngle};i&&(n/=r);var a;if(a=n,e.anticlockwise){var l=e.startAngle<e.endAngle?e.startAngle+o:e.startAngle,u=Math.abs(l-e.endAngle);a=l-u*a}else u=Math.abs((e.endAngle<e.startAngle?e.endAngle+o:e.endAngle)-e.startAngle),a=e.startAngle+u*a;return l=t.cx+t.r*Math.cos(a),u=t.cy+t.r*Math.sin(a),{x:s(l),y:s(u),theta:a}},this.gradientAtPoint=function(n,o){var i=e.pointOnPath(n,o),i=jsPlumbUtil.normal([t.cx,t.cy],[i.x,i.y]);return e.anticlockwise||1/0!=i&&i!=-1/0||(i*=-1),i},this.pointAlongPathFrom=function(n,o,r){return o=e.pointOnPath(n,r).theta+2*(e.anticlockwise?-1:1)*(o/i)*Math.PI,n=t.cx+e.radius*Math.cos(o),o=t.cy+e.radius*Math.sin(o),{x:n,y:o}}},Bezier:function(t){var e=(jsPlumb.Segments.AbstractSegment.apply(this,arguments),[{x:t.x1,y:t.y1},{x:t.cp1x,y:t.cp1y},{x:t.cp2x,y:t.cp2y},{x:t.x2,y:t.y2}]),n={minX:Math.min(t.x1,t.x2,t.cp1x,t.cp2x),minY:Math.min(t.y1,t.y2,t.cp1y,t.cp2y),maxX:Math.max(t.x1,t.x2,t.cp1x,t.cp2x),maxY:Math.max(t.y1,t.y2,t.cp1y,t.cp2y)};this.type="Bezier";var o=function(t,e,n){return n&&(e=jsBezier.locationAlongCurveFrom(t,e>0?0:1,e)),e};this.pointOnPath=function(t,n){return t=o(e,t,n),jsBezier.pointOnCurve(e,t)},this.gradientAtPoint=function(t,n){return t=o(e,t,n),jsBezier.gradientAtPoint(e,t)},this.pointAlongPathFrom=function(t,n,i){return t=o(e,t,i),jsBezier.pointAlongCurveFrom(e,t,n)},this.getLength=function(){return jsBezier.getLength(e)},this.getBounds=function(){return n}}};var t=function(){var t=this;t.resetBounds=function(){t.bounds={minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}},t.resetBounds()};jsPlumb.Connectors.AbstractConnector=function(e){t.apply(this,arguments);var n=this,o=[],i=0,r=[],s=[],a=e.stub||0,l=jsPlumbUtil.isArray(a)?a[0]:a,u=jsPlumbUtil.isArray(a)?a[1]:a,a=e.gap||0,c=jsPlumbUtil.isArray(a)?a[0]:a,d=jsPlumbUtil.isArray(a)?a[1]:a,h=null,p=!1,f=null;this.isEditable=function(){return!1},this.setEdited=function(t){p=t},this.getPath=function(){},this.setPath=function(){},this.findSegmentForPoint=function(t,e){for(var n={d:1/0,s:null,x:null,y:null,l:null},i=0;i<o.length;i++){var r=o[i].findClosestPointOnPath(t,e);r.d<n.d&&(n.d=r.d,n.l=r.l,n.x=r.x,n.y=r.y,n.s=o[i])}return n};var m=function(t,e){e&&(t=t>0?t/i:(i+t)/i);for(var n=r.length-1,a=1,l=0;l<r.length;l++)if(r[l][1]>=t){n=l,a=1==t?1:0==t?0:(t-r[l][0])/s[l];break}return{segment:o[n],proportion:a,index:n}};this.setSegments=function(t){h=[];for(var e=i=0;e<t.length;e++)h.push(t[e]),i+=t[e].getLength()};var g=function(t){n.lineWidth=t.lineWidth;var e=jsPlumbUtil.segment(t.sourcePos,t.targetPos),o=t.targetPos[0]<t.sourcePos[0],i=t.targetPos[1]<t.sourcePos[1],r=t.lineWidth||1,s=t.sourceEndpoint.anchor.orientation||t.sourceEndpoint.anchor.getOrientation(t.sourceEndpoint),a=t.targetEndpoint.anchor.orientation||t.targetEndpoint.anchor.getOrientation(t.targetEndpoint),h=o?t.targetPos[0]:t.sourcePos[0],p=i?t.targetPos[1]:t.sourcePos[1],f=Math.abs(t.targetPos[0]-t.sourcePos[0]),m=Math.abs(t.targetPos[1]-t.sourcePos[1]);if(0==s[0]&&0==s[1]||0==a[0]&&0==a[1]){var g=f>m?0:1,v=[1,0][g],s=[],a=[];s[g]=t.sourcePos[g]>t.targetPos[g]?-1:1,a[g]=t.sourcePos[g]>t.targetPos[g]?1:-1,s[v]=0,a[v]=0}return t=o?f+c*s[0]:c*s[0],g=i?m+c*s[1]:c*s[1],o=o?d*a[0]:f+d*a[0],i=i?d*a[1]:m+d*a[1],v=s[0]*a[0]+s[1]*a[1],e={sx:t,sy:g,tx:o,ty:i,lw:r,xSpan:Math.abs(o-t),ySpan:Math.abs(i-g),mx:(t+o)/2,my:(g+i)/2,so:s,to:a,x:h,y:p,w:f,h:m,segment:e,startStubX:t+s[0]*l,startStubY:g+s[1]*l,endStubX:o+a[0]*u,endStubY:i+a[1]*u,isXGreaterThanStubTimes2:Math.abs(t-o)>l+u,isYGreaterThanStubTimes2:Math.abs(g-i)>l+u,opposite:-1==v,perpendicular:0==v,orthogonal:1==v,sourceAxis:0==s[0]?"y":"x",points:[h,p,f,m,t,g,o,i]},e.anchorOrientation=e.opposite?"opposite":e.orthogonal?"orthogonal":"perpendicular",e};return this.getSegments=function(){return o},n.updateBounds=function(t){t=t.getBounds(),n.bounds.minX=Math.min(n.bounds.minX,t.minX),n.bounds.maxX=Math.max(n.bounds.maxX,t.maxX),n.bounds.minY=Math.min(n.bounds.minY,t.minY),n.bounds.maxY=Math.max(n.bounds.maxY,t.maxY)},this.pointOnPath=function(t,e){var n=m(t,e);return n.segment.pointOnPath(n.proportion,e)},this.gradientAtPoint=function(t){return t=m(t,absolute),t.segment.gradientAtPoint(t.proportion,absolute)},this.pointAlongPathFrom=function(t,e,n){return t=m(t,n),t.segment.pointAlongPathFrom(t.proportion,e,!1)},this.compute=function(t){p||(f=g(t)),i=0,o.splice(0,o.length),r.splice(0,r.length),s.splice(0,s.length),this._compute(f,t),n.x=f.points[0],n.y=f.points[1],n.w=f.points[2],n.h=f.points[3],n.segment=f.segment;for(var e=t=0;e<o.length;e++){var a=o[e].getLength();s[e]=a/i,r[e]=[t,t+=a/i]}},{addSegment:function(t,e){var r=new jsPlumb.Segments[t](e);o.push(r),i+=r.getLength(),n.updateBounds(r)},prepareCompute:g,sourceStub:l,targetStub:u,maxStub:Math.max(l,u),sourceGap:c,targetGap:d,maxGap:Math.max(c,d)}},jsPlumb.Connectors.Straight=function(){this.type="Straight";var t=jsPlumb.Connectors.AbstractConnector.apply(this,arguments);this._compute=function(e){t.addSegment("Straight",{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),t.addSegment("Straight",{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),t.addSegment("Straight",{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty})}},jsPlumb.Connectors.Bezier=function(t){t=t||{};var e=this,n=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),o=(t.stub||50,t.curviness||150);this.type="Bezier",this.getCurviness=function(){return o},this._findControlPoint=function(t,e,n,i,r){i=i.anchor.getOrientation(i),r=r.anchor.getOrientation(r);var s=[];return i[0]!=r[0]||i[1]==r[1]?(s.push(0==r[0]?n[0]<e[0]?t[0]+10:t[0]-10:t[0]+o*r[0]),s.push(0==r[1]?n[1]<e[1]?t[1]+10:t[1]-10:t[1]+o*i[1])):(s.push(0==i[0]?e[0]<n[0]?t[0]+10:t[0]-10:t[0]-o*i[0]),s.push(0==i[1]?e[1]<n[1]?t[1]+10:t[1]-10:t[1]+o*r[1])),s},this._compute=function(t,o){var i=o.sourcePos,r=o.targetPos,s=Math.abs(i[0]-r[0]),a=Math.abs(i[1]-r[1]),l=i[0]<r[0]?s:0,u=i[1]<r[1]?a:0,s=i[0]<r[0]?0:s,a=i[1]<r[1]?0:a,c=e._findControlPoint([l,u],i,r,o.sourceEndpoint,o.targetEndpoint),i=e._findControlPoint([s,a],r,i,o.targetEndpoint,o.sourceEndpoint);n.addSegment("Bezier",{x1:l,y1:u,x2:s,y2:a,cp1x:c[0],cp1y:c[1],cp2x:i[0],cp2y:i[1]})}},jsPlumb.Endpoints.AbstractEndpoint=function(e){t.apply(this,arguments);var n=this;return this.compute=function(){var t=n._compute.apply(n,arguments);return n.x=t[0],n.y=t[1],n.w=t[2],n.h=t[3],n.bounds.minX=n.x,n.bounds.minY=n.y,n.bounds.maxX=n.x+n.w,n.bounds.maxY=n.y+n.h,t},{compute:n.compute,cssClass:e.cssClass}},jsPlumb.Endpoints.Dot=function(t){this.type="Dot";var e=this;jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},this.radius=t.radius||10,this.defaultOffset=.5*this.radius,this.defaultInnerRadius=this.radius/3,this._compute=function(t,n,o){e.radius=o.radius||e.radius,n=t[0]-e.radius,t=t[1]-e.radius;var i=2*e.radius,r=2*e.radius;return o.strokeStyle&&(o=o.lineWidth||1,n-=o,t-=o,i+=2*o,r+=2*o),[n,t,i,r,e.radius]
}},jsPlumb.Endpoints.Rectangle=function(t){this.type="Rectangle";var e=this;jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},this.width=t.width||20,this.height=t.height||20,this._compute=function(t,n,o){return n=o.width||e.width,o=o.height||e.height,[t[0]-n/2,t[1]-o/2,n,o]}};var e=function(){jsPlumb.DOMElementComponent.apply(this,arguments);var t=[];this.getDisplayElements=function(){return t},this.appendDisplayElement=function(e){t.push(e)}};jsPlumb.Endpoints.Image=function(t){this.type="Image",e.apply(this,arguments);var n=this,o=(jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),!1),i=!1,r=t.width,s=t.height,a=null,l=t.endpoint;this.img=new Image,n.ready=!1,this.img.onload=function(){n.ready=!0,r=r||n.img.width,s=s||n.img.height,a&&a(n)},l.setImage=function(t,e){t.constructor==String?t:t.src,a=e,n.img.src=t,null!=n.canvas&&n.canvas.setAttribute("src",t)},l.setImage(t.src||t.url,t.onload),this._compute=function(t){return n.anchorPoint=t,n.ready?[t[0]-r/2,t[1]-s/2,r,s]:[0,0,0,0]},n.canvas=document.createElement("img"),o=!1,n.canvas.style.margin=0,n.canvas.style.padding=0,n.canvas.style.outline=0,n.canvas.style.position="absolute",n.canvas.className=jsPlumb.endpointClass+(t.cssClass?" "+t.cssClass:""),r&&n.canvas.setAttribute("width",r),s&&n.canvas.setAttribute("height",s),jsPlumb.appendElement(n.canvas,t.parent),n.attachListeners(n.canvas,n),n.cleanup=function(){i=!0},this.paint=function(t,e){n.ready?i||(o||(n.canvas.setAttribute("src",n.img.src),n.appendDisplayElement(n.canvas),o=!0),jsPlumb.sizeCanvas(n.canvas,n.anchorPoint[0]-r/2,n.anchorPoint[1]-s/2,r,s)):window.setTimeout(function(){n.paint(t,e)},200)}},jsPlumb.Endpoints.Blank=function(t){var n=this;jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),this.type="Blank",e.apply(this,arguments),this._compute=function(t){return[t[0],t[1],10,0]},n.canvas=document.createElement("div"),n.canvas.style.display="block",n.canvas.style.width="1px",n.canvas.style.height="1px",n.canvas.style.background="transparent",n.canvas.style.position="absolute",n.canvas.className=n._jsPlumb.endpointClass,jsPlumb.appendElement(n.canvas,t.parent),this.paint=function(){jsPlumb.sizeCanvas(n.canvas,n.x,n.y,n.w,n.h)}},jsPlumb.Endpoints.Triangle=function(t){this.type="Triangle";var e=this;jsPlumb.Endpoints.AbstractEndpoint.apply(this,arguments),t=t||{},t.width=t.width||55,t.height=t.height||55,this.width=t.width,this.height=t.height,this._compute=function(t,n,o){return n=o.width||e.width,o=o.height||e.height,[t[0]-n/2,t[1]-o/2,n,o]}};var n=jsPlumb.Overlays.AbstractOverlay=function(t){var e=!0,n=this;this.isAppendedAtTopLevel=!0,this.component=t.component,this.loc=null==t.location?.5:t.location,this.endpointLoc=null==t.endpointLocation?[.5,.5]:t.endpointLocation,this.setVisible=function(t){e=t,n.component.repaint()},this.isVisible=function(){return e},this.hide=function(){n.setVisible(!1)},this.show=function(){n.setVisible(!0)},this.incrementLocation=function(t){n.loc+=t,n.component.repaint()},this.setLocation=function(t){n.loc=t,n.component.repaint()},this.getLocation=function(){return n.loc}};jsPlumb.Overlays.Arrow=function(t){this.type="Arrow",n.apply(this,arguments),this.isAppendedAtTopLevel=!1,t=t||{};var e=this,o=jsPlumbUtil;this.length=t.length||20,this.width=t.width||20,this.id=t.id;var i=0>(t.direction||1)?-1:1,r=t.paintStyle||{lineWidth:1},s=t.foldback||.623;this.computeMaxSize=function(){return 1.5*e.width},this.cleanup=function(){},this.draw=function(t,n){var a,l,u;return t.pointAlongPathFrom?(o.isString(e.loc)||1<e.loc||0>e.loc?(u=parseInt(e.loc),a=t.pointAlongPathFrom(u,i*e.length/2,!0),l=t.pointOnPath(u,!0),u=o.pointOnLine(a,l,e.length)):1==e.loc?(a=t.pointOnPath(e.loc),l=t.pointAlongPathFrom(e.loc,-e.length),u=o.pointOnLine(a,l,e.length),-1==i&&(l=u,u=a,a=l)):0==e.loc?(u=t.pointOnPath(e.loc),l=t.pointAlongPathFrom(e.loc,e.length),a=o.pointOnLine(u,l,e.length),-1==i&&(l=u,u=a,a=l)):(a=t.pointAlongPathFrom(e.loc,i*e.length/2),l=t.pointOnPath(e.loc),u=o.pointOnLine(a,l,e.length)),l=o.perpendicularLineTo(a,u,e.width),u=o.pointOnLine(a,u,s*e.length),{component:t,d:{hxy:a,tail:l,cxy:u},lineWidth:r.lineWidth||n.lineWidth,strokeStyle:r.strokeStyle||n.strokeStyle,fillStyle:r.fillStyle||n.strokeStyle,minX:Math.min(a.x,l[0].x,l[1].x),maxX:Math.max(a.x,l[0].x,l[1].x),minY:Math.min(a.y,l[0].y,l[1].y),maxY:Math.max(a.y,l[0].y,l[1].y)}):{component:t,minX:0,maxX:0,minY:0,maxY:0}}},jsPlumb.Overlays.PlainArrow=function(t){t=t||{},t=jsPlumb.extend(t,{foldback:1}),jsPlumb.Overlays.Arrow.call(this,t),this.type="PlainArrow"},jsPlumb.Overlays.Diamond=function(t){t=t||{},t=jsPlumb.extend(t,{length:(t.length||40)/2,foldback:2}),jsPlumb.Overlays.Arrow.call(this,t),this.type="Diamond"};var o=function(t){jsPlumb.DOMElementComponent.apply(this,arguments),n.apply(this,arguments);var e=this,o=!1,i=jsPlumb.CurrentLibrary;t=t||{},this.id=t.id;var r;this.getElement=function(){return null==r&&(r=t.create(t.component),r=i.getDOMElement(r),r.style.position="absolute",r.className=t._jsPlumb.overlayClass+" "+(e.cssClass?e.cssClass:t.cssClass?t.cssClass:""),t._jsPlumb.appendElement(r,t.component.parent),t._jsPlumb.getId(r),e.attachListeners(r,e),e.canvas=r),r},this.getDimensions=function(){return i.getSize(i.getElementObject(e.getElement()))};var s=null;this.clearCachedDimensions=function(){s=null},this.computeMaxSize=function(){var t=(null==s&&(s=e.getDimensions()),s);return Math.max(t[0],t[1])};var a=e.setVisible;e.setVisible=function(t){a(t),r.style.display=t?"block":"none"},this.cleanup=function(){null!=r&&i.removeElement(r)},this.paint=function(t){o||(e.getElement(),t.component.appendDisplayElement(r),e.attachListeners(r,t.component),o=!0),r.style.left=t.component.x+t.d.minx+"px",r.style.top=t.component.y+t.d.miny+"px"},this.draw=function(t){var n=(null==s&&(s=e.getDimensions()),s);if(null!=n&&2==n.length){var o={x:0,y:0};if(t.pointOnPath){var o=e.loc,i=!1;(jsPlumbUtil.isString(e.loc)||0>e.loc||1<e.loc)&&(o=parseInt(e.loc),i=!0),o=t.pointOnPath(o,i)}else o=e.loc.constructor==Array?e.loc:e.endpointLoc,o={x:o[0]*t.w,y:o[1]*t.h};var i=o.x-n[0]/2,r=o.y-n[1]/2;return{component:t,d:{minx:i,miny:r,td:n,cxy:o},minX:i,maxX:i+n[0],minY:r,maxY:r+n[1]}}return{minX:0,maxX:0,minY:0,maxY:0}},this.reattachListeners=function(t){r&&e.reattachListenersForElement(r,e,t)}};jsPlumb.Overlays.Custom=function(){this.type="Custom",o.apply(this,arguments)},jsPlumb.Overlays.GuideLines=function(){var t=this;t.length=50,t.lineWidth=5,this.type="GuideLines",n.apply(this,arguments),jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.draw=function(e){var n=e.pointAlongPathFrom(t.loc,t.length/2),o=e.pointOnPath(t.loc),o=jsPlumbUtil.pointOnLine(n,o,t.length),i=jsPlumbUtil.perpendicularLineTo(n,o,40),r=jsPlumbUtil.perpendicularLineTo(o,n,20);return{connector:e,head:n,tail:o,headLine:r,tailLine:i,minX:Math.min(n.x,o.x,r[0].x,r[1].x),minY:Math.min(n.y,o.y,r[0].y,r[1].y),maxX:Math.max(n.x,o.x,r[0].x,r[1].x),maxY:Math.max(n.y,o.y,r[0].y,r[1].y)}},this.cleanup=function(){}},jsPlumb.Overlays.Label=function(t){var e=this;this.labelStyle=t.labelStyle||jsPlumb.Defaults.LabelStyle,this.cssClass=null!=this.labelStyle?this.labelStyle.cssClass:null,t.create=function(){return document.createElement("div")},jsPlumb.Overlays.Custom.apply(this,arguments),this.type="Label";var n=t.label||"",e=this,o=null;this.setLabel=function(t){n=t,o=null,e.clearCachedDimensions(),i(),e.component.repaint()};var i=function(){if("function"==typeof n){var t=n(e);e.getElement().innerHTML=t.replace(/\r\n/g,"<br/>")}else null==o&&(o=n,e.getElement().innerHTML=o.replace(/\r\n/g,"<br/>"))};this.getLabel=function(){return n};var r=this.getDimensions;this.getDimensions=function(){return i(),r()}}}(),function(){jsPlumb.Connectors.StateMachine=function(t){t=t||{},this.type="StateMachine";var e=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),n=t.curviness||10,o=t.margin||5,i=t.proximityLimit||80,r=t.orientation&&"clockwise"===t.orientation,s=t.loopbackRadius||25,a=!1!==t.showLoopback;this._compute=function(t,l){var u=Math.abs(l.sourcePos[0]-l.targetPos[0]),c=Math.abs(l.sourcePos[1]-l.targetPos[1]),d=Math.min(l.sourcePos[0],l.targetPos[0]),h=Math.min(l.sourcePos[1],l.targetPos[1]);if(a&&l.sourceEndpoint.elementId===l.targetEndpoint.elementId){var p=l.sourcePos[0],f=(l.sourcePos[0],l.sourcePos[1]-o),m=(l.sourcePos[1]-o,p),g=f-s,u=2*s,c=2*s,d=m-s,h=g-s;t.points[0]=d,t.points[1]=h,t.points[2]=u,t.points[3]=c,e.addSegment("Arc",{x1:p-d+4,y1:f-h,startAngle:0,endAngle:2*Math.PI,r:s,ac:!r,x2:p-d-4,y2:f-h,cx:m-d,cy:g-h})}else d=l.sourcePos[0]<l.targetPos[0]?0:u,h=l.sourcePos[1]<l.targetPos[1]?0:c,u=l.sourcePos[0]<l.targetPos[0]?u:0,c=l.sourcePos[1]<l.targetPos[1]?c:0,0===l.sourcePos[2]&&(d-=o),1===l.sourcePos[2]&&(d+=o),0===l.sourcePos[3]&&(h-=o),1===l.sourcePos[3]&&(h+=o),0===l.targetPos[2]&&(u-=o),1===l.targetPos[2]&&(u+=o),0===l.targetPos[3]&&(c-=o),1===l.targetPos[3]&&(c+=o),p=(d+u)/2,f=(h+c)/2,m=-1*p/f,g=Math.atan(m),1/0==m||m==-1/0?0:Math.abs(n/2*Math.sin(g)),1/0==m||m==-1/0?0:Math.abs(n/2*Math.cos(g)),m=u>=d&&h>=c?1:u>=d&&c>=h?2:d>=u&&c>=h?3:4,g=Math.sqrt(Math.pow(u-d,2)+Math.pow(c-h,2)),p=i>=g?[p,f]:1===m?0>=l.sourcePos[3]&&1<=l.targetPos[3]?[p+(.5>l.sourcePos[2]?-1*n:n),f]:1<=l.sourcePos[2]&&0>=l.targetPos[2]?[p,f+(.5>l.sourcePos[3]?-1*n:n)]:[p+-1*n,f+-1*n]:2===m?1<=l.sourcePos[3]&&0>=l.targetPos[3]?[p+(.5>l.sourcePos[2]?-1*n:n),f]:1<=l.sourcePos[2]&&0>=l.targetPos[2]?[p,f+(.5>l.sourcePos[3]?-1*n:n)]:[p+1*n,f+-1*n]:3===m?1<=l.sourcePos[3]&&0>=l.targetPos[3]?[p+(.5>l.sourcePos[2]?-1*n:n),f]:0>=l.sourcePos[2]&&1<=l.targetPos[2]?[p,f+(.5>l.sourcePos[3]?-1*n:n)]:[p+-1*n,f+-1*n]:4===m?0>=l.sourcePos[3]&&1<=l.targetPos[3]?[p+(.5>l.sourcePos[2]?-1*n:n),f]:0>=l.sourcePos[2]&&1<=l.targetPos[2]?[p,f+(.5>l.sourcePos[3]?-1*n:n)]:[p+1*n,f+-1*n]:void 0,e.addSegment("Bezier",{x1:u,y1:c,x2:d,y2:h,cp1x:p[0],cp1y:p[1],cp2x:p[0],cp2y:p[1]})}}}(),function(){jsPlumb.Connectors.Flowchart=function(s){this.type="Flowchart",s=s||{},s.stub=s.stub||30;var n=jsPlumb.Connectors.AbstractConnector.apply(this,arguments),e=s.midpoint||.5,a=[],c=(s.grid,s.alwaysRespectStubs),d=null,r=null,h=null,p=null!=s.cornerRadius?s.cornerRadius:0,g=function(t,e,n,o){if(r!=e||h!=n){var i=null==r?o.sx:r;o=null==h?o.sy:h,r=e,h=n,t.push([i,o,e,n,i==e?"v":"h",0>e-i?-1:0==e-i?0:1,0>n-o?-1:0==n-o?0:1])}},v=function(t){return Math.sqrt(Math.pow(t[0]-t[2],2)+Math.pow(t[1]-t[3],2))},l=function(t){var e=[];return e.push.apply(e,t),e},f=function(t,e){for(var o,i,r=0;r<t.length-1;r++){if(o=o||l(t[r]),i=l(t[r+1]),p>0&&o[4]!=i[4]){var s=Math.min(p,v(o),v(i));o[2]-=o[5]*s,o[3]-=o[6]*s,i[0]+=i[5]*s,i[1]+=i[6]*s;var a=o[6]==i[5]&&1==i[5]||o[6]==i[5]&&0==i[5]&&o[5]!=i[6]||o[6]==i[5]&&-1==i[5],u=(i[1]>o[3]?1:-1)==(i[0]>o[2]?1:-1),c=u&&a||!u&&!a?i[0]:o[2],u=u&&a||!u&&!a?o[3]:i[1];n.addSegment("Straight",{x1:o[0],y1:o[1],x2:o[2],y2:o[3]}),n.addSegment("Arc",{r:s,x1:o[2],y1:o[3],x2:i[0],y2:i[1],cx:c,cy:u,ac:a})}else s=o[2]==o[0]?0:o[2]>o[0]?e.lw/2:-(e.lw/2),a=o[3]==o[1]?0:o[3]>o[1]?e.lw/2:-(e.lw/2),n.addSegment("Straight",{x1:o[0]-s,y1:o[1]-a,x2:o[2]+s,y2:o[3]+a});o=i}n.addSegment("Straight",{x1:i[0],y1:i[1],x2:i[2],y2:i[3]})};this.setSegments=function(t){d=t},this.isEditable=function(){return!0},this.getOriginalSegments=function(){return d||a},this._compute=function(b,l){if(l.clearEdits&&(d=null),null!=d)return void f(d,b);a=[],h=r=null;var k=b.startStubX+(b.endStubX-b.startStubX)*e,q=b.startStubY+(b.endStubY-b.startStubY)*e,u={x:[0,1],y:[1,0]},p=function(){return[b.startStubX,b.startStubY,b.endStubX,b.endStubY]},p={perpendicular:p,orthogonal:p,opposite:function(t){var e="x"==t?0:1,n={x:function(){return 1==b.so[e]&&(b.startStubX>b.endStubX&&b.tx>b.startStubX||b.sx>b.endStubX&&b.tx>b.sx)||-1==b.so[e]&&(b.startStubX<b.endStubX&&b.tx<b.startStubX||b.sx<b.endStubX&&b.tx<b.sx)},y:function(){return 1==b.so[e]&&(b.startStubY>b.endStubY&&b.ty>b.startStubY||b.sy>b.endStubY&&b.ty>b.sy)||-1==b.so[e]&&(b.startStubY<b.endStubY&&b.ty<b.startStubY||b.sy<b.endStubY&&b.ty<b.sy)}};return!c&&n[t]()?{x:[(b.sx+b.tx)/2,b.startStubY,(b.sx+b.tx)/2,b.endStubY],y:[b.startStubX,(b.sy+b.ty)/2,b.endStubX,(b.sy+b.ty)/2]}[t]:[b.startStubX,b.startStubY,b.endStubX,b.endStubY]}}[b.anchorOrientation](b.sourceAxis),m="x"==b.sourceAxis?0:1,s="x"==b.sourceAxis?1:0,w=p[m],v=p[s],H=p[m+2],s=p[s+2];if(g(a,p[0],p[1],b),w={perpendicular:function(a,c,d,e,f){with(b){var l={x:[[startStubX,endStubX],null,[endStubX,startStubX]],y:[[startStubY,endStubY],null,[endStubY,startStubY]]};c={x:[[k,startStubY],[k,endStubY]],y:[[startStubX,q],[endStubX,q]]},d={x:[[endStubX,startStubY]],y:[[startStubX,endStubY]]},e={x:[[startStubX,endStubY],[endStubX,endStubY]],y:[[endStubX,startStubY],[endStubX,endStubY]]},f={x:[[startStubX,q],[endStubX,q],[endStubX,endStubY]],y:[[k,startStubY],[k,endStubY],[endStubX,endStubY]]};var t={x:[startStubY,endStubY],y:[startStubX,endStubX]},g=u[a][1],m=so[u[a][0]]+1,t=-1==to[g]&&t[a][1]<t[a][0]||1==to[g]&&t[a][1]>t[a][0],h=l[a][m][0],l=l[a][m][1],g={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[a][m][to[g]+1];if(segment==g[3]||segment==g[2]&&t)return c[a];if(segment==g[2]&&h>l)return d[a];if(segment==g[2]&&l>=h||segment==g[1]&&!t)return f[a];if(segment==g[0]||segment==g[1]&&t)return e[a]}},orthogonal:function(t,e,n,o,i){return e={x:-1==b.so[0]?Math.min(e,o):Math.max(e,o),y:-1==b.so[1]?Math.min(e,o):Math.max(e,o)}[t],{x:[[e,n],[e,i],[o,i]],y:[[n,e],[i,e],[i,o]]}[t]},opposite:function(t,e,o,i){var r={x:"y",y:"x"}[t],s={x:"height",y:"width"}[t],a=b["is"+t.toUpperCase()+"GreaterThanStubTimes2"];return l.sourceEndpoint.elementId==l.targetEndpoint.elementId?(o=o+(1-l.sourceEndpoint.anchor[r])*l.sourceInfo[s]+n.maxStub,{x:[[e,o],[i,o]],y:[[o,e],[o,i]]}[t]):!a||1==b.so[m]&&e>i||-1==b.so[m]&&i>e?{x:[[e,q],[i,q]],y:[[k,e],[k,i]]}[t]:1==b.so[m]&&i>e||-1==b.so[m]&&e>i?{x:[[k,b.sy],[k,b.ty]],y:[[b.sx,q],[b.tx,q]]}[t]:void 0}}[b.anchorOrientation](b.sourceAxis,w,v,H,s))for(v=0;v<w.length;v++)g(a,w[v][0],w[v][1],b);g(a,p[2],p[3],b),g(a,b.tx,b.ty,b),f(a,b)},this.getPath=function(){for(var t=null,e=null,n=[],o=d||a,i=0;i<o.length;i++){var r=o[i],s=r[4],l="v"==s?3:2;null!=t&&e===s?t[l]=r[l]:(r[0]!=r[2]||r[1]!=r[3])&&(n.push({start:[r[0],r[1]],end:[r[2],r[3]]}),t=r,e=r[4])}return n},this.setPath=function(t){d=[];for(var e=0;e<t.length;e++){var n=t[e].start[0],o=t[e].start[1],i=t[e].end[0],r=t[e].end[1];d.push([n,o,i,r,n==i?"v":"h",0>i-n?-1:0==i-n?0:1,0>r-o?-1:0==r-o?0:1])}}}}(),function(){var t={"stroke-linejoin":"joinstyle",joinstyle:"joinstyle",endcap:"endcap",miterlimit:"miterlimit"},e=null;if(document.createStyleSheet&&document.namespaces){for(var n=".jsplumb_vml jsplumb\\:textbox jsplumb\\:oval jsplumb\\:rect jsplumb\\:stroke jsplumb\\:shape jsplumb\\:group".split(" "),e=document.createStyleSheet(),o=0;o<n.length;o++)e.addRule(n[o],"behavior:url(#default#VML);position:absolute;");document.namespaces.add("jsplumb","urn:schemas-microsoft-com:vml")}jsPlumb.vml={};var i=function(t,e){for(var n in e)t[n]=e[n]},r=function(t,e,n,o,r,a){return n=n||{},t=document.createElement("jsplumb:"+t),a?r.appendElement(t,o):jsPlumb.CurrentLibrary.appendElement(t,o),t.className=(n.class?n.class+" ":"")+"jsplumb_vml",s(t,e),i(t,n),t},s=function(t,e,n){t.style.left=e[0]+"px",t.style.top=e[1]+"px",t.style.width=e[2]+"px",t.style.height=e[3]+"px",t.style.position="absolute",n&&(t.style.zIndex=n)},a=jsPlumb.vml.convertValue=function(t){return Math.floor(1e3*t)},l=function(t,e,n,o){var s={};if(e.strokeStyle){s.stroked="true";var a=jsPlumbUtil.convertStyle(e.strokeStyle,!0);s.strokecolor=a,"transparent"===a?n.setOpacity("stroke","0.0"):n.setOpacity("stroke","1.0"),s.strokeweight=e.lineWidth+"px"}else s.stroked="false";if(e.fillStyle?(s.filled="true",a=jsPlumbUtil.convertStyle(e.fillStyle,!0),s.fillcolor=a,"transparent"===a?n.setOpacity("fill","0.0"):n.setOpacity("fill","1.0")):s.filled="false",e.dashstyle)null==n.strokeNode?n.strokeNode=r("stroke",[0,0,0,0],{dashstyle:e.dashstyle},t,o):n.strokeNode.dashstyle=e.dashstyle;else if(e["stroke-dasharray"]&&e.lineWidth){for(var a=-1==e["stroke-dasharray"].indexOf(",")?" ":",",l=e["stroke-dasharray"].split(a),u="",c=0;c<l.length;c++)u+=Math.floor(l[c]/e.lineWidth)+a;null==n.strokeNode?n.strokeNode=r("stroke",[0,0,0,0],{dashstyle:u},t,o):n.strokeNode.dashstyle=u}i(t,s)},u=function(){var t=this;jsPlumb.jsPlumbUIComponent.apply(this,arguments),this.opacityNodes={stroke:null,fill:null},this.initOpacityNodes=function(e){t.opacityNodes.stroke=r("stroke",[0,0,1,1],{opacity:"0.0"},e,t._jsPlumb),t.opacityNodes.fill=r("fill",[0,0,1,1],{opacity:"0.0"},e,t._jsPlumb)},this.setOpacity=function(e,n){var o=t.opacityNodes[e];o&&(o.opacity=""+n)};var e=[];this.getDisplayElements=function(){return e},this.appendDisplayElement=function(n,o){o||t.canvas.parentNode.appendChild(n),e.push(n)}},c=(jsPlumb.ConnectorRenderers.vml=function(e){var n=this;n.strokeNode=null,n.canvas=null,u.apply(this,arguments);var o=n._jsPlumb.connectorClass+(e.cssClass?" "+e.cssClass:"");this.paint=function(a){if(null!==a){for(var u=n.getSegments(),c={path:""},d=[n.x,n.y,n.w,n.h],h=0;h<u.length;h++)c.path+=jsPlumb.Segments.vml.SegmentRenderer.getPath(u[h]),c.path+=" ";if(a.outlineColor){var p,u=a.lineWidth+2*(a.outlineWidth||1),u={strokeStyle:jsPlumbUtil.convertStyle(a.outlineColor),lineWidth:u};for(p in t)u[p]=a[p];null==n.bgCanvas?(c.class=o,c.coordsize=1e3*d[2]+","+1e3*d[3],n.bgCanvas=r("shape",d,c,e.parent,n._jsPlumb,!0),s(n.bgCanvas,d),n.appendDisplayElement(n.bgCanvas,!0),n.attachListeners(n.bgCanvas,n),n.initOpacityNodes(n.bgCanvas,["stroke"])):(c.coordsize=1e3*d[2]+","+1e3*d[3],s(n.bgCanvas,d),i(n.bgCanvas,c)),l(n.bgCanvas,u,n)}null==n.canvas?(c.class=o,c.coordsize=1e3*d[2]+","+1e3*d[3],n.canvas=r("shape",d,c,e.parent,n._jsPlumb,!0),n.appendDisplayElement(n.canvas,!0),n.attachListeners(n.canvas,n),n.initOpacityNodes(n.canvas,["stroke"])):(c.coordsize=1e3*d[2]+","+1e3*d[3],s(n.canvas,d),i(n.canvas,c)),l(n.canvas,a,n,n._jsPlumb)}},this.reattachListeners=function(){n.canvas&&n.reattachListenersForElement(n.canvas,n)}},window.VmlEndpoint=function(t){u.apply(this,arguments);var e=null,n=this;n.canvas=document.createElement("div"),n.canvas.style.position="absolute";var o=n._jsPlumb.endpointClass+(t.cssClass?" "+t.cssClass:"");t._jsPlumb.appendElement(n.canvas,t.parent),this.paint=function(t,r){var a={};jsPlumb.sizeCanvas(n.canvas,n.x,n.y,n.w,n.h),null==e?(a.class=o,e=n.getVml([0,0,n.w,n.h],a,r,n.canvas,n._jsPlumb),n.attachListeners(e,n),n.appendDisplayElement(e,!0),n.appendDisplayElement(n.canvas,!0),n.initOpacityNodes(e,["fill"])):(s(e,[0,0,n.w,n.h]),i(e,a)),l(e,t,n)},this.reattachListeners=function(){e&&n.reattachListenersForElement(e,n)}});jsPlumb.Segments.vml={SegmentRenderer:{getPath:function(t){return{Straight:function(t){return t=t.params,"m"+a(t.x1)+","+a(t.y1)+" l"+a(t.x2)+","+a(t.y2)+" e"},Bezier:function(t){return t=t.params,"m"+a(t.x1)+","+a(t.y1)+" c"+a(t.cp1x)+","+a(t.cp1y)+","+a(t.cp2x)+","+a(t.cp2y)+","+a(t.x2)+","+a(t.y2)+" e"},Arc:function(t){var e=t.params,n=Math.min(e.x1,e.x2),o=(Math.max(e.x1,e.x2),Math.min(e.y1,e.y2)),i=(Math.max(e.y1,e.y2),t.anticlockwise?1:0);return(t.anticlockwise?"at ":"wa ")+function(){var r=[null,[function(){return[n,o]},function(){return[n-e.r,o-e.r]}],[function(){return[n-e.r,o]},function(){return[n,o-e.r]}],[function(){return[n-e.r,o-e.r]},function(){return[n,o]}],[function(){return[n,o-e.r]},function(){return[n-e.r,o]}]][t.segment][i]();return a(r[0])+","+a(r[1])+","+a(r[0]+2*e.r)+","+a(r[1]+2*e.r)}()+","+a(e.x1)+","+a(e.y1)+","+a(e.x2)+","+a(e.y2)+" e"}}[t.type](t)}}},jsPlumb.Endpoints.vml.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),c.apply(this,arguments),this.getVml=function(t,e,n,o,i){return r("oval",t,e,o,i)}},jsPlumb.Endpoints.vml.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),c.apply(this,arguments),this.getVml=function(t,e,n,o,i){return r("rect",t,e,o,i)}},jsPlumb.Endpoints.vml.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.vml.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.vml.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.vml.Custom=jsPlumb.Overlays.Custom;var d=function(t,e){t.apply(this,e),u.apply(this,e);var n=this;n.canvas=null,n.isAppendedAtTopLevel=!0,this.paint=function(t){var o={},l=t.d,u=t.component;t.strokeStyle&&(o.stroked="true",o.strokecolor=jsPlumbUtil.convertStyle(t.strokeStyle,!0)),t.lineWidth&&(o.strokeweight=t.lineWidth+"px"),t.fillStyle&&(o.filled="true",o.fillcolor=t.fillStyle),t=Math.min(l.hxy.x,l.tail[0].x,l.tail[1].x,l.cxy.x);var c=Math.min(l.hxy.y,l.tail[0].y,l.tail[1].y,l.cxy.y),d=Math.max(l.hxy.x,l.tail[0].x,l.tail[1].x,l.cxy.x),h=Math.max(l.hxy.y,l.tail[0].y,l.tail[1].y,l.cxy.y),d=Math.abs(d-t),h=Math.abs(h-c);t=[t,c,d,h],o.path="m "+a(l.hxy.x)+","+a(l.hxy.y)+" l "+a(l.tail[0].x)+","+a(l.tail[0].y)+" "+a(l.cxy.x)+","+a(l.cxy.y)+" "+a(l.tail[1].x)+","+a(l.tail[1].y)+" x e",o.coordsize=1e3*u.w+","+1e3*u.h,t[0]=u.x,t[1]=u.y,t[2]=u.w,t[3]=u.h,null==n.canvas?(o.class=(e&&1==e.length?e[0].cssClass||"":"")+" "+(u._jsPlumb.overlayClass||""),n.canvas=r("shape",t,o,u.canvas.parentNode,u._jsPlumb,!0),u.appendDisplayElement(n.canvas,!0),n.attachListeners(n.canvas,u),n.attachListeners(n.canvas,n)):(s(n.canvas,t),i(n.canvas,o))},this.reattachListeners=function(){n.canvas&&n.reattachListenersForElement(n.canvas,n)},this.cleanup=function(){null!=n.canvas&&jsPlumb.CurrentLibrary.removeElement(n.canvas)}};jsPlumb.Overlays.vml.Arrow=function(){d.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumb.Overlays.vml.PlainArrow=function(){d.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumb.Overlays.vml.Diamond=function(){d.apply(this,[jsPlumb.Overlays.Diamond,arguments])}}(),function(){var t={joinstyle:"stroke-linejoin","stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},e=function(t,e){for(var n in e)t.setAttribute(n,""+e[n])},n=function(t,n){var o=document.createElementNS("http://www.w3.org/2000/svg",t);return n=n||{},n.version="1.1",n.xmlns="http://www.w3.org/1999/xhtml",e(o,n),o},o=function(t){return"position:absolute;left:"+t[0]+"px;top:"+t[1]+"px"},i=function(t){for(var e=0;e<t.childNodes.length;e++)"linearGradient"!=t.childNodes[e].tagName&&"radialGradient"!=t.childNodes[e].tagName||t.removeChild(t.childNodes[e])},r=function(t,e,o,r,s){r="jsplumb_gradient_"+s._jsPlumb.idstamp(),i(t);var a;for(a=o.gradient.offset?n("radialGradient",{id:r}):n("linearGradient",{id:r,gradientUnits:"userSpaceOnUse"}),t.appendChild(a),t=0;t<o.gradient.stops.length;t++){var l=jsPlumbUtil.convertStyle(o.gradient.stops[1==s.segment||2==s.segment?t:o.gradient.stops.length-1-t][1],!0),l=n("stop",{offset:Math.floor(100*o.gradient.stops[t][0])+"%","stop-color":l});a.appendChild(l)}e.setAttribute("style",(o.strokeStyle?"stroke":"fill")+":url(#"+r+")")},s=function(e,n,o,s,a){if(o.gradient?r(e,n,o,s,a):(i(e),n.setAttribute("style","")),n.setAttribute("fill",o.fillStyle?jsPlumbUtil.convertStyle(o.fillStyle,!0):"none"),n.setAttribute("stroke",o.strokeStyle?jsPlumbUtil.convertStyle(o.strokeStyle,!0):"none"),o.lineWidth&&n.setAttribute("stroke-width",o.lineWidth),o.dashstyle&&o.lineWidth&&!o["stroke-dasharray"]){var l=-1==o.dashstyle.indexOf(",")?" ":",",u="";o.dashstyle.split(l).forEach(function(t){u+=Math.floor(t*o.lineWidth)+l}),n.setAttribute("stroke-dasharray",u)}else o["stroke-dasharray"]&&n.setAttribute("stroke-dasharray",o["stroke-dasharray"]);for(var c in t)o[c]&&n.setAttribute(t[c],o[c])},a=function(t,e,n){n=n.split(" ");for(var o=t.className.baseVal.split(" "),i=0;i<n.length;i++)if(e)-1==o.indexOf(n[i])&&o.push(n[i]);else{var r=o.indexOf(n[i]);-1!=r&&o.splice(r,1)}t.className.baseVal=o.join(" ")};jsPlumbUtil.svg={addClass:function(t,e){a(t,!0,e)},removeClass:function(t,e){a(t,!1,e)},node:n,attr:e,pos:o};var l=function(t){var i=this,r=t.pointerEventsSpec||"all",s={};jsPlumb.jsPlumbUIComponent.apply(this,t.originalArgs),i.canvas=null,i.path=null,i.svg=null;var a=t.cssClass+" "+(t.originalArgs[0].cssClass||"");i.svg=n("svg",{style:"",width:0,height:0,"pointer-events":r,position:"absolute"}),t.useDivWrapper?(i.canvas=document.createElement("div"),i.canvas.style.position="absolute",jsPlumb.sizeCanvas(i.canvas,0,0,1,1),i.canvas.className=a):(e(i.svg,{class:a}),i.canvas=i.svg),t._jsPlumb.appendElement(i.canvas,t.originalArgs[0].parent),t.useDivWrapper&&i.canvas.appendChild(i.svg);var l=[i.canvas];return this.getDisplayElements=function(){return l},this.appendDisplayElement=function(t){l.push(t)},this.paint=function(n,r,a){if(null!=n){var l,u=[i.x,i.y],c=[i.w,i.h];null!=a&&(0>a.xmin&&(u[0]+=a.xmin),0>a.ymin&&(u[1]+=a.ymin),c[0]=a.xmax+(0>a.xmin?-a.xmin:0),c[1]=a.ymax+(0>a.ymin?-a.ymin:0)),t.useDivWrapper?(jsPlumb.sizeCanvas(i.canvas,u[0],u[1],c[0],c[1]),u[0]=0,u[1]=0,l=o([0,0])):l=o([u[0],u[1]]),s.paint.apply(this,arguments),e(i.svg,{style:l,width:c[0],height:c[1]})}},{renderer:s}};jsPlumb.ConnectorRenderers.svg=function(t){var o=this;l.apply(this,[{cssClass:t._jsPlumb.connectorClass,originalArgs:arguments,pointerEventsSpec:"none",_jsPlumb:t._jsPlumb}]).renderer.paint=function(i,r,a){r=o.getSegments();var l="",u=[0,0];for(0>a.xmin&&(u[0]=-a.xmin),0>a.ymin&&(u[1]=-a.ymin),a=0;a<r.length;a++)l+=jsPlumb.Segments.svg.SegmentRenderer.getPath(r[a]),l+=" ";if(r={d:l,transform:"translate("+u[0]+","+u[1]+")","pointer-events":t["pointer-events"]||"visibleStroke"},l=null,a=[o.x,o.y,o.w,o.h],i.outlineColor){if(u=i.lineWidth+2*(i.outlineWidth||1),l=jsPlumb.CurrentLibrary.extend({},i),l.strokeStyle=jsPlumbUtil.convertStyle(i.outlineColor),l.lineWidth=u,null==o.bgPath){o.bgPath=n("path",r);var u=o.svg,c=o.bgPath;0<u.childNodes.length?u.insertBefore(c,u.childNodes[0]):u.appendChild(c),o.attachListeners(o.bgPath,o)}else e(o.bgPath,r);s(o.svg,o.bgPath,l,a,o)}null==o.path?(o.path=n("path",r),r=o.svg,l=o.path,u=i.outlineColor?1:0,r.childNodes.length>u?r.insertBefore(l,r.childNodes[u]):r.appendChild(l),o.attachListeners(o.path,o)):e(o.path,r),s(o.svg,o.path,i,a,o)},this.reattachListeners=function(){o.bgPath&&o.reattachListenersForElement(o.bgPath,o),o.path&&o.reattachListenersForElement(o.path,o)}},jsPlumb.Segments.svg={SegmentRenderer:{getPath:function(t){return{Straight:function(){var e=t.getCoordinates();return"M "+e.x1+" "+e.y1+" L "+e.x2+" "+e.y2},Bezier:function(){var e=t.params;return"M "+e.x1+" "+e.y1+" C "+e.cp1x+" "+e.cp1y+" "+e.cp2x+" "+e.cp2y+" "+e.x2+" "+e.y2},Arc:function(){return"M"+t.x1+" "+t.y1+" A "+t.radius+" "+t.params.r+" 0 "+(t.sweep>Math.PI?1:0)+","+(t.anticlockwise?0:1)+" "+t.x2+" "+t.y2}}[t.type]()}}};var u=window.SvgEndpoint=function(t){var e=this;l.apply(this,[{cssClass:t._jsPlumb.endpointClass,originalArgs:arguments,pointerEventsSpec:"all",useDivWrapper:!0,_jsPlumb:t._jsPlumb}]).renderer.paint=function(t){t=jsPlumb.extend({},t),t.outlineColor&&(t.strokeWidth=t.outlineWidth,t.strokeStyle=jsPlumbUtil.convertStyle(t.outlineColor,!0)),null==e.node?(e.node=e.makeNode(t),e.svg.appendChild(e.node),e.attachListeners(e.node,e)):null!=e.updateNode&&e.updateNode(e.node),s(e.svg,e.node,t,[e.x,e.y,e.w,e.h],e),o(e.node,[e.x,e.y])},this.reattachListeners=function(){e.node&&e.reattachListenersForElement(e.node,e)}};jsPlumb.Endpoints.svg.Dot=function(){jsPlumb.Endpoints.Dot.apply(this,arguments),u.apply(this,arguments),this.makeNode=function(){return n("circle",{cx:this.w/2,cy:this.h/2,r:this.radius})},this.updateNode=function(t){e(t,{cx:this.w/2,cy:this.h/2,r:this.radius})}},jsPlumb.Endpoints.svg.Rectangle=function(){jsPlumb.Endpoints.Rectangle.apply(this,arguments),u.apply(this,arguments),this.makeNode=function(){return n("rect",{width:this.w,height:this.h})},this.updateNode=function(t){e(t,{width:this.w,height:this.h})}},jsPlumb.Endpoints.svg.Image=jsPlumb.Endpoints.Image,jsPlumb.Endpoints.svg.Blank=jsPlumb.Endpoints.Blank,jsPlumb.Overlays.svg.Label=jsPlumb.Overlays.Label,jsPlumb.Overlays.svg.Custom=jsPlumb.Overlays.Custom;var c=function(t,o){t.apply(this,o),jsPlumb.jsPlumbUIComponent.apply(this,o),this.isAppendedAtTopLevel=!1;var i=this,r=null;this.paint=function(t,s){if(t.component.svg&&s){null==r&&(r=n("path",{"pointer-events":"all"}),t.component.svg.appendChild(r),i.attachListeners(r,t.component),i.attachListeners(r,i));var a=o&&1==o.length?o[0].cssClass||"":"",l=[0,0];0>s.xmin&&(l[0]=-s.xmin),0>s.ymin&&(l[1]=-s.ymin),e(r,{d:"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" L"+t.d.hxy.x+","+t.d.hxy.y,class:a,stroke:t.strokeStyle?t.strokeStyle:null,fill:t.fillStyle?t.fillStyle:null,transform:"translate("+l[0]+","+l[1]+")"})}},this.reattachListeners=function(){r&&i.reattachListenersForElement(r,i)},this.cleanup=function(){null!=r&&jsPlumb.CurrentLibrary.removeElement(r)}};jsPlumb.Overlays.svg.Arrow=function(){c.apply(this,[jsPlumb.Overlays.Arrow,arguments])},jsPlumb.Overlays.svg.PlainArrow=function(){c.apply(this,[jsPlumb.Overlays.PlainArrow,arguments])},jsPlumb.Overlays.svg.Diamond=function(){c.apply(this,[jsPlumb.Overlays.Diamond,arguments])},jsPlumb.Overlays.svg.GuideLines=function(){var t,o,i=null,r=this;jsPlumb.Overlays.GuideLines.apply(this,arguments),this.paint=function(a,l){null==i&&(i=n("path"),a.connector.svg.appendChild(i),r.attachListeners(i,a.connector),r.attachListeners(i,r),t=n("path"),a.connector.svg.appendChild(t),r.attachListeners(t,a.connector),r.attachListeners(t,r),o=n("path"),a.connector.svg.appendChild(o),r.attachListeners(o,a.connector),r.attachListeners(o,r));var u=[0,0];0>l.xmin&&(u[0]=-l.xmin),0>l.ymin&&(u[1]=-l.ymin),e(i,{d:s(a.head,a.tail),stroke:"red",fill:null,transform:"translate("+u[0]+","+u[1]+")"}),e(t,{d:s(a.tailLine[0],a.tailLine[1]),stroke:"blue",fill:null,transform:"translate("+u[0]+","+u[1]+")"}),e(o,{d:s(a.headLine[0],a.headLine[1]),stroke:"green",fill:null,transform:"translate("+u[0]+","+u[1]+")"})};var s=function(t,e){return"M "+t.x+","+t.y+" L"+e.x+","+e.y}}}(),function(t){var e=function(e){return t("string"==typeof e?"#"+e:e)};jsPlumb.CurrentLibrary={addClass:function(t,n){t=e(t);try{t[0].className.constructor==SVGAnimatedString&&jsPlumbUtil.svg.addClass(t[0],n)}catch(o){}try{t.addClass(n)}catch(r){}},animate:function(t,e,n){t.animate(e,n)},appendElement:function(t,n){e(n).append(t)},ajax:function(e){e=e||{},e.type=e.type||"get",t.ajax(e)},bind:function(t,n,o){t=e(t),t.bind(n,o)},dragEvents:{start:"start",stop:"stop",drag:"drag",step:"step",over:"over",out:"out",drop:"drop",complete:"complete"},extend:function(e,n){return t.extend(e,n)},getAttribute:function(t,e){return t.attr(e)},getClientXY:function(t){return[t.clientX,t.clientY]},getDragObject:function(t){return t[1].draggable||t[1].helper},getDragScope:function(t){return t.draggable("option","scope")},getDropEvent:function(t){return t[0]},getDropScope:function(t){return t.droppable("option","scope")},getDOMElement:function(t){return"string"==typeof t?document.getElementById(t):t.context||null!=t.length?t[0]:t},getElementObject:e,getOffset:function(t){return t.offset()},getOriginalEvent:function(t){return t.originalEvent},getPageXY:function(t){return[t.pageX,t.pageY]},getParent:function(t){return e(t).parent()},getScrollLeft:function(t){return t.scrollLeft()},getScrollTop:function(t){return t.scrollTop()},getSelector:function(n,o){return 2==arguments.length?e(n).find(o):t(n)},getSize:function(t){return[t.outerWidth(),t.outerHeight()]},getTagName:function(t){return t=e(t),0<t.length?t[0].tagName:null},getUIPosition:function(t,e){if(e=e||1,1==t.length)ret={left:t[0].pageX,top:t[0].pageY};else{var n=t[1];ret=n.offset||n.absolutePosition,n.position.left/=e,n.position.top/=e}return{left:ret.left/e,top:ret.top/e}},hasClass:function(t,e){return t.hasClass(e)},initDraggable:function(t,e,n){e=e||{},e.doNotRemoveHelper||(e.helper=null),n&&(e.scope=e.scope||jsPlumb.Defaults.Scope),t.draggable(e)},initDroppable:function(t,e){e.scope=e.scope||jsPlumb.Defaults.Scope,t.droppable(e)},isAlreadyDraggable:function(t){return e(t).hasClass("ui-draggable")},isDragSupported:function(t){return t.draggable
},isDropSupported:function(t){return t.droppable},removeClass:function(t,n){t=e(t);try{if(t[0].className.constructor==SVGAnimatedString)return void jsPlumbUtil.svg.removeClass(t[0],n)}catch(o){}t.removeClass(n)},removeElement:function(t){e(t).remove()},setAttribute:function(t,e,n){t.attr(e,n)},setDragFilter:function(t,e){jsPlumb.CurrentLibrary.isAlreadyDraggable(t)&&t.draggable("option","cancel",e)},setDraggable:function(t,e){t.draggable("option","disabled",!e)},setDragScope:function(t,e){t.draggable("option","scope",e)},setOffset:function(t,n){e(t).offset(n)},trigger:function(t,n,o){jQuery._data(e(t)[0],"handle")(o)},unbind:function(t,n,o){t=e(t),t.unbind(n,o)}},t(document).ready(jsPlumb.init)}(jQuery),function(){"undefined"==typeof Math.sgn&&(Math.sgn=function(t){return 0==t?0:t>0?1:-1});var t={subtract:function(t,e){return{x:t.x-e.x,y:t.y-e.y}},dotProduct:function(t,e){return t.x*e.x+t.y*e.y},square:function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},scale:function(t,e){return{x:t.x*e,y:t.y*e}}},e=Math.pow(2,-65),n=function(e,n){for(var r=[],s=n.length-1,a=2*s-1,l=[],u=[],c=[],d=[],h=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],p=0;s>=p;p++)l[p]=t.subtract(n[p],e);for(p=0;s-1>=p;p++)u[p]=t.subtract(n[p+1],n[p]),u[p]=t.scale(u[p],3);for(p=0;s-1>=p;p++)for(var f=0;s>=f;f++)c[p]||(c[p]=[]),c[p][f]=t.dotProduct(u[p],l[f]);for(p=0;a>=p;p++)d[p]||(d[p]=[]),d[p].y=0,d[p].x=parseFloat(p)/a;for(a=s-1,l=0;s+a>=l;l++)for(p=Math.max(0,l-a),u=Math.min(l,s);u>=p;p++)j=l-p,d[p+j].y+=c[j][p]*h[j][p];for(s=n.length-1,d=o(d,2*s-1,r,0),a=t.subtract(e,n[0]),c=t.square(a),p=h=0;d>p;p++)a=t.subtract(e,i(n,s,r[p],null,null)),a=t.square(a),c>a&&(c=a,h=r[p]);return a=t.subtract(e,n[s]),a=t.square(a),c>a&&(c=a,h=1),{location:h,distance:c}},o=function(t,n,r,s){var a,l,u=[],c=[],d=[],h=[],p=0;l=Math.sgn(t[0].y);for(var f=1;n>=f;f++)a=Math.sgn(t[f].y),a!=l&&p++,l=a;switch(p){case 0:return 0;case 1:if(s>=64)return r[0]=(t[0].x+t[n].x)/2,1;var m,g,p=t[0].y-t[n].y;for(l=t[n].x-t[0].x,f=t[0].x*t[n].y-t[n].x*t[0].y,a=max_distance_below=0,m=1;n>m;m++)g=p*t[m].x+l*t[m].y+f,g>a?a=g:max_distance_below>g&&(max_distance_below=g);if(g=l,m=0*g-1*p,a=(1*(f-a)-0*g)*(1/m),g=l,l=f-max_distance_below,m=0*g-1*p,p=(1*l-0*g)*(1/m),l=Math.min(a,p),Math.max(a,p)-l<e)return d=t[n].x-t[0].x,h=t[n].y-t[0].y,r[0]=0+1*(d*(t[0].y-0)-h*(t[0].x-0))*(1/(0*d-1*h)),1}for(i(t,n,.5,u,c),t=o(u,n,d,s+1),n=o(c,n,h,s+1),s=0;t>s;s++)r[s]=d[s];for(s=0;n>s;s++)r[s+t]=h[s];return t+n},i=function(t,e,n,o,i){for(var r=[[]],s=0;e>=s;s++)r[0][s]=t[s];for(t=1;e>=t;t++)for(s=0;e-t>=s;s++)r[t]||(r[t]=[]),r[t][s]||(r[t][s]={}),r[t][s].x=(1-n)*r[t-1][s].x+n*r[t-1][s+1].x,r[t][s].y=(1-n)*r[t-1][s].y+n*r[t-1][s+1].y;if(null!=o)for(s=0;e>=s;s++)o[s]=r[s][0];if(null!=i)for(s=0;e>=s;s++)i[s]=r[e-s][s];return r[e][0]},r={},s=function(t,e){var n,o=t.length-1;if(n=r[o],!n){n=[];var i=function(t){return function(){return t}},s=function(){return function(t){return t}},a=function(){return function(t){return 1-t}},l=function(t){return function(e){for(var n=1,o=0;o<t.length;o++)n*=t[o](e);return n}};n.push(new function(){return function(t){return Math.pow(t,o)}});for(var u=1;o>u;u++){for(var c=[new i(o)],d=0;o-u>d;d++)c.push(new s);for(d=0;u>d;d++)c.push(new a);n.push(new l(c))}n.push(new function(){return function(t){return Math.pow(1-t,o)}}),r[o]=n}for(a=s=i=0;a<t.length;a++)i+=t[a].x*n[a](e),s+=t[a].y*n[a](e);return{x:i,y:s}},a=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},l=function(t){return t[0].x==t[1].x&&t[0].y==t[1].y},u=function(t,e,n){if(l(t))return{point:t[0],location:e};for(var o=s(t,e),i=0,r=n>0?1:-1,u=null;i<Math.abs(n);)e+=.005*r,u=s(t,e),i+=a(u,o),o=u;return{point:u,location:e}},c=function(t,e){var n=s(t,e),o=s(t.slice(0,t.length-1),e),i=o.y-n.y,n=o.x-n.x;return 0==i?1/0:Math.atan(i/n)};window.jsBezier={distanceFromCurve:n,gradientAtPoint:c,gradientAtPointAlongCurveFrom:function(t,e,n){return e=u(t,e,n),1<e.location&&(e.location=1),0>e.location&&(e.location=0),c(t,e.location)},nearestPointOnCurve:function(t,e){var o=n(t,e);return{point:i(e,e.length-1,o.location,null,null),location:o.location}},pointOnCurve:s,pointAlongCurveFrom:function(t,e,n){return u(t,e,n).point},perpendicularToCurveAt:function(t,e,n,o){return e=u(t,e,null==o?0:o),t=c(t,e.location),o=Math.atan(-1/t),t=n/2*Math.sin(o),n=n/2*Math.cos(o),[{x:e.point.x+n,y:e.point.y+t},{x:e.point.x-n,y:e.point.y-t}]},locationAlongCurveFrom:function(t,e,n){return u(t,e,n).location},getLength:function(t){if(l(t))return 0;for(var e=s(t,0),n=0,o=0,i=null;1>o;)o+=.005,i=s(t,o),n+=a(i,e),e=i;return n}}}(),function(){"use strict";var t={}.hasOwnProperty,e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e};define("workflow",["base","manager","models","actions","lib/jquery-jsplumb"],function(t,n,o,i,r){var s,a,l,u,c,d,h,p,f,m,g,v,y,b,P,C,E,x,S,j,_,w,D,A,k,L,I,O,M,T,U,F,N,W;return U=t.find,F=t.findAll,N=t.tpl,W=t.tplAll,w=t.View,l=t.BoxView,h=t.FrameView,p=t.InnerFrameView,y=t.ModalDialogView,d=t.FormDialogView,b=t.NavListView,v=n.ManagerView,c=o.Entity,T=o.Workflows,D=o.Workflow,S=o.Nodes,P=o.Node,f=o.Link,a=o.Actions,s=o.Action,I=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.editor=new L({el:"#workflow_editor",parent:this}),this.manager=new O({el:"#workflow_manager",parent:this}),this},n.prototype.open=function(t,e){switch(t){case"new":console.log("show workflow editor with create mode"),this.switchTo(this.manager),this.manager.create(t);break;case"mgr":console.log("show workflow mgr"),this.switchTo(this.manager);break;default:if(!t)throw new Error("open workflow with a name or id is needed");console.log("show workflow editor for",t),this.switchTo(this.editor),this.editor.load(t,e)}return this},n}(h),_=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.auto=!1,n.prototype.urlRoot="worklfow",n.prototype.headerTitle="Create from Template",n.prototype.itemClassName="workflow-list-item",n.prototype.collection=T.workflows,n.prototype.defaultItem=null,n.prototype.allowEmpty=!0,n.prototype.emptyItem=new D({id:"new",name:"Empty Workflow"}),n.prototype.events={click:function(t){var e;return e=t.target,"A"===e.tagName&&e.dataset.id?(t.preventDefault(),this.trigger("select",e.dataset.id),!1):void 0}},n.prototype._render=function(t){var e,n;null==t&&(t=this.collection),t.fullCollection&&(t=t.fullCollection),e=document.createDocumentFragment(),n=document.createDocumentFragment(),t.forEach(function(t){return function(o){var i;return i=o.has("tenant_id")?n:e,i.appendChild(t._renderItem(o))}}(this)),this.el.appendChild(e),this.el.appendChild(this._renderHeader("Create from Workflows")),this.el.appendChild(n)},n.prototype.render=function(){return this._clear(),this._render(),this._super_render(),this},n}(b),A=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.model.get("tenant_id")||this._hide("remove"),this},n}(Backgrid.ActionsCell),O=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.columns=["checkbox","id","name:workflow","desc","sharing","created_at","updated_at",{name:"workflow",label:"",editable:!1,sortable:!1,cell:A}],n.prototype.collection=new T,n.prototype.defaultFilterField="name",n.prototype.initialize=function(t){var e;return n.__super__.initialize.call(this,t),this.list=new _({el:U("ul.template-list",this.el)}),this.creator=new k({el:"#workflow_creator",parent:this}),e=this.remove.bind(this),this.on({remove:e,remove_selected:e}),this.list.on("select",this.create.bind(this)),this.listenTo(this.collection,"add",function(t){return function(e){return T.workflows.add(e),t.refresh()}}(this)),this.listenTo(this.collection,"remove",function(t){return T.workflows.remove(t)}),this},n.prototype.create=function(t){return(!t||/^(?:new|empty)$/i.test(t))&&(t=""),this.creator.popup({template_id:t},function(e){return function(n,o){var i,r;if("save"===n){if(console.log("create new wf:",o),t=o.template_id){if(i=T.workflows.get(t),!i)throw new Error("cannot find workflow with id",t);return r=function(t){o.desc||(o.desc="Cloned from workflow "+t.get("name")),(new D).copy(t).save(o,{success:function(t){return e.collection.add(t),e.refresh()}})},i.loaded()?r(i):i.fetch({reset:!0,success:r})}return delete o.template_id,e.collection.create(o,{wait:!0})}}}(this)),this},n.prototype.remove=function(t){var e,n,o;if(Array.isArray(t)||(t=[t]),confirm("Make sure these selected workflows is not in use!\nDo you realy want to remove selected workflows?")){for(n=0,o=t.length;o>n;n++)e=t[n],null!=e&&e.destroy();t.length>=this.pageSize/2&&this.reload()}return this},n.prototype.render=function(){return this.list.fetch(),n.__super__.render.apply(this,arguments)},n}(v),k=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el="#workflow_creator",n.prototype.goBackOnHidden="workflow/mgr",n.prototype.collection=T.workflows,n.prototype.popup=function(t,e){return n.__super__.popup.call(this,t,e),this.fill(t),this},n.prototype.save=function(){return this.data=this.read(),this.callback("save"),this.hide(!0),this},n.prototype.render=function(){return this.collection.load(function(t){return function(){return t._renderSelect()}}(this)),n.__super__.render.apply(this,arguments)},n.prototype._renderSelect=function(){var t,e,n,o,i;n=this.form.template_id,i=this.collection.fullCollection,i.length&&(e=document.createElement("optgroup"),e.label="Owned Workflows",o=document.createElement("optgroup"),o.label="Shared Workflows",i.forEach(function(t){var n;return n=document.createElement("option"),n.value=t.id,n.textContent=t.get("name"),t.has("tanent_id")?e.appendChild(n):o.appendChild(n)}),n.innerHTML="",t=document.createElement("option"),t.value="",t.textContent="(Empty Workflow)",n.appendChild(t),e.childElementCount&&n.appendChild(e),o.childElementCount&&n.appendChild(o))},n}(d),L=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.events={"click .wf-save":"save","click .wf-reset":function(t){return this.reset(t.modifiers||!t.currentTarget.classList.contains("btn-danger"))},"click #workflow_header":function(){return this.renamer.popup(this.model,function(t){return function(e,n){"save"===e&&(console.log("save name",n),t.nameEl.textContent=n.get("name"),t.descEl.textContent=n.get("desc"),t.model.trigger("changed","rename_workflow",t.model))}}(this))},"change #wf_orientation":function(t){return this.view.setOrientation(t.currentTarget.value,!0)}},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.view=new M({el:U("#workflow_view",this.el),nodeEditor:new C,linkEditor:new m}),this.nodeList=new E({el:U("#node_list",this.el),parent:this}),this.renamer=new u({el:U("#workflow_name_editor",this.el)}),this.btnSave=U(".wf-save",this.el),this.btnReset=U(".wf-reset",this.el),this.nameEl=U(".editable-name",this.el),this.descEl=U(".editable-desc",this.el),this.$orientation=$(U("#wf_orientation",this.el)),this.nodeList.on("select",function(t){return function(e,n){return console.log("select from node list",e,n),"new"===e?n=null:e&&null==n&&(n=t.model.nodes.get(e)),t.view.createNode(n)}}(this)),this},n.prototype._enableBtns=function(t){var e;this.btnSave.disabled=!t||this.readonly,e=$(this.btnReset),t?e.addClass("btn-danger").text("Reset"):e.removeClass("btn-danger").text("Reload")},n.prototype.reset=function(t){return(t===!0||confirm("All changes will be descarded since last save, are you sure to do that?"))&&(this.reload(),this._enableBtns(!1)),this},n.prototype.save=function(){var t,e;if(e=this.model,this.readonly)return console.error("not allow to change readonly workflow!"),this.reset(!0),this;if(!e.nodes.length)return alert("Cannot save a workflow without any node!"),this;if(!e.has("start_node_id")||!e.nodes.get(e.get("start_node_id"))){if(t=e.nodes.filter(function(t){return!t.inLinks.length}),1!==t.length)return alert("Please set the start node!"),this;this.view.setStartNode(t[0].id)}return console.log("save",e.attributes),this._enableBtns(!1),e.save({},{wait:!0,success:function(t){return console.log("saved",t)},error:function(){return this._enableBtns(!0),console.error("save failed",this.model)}}),this},n.prototype._loaded=function(t,e){var n,o,i;this.id=t.id,this.nameEl.textContent=t.get("name"),this.descEl.textContent=t.get("desc")||"",this.model=t,i=0,n=0,this.model.nodes.forEach(function(t){var e,o,r;t.has("offset")&&(r=t.get("offset"),e=r.x,o=r.y,e>i&&(i=e),o>n&&(n=o))}),o=i&&n&&n>i?"v":"h",this.$orientation.val(o),this.view.setOrientation(o),this.view.load(t,e),this.nodeList.setNodes(t.nodes),this.readonly=!this.model.isNew()&&!this.model.has("tenant_id"),this.listenTo(t,"changed",function(t,e){return this._enableBtns(!0),console.log("workflow changed",t,e)})},n.prototype._clear=function(){this.stopListening(this.model),this.id=null,this.model=null,this.nameEl.textContent="",this.descEl.textContent="",this._enableBtns(!1),this.readonly=!1,this.view.clear()},n.prototype.load=function(t,e){if(t)if("string"==typeof t)this.id!==t||(null!=e?e.reload:void 0)?(this._clear(),t=new D({id:t}),t.fetch({silent:!0,success:function(t){return function(n){return t._loaded(n,e)}}(this)})):this.load(this.model,e);else{if(null==t.id)throw new Error("load neigher workflow id string nor workflow object");this.id===t.id?this._loaded(t,e):t.loaded()?this._loaded(t,e):(this._clear(),t.fetch({silent:!0,success:function(t){return function(n){return t._loaded(n,e)}}(this)}))}else this._clear();return this},n.prototype.reload=function(){return this.load(this.id,{reload:!0})},n.prototype.render=function(){return this.nodeList.render(),n.__super__.render.apply(this,arguments)},n}(p),E=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.urlRoot="node",n.prototype.headerTitle="Common Nodes",n.prototype.defaultItem=new P({id:"new",name:"Empty Node"}),n.prototype.itemClassName="",n.prototype.targetClassName="node thumb",n.prototype.collection=new S,n.prototype.events={click:function(t){var e;return e=t.target,"A"===e.tagName&&e.dataset.id?(t.preventDefault(),this.trigger("select",e.dataset.id,$(e).data("model")),!1):void 0},"mouseenter .node":function(t){$.data(t.target,"is-draggable")||$(t.target).draggable({containment:this.parent.el,helper:"clone",zIndex:999}).data("is-draggable",!0)}},n.prototype.setNodes=function(t){var e;return this.nodes!==t&&(this.nodes&&this.stopListening(this.nodes),this.nodes=t,t&&(e=this.render,this.listenTo(t,"reset",e),this.listenTo(t,"add",e),this.listenTo(t,"remove",e)),this.render()),this},n.prototype.render=function(){return this._clear(),this.el.appendChild(this._renderHeader("Shared Nodes")),this._render(),this.nodes&&(this.el.appendChild(this._renderHeader("Used Nodes")),this._render(this.nodes)),this._super_render(),this},n}(b),u=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.popup=function(t,e){if(!(t instanceof c))throw new Error("data must be an model entity");return n.__super__.popup.call(this,t,e),this.readonly=!t.isNew()&&!t.has("tenant_id"),this.fill(t.attributes),this.btnSave.textContent=t.isNew()?"OK":"Save",this.on("shown",function(t){return function(){return $(t.form).find(":input").prop("readOnly",t.readonly),t.btnSave.disabled=t.readonly,t.form.name.select()}}(this)),this},n.prototype.save=function(){return this.data.set(this.read()),this.callback("save"),this.hide(!0),this},n}(d),C=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.acts_as(i),n.prototype.el="#node_editor",n.prototype.events={"click a.action-thumb":"_addAction",shown:"_fixStyle"},n.prototype._too_many_actions_limit=7,n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.initActions(t),this._fixStyle=this._fixStyle.bind(this),$(window).on("resize",this._fixStyle),this._too_many_alert=U("#too_many_actions_alert",this.el),this.on("actions_update",this._checkActionLimit.bind(this)),this},n.prototype.remove=function(){return $(window).off("resize",this._fixStyle),n.__super__.remove.apply(this,arguments)},n.prototype._fixStyle=function(){this.actionsEl.style.top=20+$(this.form).height()+"px"},n.prototype._addAction=function(t){var e,n;return t.preventDefault(),n=t.target,e=n.href.match(/action:(\w+)/i),e&&this.addAction({type:e[1]},{scrollIntoView:!0}),!1},n.prototype.fill=function(t){return n.__super__.fill.call(this,t),this.fillActions(null!=t?t.actions:void 0),this},n.prototype.save=function(){return this.data.set("actions",this.readActions()),n.__super__.save.apply(this,arguments),this},n.prototype.reset=function(){return this.clearActions(),n.__super__.reset.apply(this,arguments)},n.prototype._checkActionLimit=function(){var t,e;return t=this._too_many_alert.classList,e=F(".action",this.actionsEl).length,e>this._too_many_actions_limit?(t.add("active"),this._too_many_alert.scrollIntoViewIfNeeded()):t.remove("active")},n}(u),m=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.el="#link_editor",n}(u),M=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.jsPlumbDefaults={DragOptions:{zIndex:2e3},Endpoint:["Dot",{radius:3,cssClass:"endpoint"}],ConnectionsDetachable:!0,ReattachConnections:!0,HoverPaintStyle:{strokeStyle:"#42a62c",lineWidth:2,zIndex:2e3},Connector:["Flowchart",{stub:[40,60],gap:10,cssClass:"link"}],ConnectionOverlays:[["Arrow",{location:-5,id:"arrow"}]]},n.prototype.gridDefaults={padding:30,spanX:300,spanY:150},n.prototype.events={"click .node":"_togglePopover",mousedown:"_cancelPopover","click .popover .btn-delete":function(t){return this._action("remove",t)},"click .popover .btn-edit":function(t){return this._action("edit",t)},"dblclick .node":function(t){return this._action("edit",t)}},n.prototype.initialize=function(t){return n.__super__.initialize.call(this,t),this.nodeEditor=t.nodeEditor,this.linkEditor=t.linkEditor,r.importDefaults(this.jsPlumbDefaults),this.render(),this},n.prototype._bind=function(){var t;t=this,r.bind("beforeDrop",function(e){var n,o;return n=e.sourceId.slice(5),o=e.targetId.slice(5),"start"===n?t.setStartNode(o):t.model.hasLink(n,o)||t.createLink(n,o),!1}),r.bind("dblclick",function(e){t.editLink(e.getParameter("link"))}),r.bind("click",function(t){return function(e){var n;n=e.getOverlay("label"),null!=n&&t._togglePopover({target:n.canvas})}}(this)),this.$el.droppable({accept:".node.thumb",drop:function(t){return function(e,n){var o;return o=n.draggable.data("model"),o instanceof P?(t.createNode(o,function(e){var o,i;return o=t.$el.offset(),i={x:n.offset.left-o.left,y:n.offset.top-o.top},i.x<0&&(i.x=0),i.y<0&&(i.y=0),e.set("offset",i),!0}),!0):!1}}(this)})},n.prototype._hidePopover=function(){var t;t=this._popped,t&&(t._delay&&(t._delay=clearTimeout(t._delay)),$(t).popover("hide"))},n.prototype._cancelPopover=function(t){var e;this._popped&&!this.$el.find(".popover").has(t.target).length&&(this._hidePopover(),e=this._popped,this._popped=null,e._hidding=!0,setTimeout(function(){return delete e._hidding},300))},n.prototype._togglePopover=function(t){var e;e=t.target,this._popped===e||e._hidding?(this._hidePopover(),this._popped=null):(e._delay=setTimeout(function(t){return function(){return(t._popped=e)&&$(e).popover("show"),e._delay=null}}(this),100),this._popped=e)},n.prototype._action=function(t,e){var n,o,i;if(n=$(e.target),n.hasClass("target")||(n=n.parents(".target")),i=n.data("node"))o=this[t+"Node"];else if(i=n.data("link"))o=this[t+"Link"];else if(!n.hasClass("node-start"))return void console.error("no node or link in data",n,e);null!=o&&o.call(this,i)},n.prototype.clear=function(){var t;return null!=(t=this.startNode)&&t.remove(),this.startNode=null,this.el.innerHTML="",this.stopListening(this.model),this},n.prototype.load=function(t,e){var n,o,i,r,s;if(s=null!=e?e:{},o=s.link,i=s.node,n=s.action,r=s.reload,n&&!i)throw new Error("cannot open a action without given a node");if(o&&i)throw new Error("node and link cannot be open together");return(t!==this.model||r)&&(this.clear(),this.model=t,this.listenTo(this.model.nodes,"add",this._addNode.bind(this)),this.listenTo(this.model.links,"add",this._addLink.bind(this)),this._renderModel(t),this.hash="#workflow/"+t.id),i?(this.editNode(t.nodes.get(i)),n&&this.nodeEditor.viewAction(n)):o?this.editLink(t.links.get(o)):(this.nodeEditor.cancel(),this.linkEditor.cancel()),this},n.prototype.setOrientation=function(t,e){return null==t&&(t="h"),this.orientation!==t&&(this.orientation=t,e&&this.load(this.model,{reload:!0})),this},n.prototype._sortNodeViews=function(t){var e,n,o,i,r,s,a;t.lonely=[],t.start=[],t.end=[],t.forEach(function(e){var n;return e.inLinks.length===(n=e.outLinks.length)&&0===n?t.lonely.push(e):0===e.inLinks.length?t.start.push(e):0===e.outLinks.length?t.end.push(e):void 0}),e=this.grid=[t.start.concat(t.lonely)],a=this.gridDefaults,n=a.padding,o=a.spanX,i=a.spanY,s="v"===this.orientation,(r=function(t){var a,l;a=[],null!=(l=e[t])&&l.forEach(function(e,r){var l;e.gridX=r,e.gridY=t,s?(e.x=r*o,e.y=t*i):(e.x=t*o,e.y=r*i),e.x+=n,e.y+=n,null!=(l=e.outLinks)&&l.forEach(function(t){null==t.nextNode.gridX&&a.push(t.nextNode)})}),a.length&&(e[t+1]=a,r(t+1))})(0),console.log("grid",e)},n.prototype._renderModel=function(t){var e,n;if(console.log("render wf",t),t=this.model,null==t)throw new Error("workflow not loaded");null!=(n=this.startNode)&&n.remove(),e=this.startNode=new j({parent:this}),e.render(),this.el.appendChild(e.el),t.nodes.length&&t.nodes.at(0).has("offset")||this._sortNodeViews(t.nodes),r.ready(function(e){return function(){t.nodes.forEach(e._addNode.bind(e)),t.links.forEach(e._addLink.bind(e)),e.setStartNode(t.get("start_node_id"))}}(this))},n.prototype.setStartNode=function(t){var e,n;if(null==t?(console.log("auto detect start node"),n=this.model.nodes.filter(function(t){return!t.inLinks.length}),t=n[0]||this.model.nodes.at(0),t=null!=t?t.id:void 0):null!=t.id&&(t=t.id),console.log("set start node",t),null!=t){if(t!==this.model.get("start_node_id")&&(this.model.set("start_node_id",t),this.model.trigger("changed","set_start_node",this.model)),e=this.startNode,!e)throw new Error("startNodeView not exist");if(e.conn)try{r.detach(e.conn)}catch(_error){}e.conn=r.connect({source:e.srcEndpoint,target:"node_"+t,cssClass:"link",hoverClass:"hover"})}return this},n.prototype.addNode=function(t){if(null==t&&(t="emtpy"),"new"===t||"empty"===t)return console.log("add a empty node"),this.createNode();if(!(t instanceof P))throw console.error("add a invalid node",t),new Error("add a invalid node");return console.log("add node",t),this.model.createNode(t),this},n.prototype._addNode=function(t){var e;e=t.view=new x({model:t,parent:this}),e.render(),this.el.appendChild(e.el)},n.prototype.createNode=function(t,e){var n,o,i;if(i=this.model.id,t&&"new"!==t.id)if(t instanceof P&&null!=t.id)t=t.clone(),o=t.get("name"),n=t.get("desc"),t.set({workflow_id:i,template_id:t.id,key:t.get("key")+"_clone",name:o+" (Clone)",desc:n?n+" (Clone)":null}),t.unset("offset"),t.unset("id");else{if(!t.name)return void console.error("invalid node to create",t);t.workflow_id=i,t=new P(t)}else t=new P({workflow_id:i});return this.nodeEditor.popup(t,function(t){return function(n,o){return"save"!==n?console.log("canceled or ignored create node",n):!1!==("function"==typeof e?e(o):void 0)?t.model.createNode(o,function(){return 1===t.model.nodes.length&&t.setStartNode(o),t.model.save()}):void 0}}(this)),this},n.prototype.editNode=function(t){var e;return null==(null!=t?t.id:void 0)?this:(this.nodeEditor.popup(t,function(t){return function(e,n){return"save"===e?(n.view.update(n),n.isNew()?t.model.trigger("changed","edit_node",n):n.save()):console.log("canceled or ignored edit node",e),"ignored"!==e?t.router.navigate(t.hash):void 0}}(this)),e=""+this.hash+"/node/"+t.id,-1===location.hash.indexOf(e)&&this.nodeEditor.once("shown",function(t){return function(){return t.router.navigate(e)}}(this)),this)},n.prototype.removeNode=function(t){var e,n,o,i,r,s,a;if(null!=t?t.isNew():void 0)return this;if(e=[].concat(t.inLinks,t.outLinks),confirm("Delete the node: "+t.get("name")+" with all "+e.length+" links connected?"))for(a=this.model,i=a.nodes,o=a.links,i.remove(t),t.id===this.model.get("start_node_id")&&this.setStartNode(),o.remove(e),i.remove(t),this.model.save(),e.push(t),r=0,s=e.length;s>r;r++)n=e[r],n.destroy();return this},n.prototype.createLink=function(t,e,n){var o,i;return null!=t.id&&t.has("name")||(t=this.model.nodes.get(t)),null!=e.id&&e.has("name")||(e=this.model.nodes.get(e)),i=""+t.get("key")+"_to_"+e.get("key"),o=new f({workflow_id:this.model.id,key:i.slice(0,33).toLowerCase(),prev_node_id:t.id,next_node_id:e.id}),this.linkEditor.popup(o,function(t){return function(e,o){return"save"===e?(!1!==("function"==typeof n?n(o):void 0)&&t.model.createLink(o),t.model.trigger("changed","create_link",o)):console.log("canceled or ignored create link",e)}}(this)),this},n.prototype._addLink=function(t){var e;e=t.view=new g({model:t,parent:this}),e.render()},n.prototype.editLink=function(t){var e;return(null!=t?t.id:void 0)?(this.linkEditor.popup(t,function(t){return function(e,n){return"save"===e?(n.view.update(n),n.isNew()?t.model.trigger("changed","edit_link",n):n.save()):console.log("canceled or ignored edit link",e),"ignored"!==e?t.router.navigate(t.hash):void 0}}(this)),e=""+this.hash+"/link/"+t.id,-1===location.hash.indexOf(e)&&this.linkEditor.once("shown",function(t){return function(){return t.router.navigate(e)}}(this)),this):this},n.prototype.removeLink=function(t){return(null!=t?t.isNew():void 0)?this:(confirm("Delete the link: "+(t.get("name")||"(No Name)")+"?")&&(this.model.links.remove(t),this.model.save(),t.destroy()),this)},n.prototype.render=function(){return this._bind(),this.el.onselectstart=function(){return!1},n.__super__.render.apply(this,arguments)},n}(w),j=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.id="node_start",n.prototype.className="node node-start target",n.prototype.sourceEndpointStyle={isSource:!0,uniqueEndpoint:!0,maxConnections:-1,paintStyle:{fillStyle:"#225588",radius:9},connectorStyle:{strokeStyle:"#346789",dashstyle:"2 2",lineWidth:2,outlineColor:"#fff",outlineWidth:1},connectorHoverStyle:{strokeStyle:"#42a62c",outlineWidth:2}},n.prototype.render=function(){var t;return t="v"===this.parent.orientation,this.$el.text("(S)").tooltip({title:"Start Point",container:this.el,placement:t?"right":"bottom"}),r.draggable(this.$el,{stack:".node"}),this.parentEl.appendChild(this.el),this.sourceEndpointStyle.anchor=t?"BottomCenter":"RightMiddle",this.srcEndpoint=r.addEndpoint(this.$el,this.sourceEndpointStyle,{parameters:{start:!0,view:this}}),n.__super__.render.apply(this,arguments)},n.prototype.remove=function(){if(this.srcEndpoint&&this.conn)try{r.deleteEndpoint(this.srcEndpoint)}catch(_error){}return this.srcEndpoint=this.conn=null,n.__super__.remove.apply(this,arguments)},n}(w),x=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.tagName="div",n.prototype.className="node",n.prototype.sourceEndpointStyle={isSource:!0,uniqueEndpoint:!0,maxConnections:-1,paintStyle:{fillStyle:"#225588",radius:9},connectorStyle:{strokeStyle:"#346789",lineWidth:2,outlineColor:"#fff",outlineWidth:1},connectorHoverStyle:{strokeStyle:"#42a62c",outlineWidth:2},connectorOverlays:[["Label",{location:.5,label:"new link",id:"label",cssClass:"link-label"}]]},n.prototype.targetEndpointStyle={isTarget:!0,paintStyle:{fillStyle:"#225588",radius:5},dropOptions:{hoverClass:"hover",activeClass:"active"}},n.prototype._popover_tpl=N("#t_popover"),n.prototype.render=function(){var t,e,o;return t=this.el,e=t.node=this.model,this.el.id="node_"+e.id,this.listenTo(e,"destroy",this.remove.bind(this)),"v"===this.parent.orientation?(this.sourceEndpointStyle.anchor="BottomCenter",this.targetEndpointStyle.anchor=["LeftMiddle","TopCenter","RightMiddle"]):(this.sourceEndpointStyle.anchor="RightMiddle",this.targetEndpointStyle.anchor=["LeftMiddle","TopCenter","BottomCenter"]),this._renderModel(e),r.draggable(this.$el,{stack:".node",stop:function(){var n,o,i;n=parseInt(t.style.left),o=parseInt(t.style.top),console.log("$el_pos1",n,o),n>0||(n=0),o>0||(o=0),console.log("$el_pos2",n,o),e.set("offset",{x:n,y:o}),null!=(i=e.workflow)&&i.trigger("changed","move_node",e)}}),this.parentEl.appendChild(t),o={parameters:{node:e,view:this}},this.srcEndpoint=r.addEndpoint(this.$el,this.sourceEndpointStyle,o),r.makeTarget(this.$el,this.targetEndpointStyle,o),n.__super__.render.apply(this,arguments)},n.prototype.update=function(t){return null==t&&(t=this.model),this.$el.popover("destroy"),this._renderModel(t),r.repaint(this.el.id),this},n.prototype._renderModel=function(t){var e,n,o,i;null==t&&(t=this.model),this.el.innerHTML=t.escape("name"),e=t.get("name"),t.has("offset")?(n=t.get("offset"),o=this.el.style,o.left=n.x+"px",o.top=n.y+"px"):(this.el.style.left=t.x+"px",this.el.style.top=t.y+"px"),this.$el.addClass("target").data({node:t,view:this}),this.$el.popover({container:this.parentEl,trigger:"manual",placement:"bottom",title:e,html:!0,content:this._popover_tpl.replace("{desc}",t.get("desc")||"")}),this.$popover=this.$el.data("popover").tip(),null!=(i=this.$popover)&&i.addClass("target").data({node:t,view:this})},n.prototype.remove=function(){return this.$el.popover("destroy"),r.deleteEndpoint(this.srcEndpoint),r.deleteEndpoint(this),n.__super__.remove.apply(this,arguments)},n}(w),g=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype._popover_tpl=x.prototype._popover_tpl,n.prototype.render=function(){var t,e;return e=this.model,e.view=this,t=this.conn=r.connect({source:e.prevNode.view.srcEndpoint,target:e.nextNode.view.el,cssClass:"link",hoverClass:"hover",parameters:{link:e,view:this}}),this.setElement(t.canvas),this.listenTo(e,"destroy",this.remove.bind(this)),this.label=t.getOverlay("label"),this.labelEl=this.label.canvas,this._renderLabel(e),n.__super__.render.apply(this,arguments)},n.prototype.update=function(t){return null==t&&(t=this.model),this._destroyPopover(),this._renderLabel(t),this},n.prototype._renderLabel=function(t){var e,n,o;return e=$(this.labelEl),n=t.get("name"),this.label.setLabel(n||""),e.css("visibility",n?"visible":"hidden"),e.popover({container:this.parentEl,title:n||"Link",trigger:"manual",placement:"bottom",html:!0,content:this._popover_tpl.replace("{desc}",t.get("desc")||"")}),this.$popover=e.data("popover").tip(),null!=(o=this.$popover)&&o.addClass("target").data({link:t,view:this}),this},n.prototype._destroyPopover=function(){return $(this.labelEl).popover("destroy")},n.prototype.remove=function(){var t;return null!=(t=this.model)&&(t.view=null),console.log("remove",this.conn,this.model,this),r.detach(this.conn),this._destroyPopover(),n.__super__.remove.apply(this,arguments)},n}(w),I})}.call(this);