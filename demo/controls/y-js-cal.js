/*!
* Y-JS-Cal powered by Wilson@yyfearth.com
* filename: y-js-cal.js
* last update: 2012-1-07 1:51:36
*/
Y_JS_Cal={id:"Y_JS_Cal",html:'<table id="y_js_cal_table"><caption><a href="#" title="\u4e0a\u6708" id="y_js_cal_prev" class="a_button">&lt;</a> <input type="text" maxlength="4" title="\u5e74\u4efd \n\u70b9\u51fb\u8fdb\u884c\u8f93\u5165\uff0c\u9f20\u6807\u6eda\u8f6e\u53ef\u4ee5\u81ea\u52a8\u589e\u51cf\u5e74\u4efd\u3002" id="y_js_cal_y" value="{y}"/>\u5e74<span id="y_js_cal_m" title="\u6708\u4efd \n\u70b9\u51fb\u8fdb\u884c\u9009\u62e9\uff0c\u9f20\u6807\u6eda\u8f6e\u53ef\u4ee5\u81ea\u52a8\u589e\u51cf\u6708\u4efd\u3002">{m}</span>\u6708 <a href="#" title="\u4e0b\u6708" id="y_js_cal_next" class="a_button">&gt;</a></caption><tr><th class="weekday">\u65e5</th><th>\u4e00</th><th>\u4e8c</th><th>\u4e09</th><th>\u56db</th><th>\u4e94</th><th class="weekday">\u516d</th></tr>\n<tr>{days}</tr>\n</table><a style="float:right" href="#" title="\u70b9\u51fb\u5173\u95ed\u672c\u65e5\u5386\u9009\u62e9\u6846" onclick="return Y_JS_Cal.hide()" class="a_button">\u5173\u95ed</a><a href="#" id="y_js_cal_now" title="\u70b9\u51fb\u9009\u62e9\u4eca\u5929" class="a_button">\u4eca\u5929</a>',init:function(){this.container=document.getElementById(this.id);if(null==this.container){var a=document.createElement("div");a.id=this.id;a.style.display="none";this.container=a;a.onclick=function(a){window.event?window.event.cancelBubble=!0:a.stopPropagation();return!1};var b=navigator.userAgent.toLowerCase(),b=this.mozilla=/mozilla/.test(b)&&!/(compatible|webkit)/.test(b),c=function(a){if(window.event)a=window.event,a.cancelBubble=!0;var b=a.wheelDelta?a.wheelDelta/120:(-a.detail||0)/3,c=a.ctrlKey||a.shiftKey||a.altKey;if(0>b)Y_JS_Cal[c?"next_year":"next"]();else if(0<b)Y_JS_Cal[c?"prev_year":"prev"]();a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();if("returnValue"in a)a.returnValue=!1;return!1};"onmousewheel"in a?a.onmousewheel=c:a.addEventListener?a.addEventListener(b?"DOMMouseScroll":"mousewheel",c,!1):a.attachEvent?a.attachEvent("onmousewheel",c):a.onmousewheel=c;document.body.appendChild(a);a='<select id="y_js_cal_sel_m" name="y_js_cal_sel_m" size="1">';for(b=1;12>=b;b++)a+='<option value="'+b+'">'+b+"</option>";this._sel_m_html=a+"</select>"}this.y=this.m=null;return this},prev:function(){this.m--;if(1>this.m)this.y--,this.m=12;this.build();return!1},next:function(){this.m++;if(12<this.m)this.y++,this.m=1;this.build();return!1},prev_year:function(){this.y--;this.build();return!1},next_year:function(){this.y++;this.build();return!1},readonly:!1,build_days_grid:function(){for(var a=this.y,b=this.m,c=new Date,d=null!=this.curdate&&a==this.curdate.getFullYear()&&this.curdate.getMonth()==b-1,g=a==c.getFullYear()&&c.getMonth()==b-1,e="",h=(new Date(a,b,0)).getDate(),i=1-(new Date(a,b-1,1)).getDay(),k=h;6!=(new Date(a,b-1,k)).getDay();)k++;for(;i<=k;i++){var j=new Date(a,b-1,i),f="";0<i&&i<=h&&(f="normal",0==j.getDay()%6&&(f+=" weekday"),d&&this.curdate&&i==this.curdate.getDate()&&(f+=" current"),g&&i==c.getDate()&&(f+=" today"));this.readonly&&(f+=" readonly");var l=this.stringifyDate(j);0==j.getDay()&&(e+="</tr>\n<tr>");e+='<td id="y_js_cal_day" name="y_js_cal_day" utc="'+Date.parse(j)+'" title="'+l+'" class="'+f+'"><a href="#'+l+'" onclick="return false">'+j.getDate()+"</a></td>"}this.container.innerHTML=this.html.replace(/{(\w+)}/g,function(c){switch(c){case "{y}":return a;case "{m}":return b;case "{days}":return e}});c=document.getElementsByName("y_js_cal_day");if(!this.readonly)for(d=0;d<c.length;d++)c.item(d).onclick=function(){Y_JS_Cal.select(this.getAttribute("utc"))};document.getElementById("y_js_cal_prev").onclick=function(){Y_JS_Cal.prev();return!1};document.getElementById("y_js_cal_next").onclick=function(){Y_JS_Cal.next();return!1};c=document.getElementById("y_js_cal_now");this.readonly?c["class"]=c.className="readonly":c.onclick=function(){Y_JS_Cal.select_now();return!1}},build_month_selector:function(){var a=document.getElementById("y_js_cal_m");if(!this.readonly)a.onclick=function(){if(2<this.innerHTML.length)return!1;this.innerHTML=Y_JS_Cal._sel_m_html;var b=document.getElementById("y_js_cal_sel_m");b.childNodes[Y_JS_Cal.m-1].selected=!0;b.onchange=function(){if(Y_JS_Cal.m==this.value)return b.onblur();Y_JS_Cal.m=this.value;Y_JS_Cal.build();return!0};b.onblur=function(){b.onblur="";a.innerHTML=Y_JS_Cal.m;return!1};b.focus();return!1}},build_year_input:function(){var a=document.getElementById("y_js_cal_y");a.readOnly=this.readonly;if(!this.readonly){a.onkeypress=function(a){a=window.event?window.event.keyCode:a.which;return 13==a?this.onblur():47<a&&58>a};a.onfocus=function(){this.style.backgroundColor="white";this.style.cursor="auto"};a.onblur=function(){this.style.backgroundColor="#ccccff";this.style.cursor="pointer";if(Y_JS_Cal.y==this.value)return!1;if(!/\d{4}/.test(this.value))return alert("\u8f93\u5165\u7684\u5e74\u4efd\u65e0\u6548\uff01\n\u8bf7\u8f93\u51654\u4f4d\u7684\u6570\u5b57\uff0c\u5982 1999 2009"),this.value=Y_JS_Cal.y,!1;Y_JS_Cal.y=this.value;Y_JS_Cal.build();return!0};var b=function(a){if(window.event)a=window.event,a.cancelBubble=!0;var b=a.wheelDelta?a.wheelDelta/120:(-a.detail||0)/3;0>b?(Y_JS_Cal.y++,Y_JS_Cal.build()):0<b&&(Y_JS_Cal.y--,Y_JS_Cal.build());a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();if("returnValue"in a)a.returnValue=!1;return!1};"onmousewheel"in a?a.onmousewheel=b:a.addEventListener?a.addEventListener(Y_JS_Cal.mozilla?"DOMMouseScroll":"mousewheel",b,!1):a.attachEvent?a.attachEvent("onmousewheel",b):a.onmousewheel=b}},build:function(){this.build_days_grid();this.build_month_selector();this.build_year_input()},esc_cancel:function(a){27==(window.event?window.event.keyCode:a.which)&&Y_JS_Cal.hide()},click_outside_cancel:function(){Y_JS_Cal.showing||Y_JS_Cal.hide();Y_JS_Cal.showing=!1},show:function(a,b,c,d){this.showing=!0;if(a)try{this.curdate=a=this.parseDate(a,!1)}catch(g){if(!b||"string"==typeof b)return this.bindshow(a,b,c);this.curdate=null;a=new Date}else this.curdate=null,a=new Date;this.container||this.init();var e=a.getFullYear(),a=a.getMonth()+1;if(c==this.onselect_scope&&"none"!=this.container.style.display&&this.y==e&&this.m==a)return!1;"none"!=this.container.style.display&&this.hide();this.y=e;this.m=a;if(b instanceof Function)this.onselect_scope=c,this.onselect=b;this.build();if(d=d||this.getPos(c))this.container.style.left=d.x+"px",this.container.style.top=d.y+"px";this.container.style.display="block";b=document.getElementById("y_js_cal_table").offsetWidth;if(100<b)this.container.style.width=b+"px";document.addEventListener?(document.addEventListener("click",this.click_outside_cancel,!1),document.addEventListener("keydown",this.esc_cancel,!1)):document.attachEvent?(document.attachEvent("onclick",this.click_outside_cancel),document.attachEvent("onkeydown",this.esc_cancel)):(this._org_document_onclick=document.onclick,this._org_document_onkeydown=document.onkeydown,document.onclick=this.click_outside_cancel,document.onkeydown=this.esc_cancel);return!1},hide:function(){this.container.style.display="none";document.removeEventListener?(document.removeEventListener("click",this.click_outside_cancel,!1),document.removeEventListener("keydown",this.esc_cancel,!1)):document.detachEvent?(document.detachEvent("onclick",this.click_outside_cancel),document.detachEvent("onkeydown",this.esc_cancel)):(document.onclick=this._org_document_onclick,document.onkeydown=this._org_document_onkeydown);return!1},select_now:function(){return this.select("now")},ret_data_str:!0,select:function(a){var a=this.parseDate(a),b=this.ret_data_str?this.stringifyDate(a):a;this.curdate=a;this.hide();this.onselect&&this.onselect.call(this.onselect_scope||this,b);return b},stringifyDate:function(a){null==a&&(a=new Date);var b=a.getMonth()+1,c=a.getDate();10>b&&(b="0"+b);10>c&&(c="0"+c);return[a.getFullYear(),b,c].join("-")},parseDate:function(a,b){if(a instanceof Date)return a;if(/^(null|undefined|now|today)?$/i.test(a))return new Date;if(/^\d+$/.test(a))return new Date(parseInt(a));var c=new Date(a);if(isNaN(c)){c=a.match(/(\d{2,4})-(\d\d?)-(\d\d?)/);if(null==c||0==c.length){if(!1===b)throw Error("illegal input:"+a);return new Date}return new Date(c[1],c[2]-1,c[3])}return c},formatDate:function(a,b){function c(a){a=a.toString();return 1<a.length?a:"0"+a}if(!(a instanceof Date))throw Error("dateFormat err: input is ont Date!");return b.replace(/(yy){1,4}|M{1,5}|d{1,6}/g,function(b){var g=a.getMonth()+1,e=a.getDate(),h=a.getDay();switch(b){case "yyyy":return a.getFullYear();case "MM":return c(g);case "dd":return c(e);case "M":return g;case "d":return e;case "MMM":return"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sept,Oct,Nov,Dec".split(",")[g];case "MMMM":return"\u4e00,\u4e8c,\u4e09,\u56db,\u4e94,\u516d,\u4e03,\u516b,\u4e5d,\u5341,\u5341\u4e00,\u5341\u4e8c".split(",")[g]+"\u6708";case "MMMMM":return"January,February,March,April,May,June,July,August,September,October,November,December".split(",")[g];case "ddd":return"Sun,Mon,Tue,Wed,Thu,Fri,Sat".split(",")[h];case "dddd":return"\u5468"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".charAt(h);case "ddddd":return"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Satday".split(",")[h];case "dddddd":return"\u661f\u671f"+"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".charAt(h);case "yy":return a.getYear()}})},getPos:function(a){if(null==a.offsetLeft)return null;var b={x:a.offsetLeft,y:a.offsetTop+a.offsetHeight};if(/MSIE/i.test(navigator.userAgent))for(;a=a.offsetParent;)b.x+=a.offsetLeft-a.scrollLeft+a.clientLeft,b.y+=a.offsetTop-a.scrollTop+a.clientTop;return b},bindshow:function(a,b,c){"string"==typeof a&&(a=document.getElementById(a));b?!(b in a)&&!c&&(c=b,b="value"):b="value";Y_JS_Cal.readonly=!!a.readOnly;Y_JS_Cal.ret_data_str=!c;a.disabled||Y_JS_Cal.show(a[b],function(d){a[b]=!c?d:Y_JS_Cal.formatDate(d,c)},a)}};
